<!DOCTYPE html>
<html>
<head>
<title>Oracle 数据库</title>
<!-- 2017-10-13 Fri 10:40 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="imfine">
<meta  name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="assets/base.css">
<script src="assets/base.js"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Oracle 数据库</h1>
<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 序</a></li>
<li><a href="#sec-2">2. 甜点</a>
<ul>
<li><a href="#sec-2-1">2.1. 题库1</a></li>
<li><a href="#sec-2-2">2.2. 题库2</a></li>
<li><a href="#sec-2-3">2.3. 题库3</a></li>
<li><a href="#sec-2-4">2.4. 查询各种工作中的最低工资</a></li>
<li><a href="#sec-2-5">2.5. 在芝加哥工作的人中，谁的工资最高</a></li>
<li><a href="#sec-2-6">2.6. 查询所有员工工资都大于1000的部门的信息及员工信息</a>
<ul>
<li><a href="#sec-2-6-1">2.6.1. 第一种思路</a></li>
<li><a href="#sec-2-6-2">2.6.2. 第二种思路</a></li>
</ul>
</li>
<li><a href="#sec-2-7">2.7. 查询当月总共有多少个周五</a></li>
</ul>
</li>
<li><a href="#sec-3">3. 冷饮</a>
<ul>
<li><a href="#sec-3-1">3.1. 学生管理系统</a></li>
<li><a href="#sec-3-2">3.2. 博客管理系统</a></li>
<li><a href="#sec-3-3">3.3. 购物车逻辑的表设计(从设计E-R图开始)</a></li>
<li><a href="#sec-3-4">3.4. 微博/博客系统(从设计E-R图开始)</a></li>
<li><a href="#sec-3-5">3.5. 论坛(从设计E-R图开始)</a></li>
</ul>
</li>
<li><a href="#sec-4">4. 体系结构</a>
<ul>
<li><a href="#sec-4-1">4.1. Client</a>
<ul>
<li><a href="#sec-4-1-1">4.1.1. Sqlplus</a></li>
<li><a href="#sec-4-1-2">4.1.2. JDBC</a></li>
</ul>
</li>
<li><a href="#sec-4-2">4.2. TNSListener</a></li>
<li><a href="#sec-4-3">4.3. Server</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. 实例(Instance)</a></li>
<li><a href="#sec-4-3-2">4.3.2. 数据库(Database)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. 用户权限</a>
<ul>
<li><a href="#sec-5-1">5.1. 用户(User)</a></li>
<li><a href="#sec-5-2">5.2. 权限(Privilege)</a></li>
</ul>
</li>
<li><a href="#sec-6">6. SQL 语句</a>
<ul>
<li><a href="#sec-6-1">6.1. Data Type</a>
<ul>
<li><a href="#sec-6-1-1">6.1.1. 字符类型</a></li>
<li><a href="#sec-6-1-2">6.1.2. 数值类型</a></li>
<li><a href="#sec-6-1-3">6.1.3. 日期类型</a></li>
<li><a href="#sec-6-1-4">6.1.4. 二进制类型</a></li>
<li><a href="#sec-6-1-5">6.1.5. LOB 类型</a></li>
<li><a href="#sec-6-1-6">6.1.6. 伪列(Pseudo Column)</a></li>
<li><a href="#sec-6-1-7">6.1.7. NULL</a></li>
</ul>
</li>
<li><a href="#sec-6-2">6.2. 运算符</a>
<ul>
<li><a href="#sec-6-2-1">6.2.1. 算术运算符</a></li>
<li><a href="#sec-6-2-2">6.2.2. 连接运算符</a></li>
<li><a href="#sec-6-2-3">6.2.3. 比较运算符</a></li>
<li><a href="#sec-6-2-4">6.2.4. 逻辑运算符</a></li>
<li><a href="#sec-6-2-5">6.2.5. 集合操作符</a></li>
</ul>
</li>
<li><a href="#sec-6-3">6.3. Join Query</a></li>
<li><a href="#sec-6-4">6.4. Functions</a>
<ul>
<li><a href="#sec-6-4-1">6.4.1. Numeric</a></li>
<li><a href="#sec-6-4-2">6.4.2. Charactor</a></li>
<li><a href="#sec-6-4-3">6.4.3. Datetime</a></li>
<li><a href="#sec-6-4-4">6.4.4. Nullable</a></li>
<li><a href="#sec-6-4-5">6.4.5. Miscellaneous</a></li>
<li><a href="#sec-6-4-6">6.4.6. Aggregate Function</a></li>
<li><a href="#sec-6-4-7">6.4.7. Analytic Function</a></li>
</ul>
</li>
<li><a href="#sec-6-5">6.5. Pagination</a></li>
<li><a href="#sec-6-6">6.6. 查询语句执行顺序</a></li>
<li><a href="#sec-6-7">6.7. DDL/DML/TCL/DCL</a></li>
</ul>
</li>
<li><a href="#sec-7">7. 同义词/视图</a>
<ul>
<li><a href="#sec-7-1">7.1. 同义词(Synonym)</a></li>
<li><a href="#sec-7-2">7.2. 视图(View)</a></li>
</ul>
</li>
<li><a href="#sec-8">8. 效率和速度</a>
<ul>
<li><a href="#sec-8-1">8.1. 表分区</a></li>
<li><a href="#sec-8-2">8.2. 物化视图</a></li>
<li><a href="#sec-8-3">8.3. 索引</a></li>
</ul>
</li>
<li><a href="#sec-9">9. PL/SQL编程</a>
<ul>
<li><a href="#sec-9-1">9.1. PL/SQL块</a></li>
<li><a href="#sec-9-2">9.2. 类型与赋值</a></li>
<li><a href="#sec-9-3">9.3. 控制流程</a></li>
<li><a href="#sec-9-4">9.4. 游标</a></li>
<li><a href="#sec-9-5">9.5. 动态语句</a></li>
<li><a href="#sec-9-6">9.6. 异常处理</a></li>
<li><a href="#sec-9-7">9.7. Procedure</a></li>
<li><a href="#sec-9-8">9.8. Function</a></li>
</ul>
</li>
<li><a href="#sec-10">10. 导入/导出</a></li>
<li><a href="#sec-11">11. 锁/事务</a></li>
<li><a href="#sec-12">12. hint/explain</a></li>
<li><a href="#sec-13">13. Data Guard/RAC</a></li>
</ul>
</div>
</nav>
<p>
数据库本质是用计算机存储数据的一种系统。
它是位于 <code>用户</code> 和 <code>系统</code> 之间的一种管理软件。
</p>

<section id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 序</h2>
<div class="outline-text-2" id="text-1">
<ol class="org-ol">
<li>登录 SQLPLUS
<pre class="example">
cmd
sqlplus [用户名]/[密码][@数据库] [参数]
sqlplus sys/orcl as sysdba  -- 登录 sys 用户，必须指定 sysdba 或 sysoper 身份
sqlplus system/orcl         -- 数据库管理员
</pre>
</li>

<li>创建一个自己的用户(比如 vip/vip)
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-builtin">user</span> vip identified <span class="org-keyword">by</span> vip;     <span class="org-comment">-- &#27880;&#24847;&#65292;&#26032;&#21019;&#24314;&#30340;&#29992;&#25143;&#65292;&#20160;&#20040;&#26435;&#38480;&#37117;&#27809;&#26377;&#65292;&#38656;&#35201;&#25480;&#26435;&#21518;&#25165;&#33021;&#20351;&#29992;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">create</span> <span class="org-keyword">session</span> <span class="org-keyword">to</span> vip;           <span class="org-comment">-- &#25480;&#20104;&#30331;&#24405;&#30340;&#26435;&#38480;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">connect</span> <span class="org-keyword">to</span> vip;                  <span class="org-comment">-- &#35282;&#33394;&#26159;&#24456;&#22810;&#26435;&#38480;&#30340;&#25171;&#21253;&#65292;connect &#26159;&#19968;&#31181;&#35282;&#33394;&#65292;&#23427;&#21253;&#21547;&#20102;&#36830;&#25509;&#26597;&#30475;&#25968;&#25454;&#30340;&#19968;&#20123;&#22522;&#26412;&#26435;&#38480;</span>
<span class="org-keyword">grant</span> dba <span class="org-keyword">to</span> vip;                      <span class="org-comment">-- dba &#26159;&#32477;&#22823;&#22810;&#25968;&#26435;&#38480;&#30340;&#38598;&#21512;&#65292;&#23427;&#22522;&#26412;&#33021;&#20570;&#25152;&#26377;&#20107;&#24773;&#65292;&#25152;&#20197;&#24456;&#23569;&#21333;&#29420;&#25480;&#20104;&#29992;&#25143;&#12290;&#20294;&#22312;&#27979;&#35797;&#29615;&#22659;&#20013;&#65292;&#36825;&#26679;&#65292;&#24456;&#29245;&#12290;</span>

<span class="org-comment">-- &#19978;&#38754;&#30340;&#21019;&#24314;&#29992;&#25143;&#12289;&#25480;&#20104;&#26435;&#38480;&#20004;&#27493;&#25805;&#20316;&#65292;&#21487;&#20197;&#31616;&#21270;&#20026;&#19979;&#38754;&#19968;&#27493;&#65306;</span>
<span class="org-keyword">grant</span> dba <span class="org-keyword">to</span> vip identified <span class="org-keyword">by</span> vip;    <span class="org-comment">-- &#27880;&#24847;&#65292;&#20351;&#29992;&#20998;&#21495;&#32467;&#23614;</span>
</pre>
</div>
</li>

<li>切换到用户
<pre class="example">
sqlplus vip/vip  -- 在 cmd 下
conn vip/vip     -- 在 sqlplus 中
</pre>
</li>

<li>使用
<pre class="example">
create table aaa (id int);
</pre>
</li>

<li>激活内置的测试账号，这里面有几张示例表，可以用它们练习下查询
<pre class="example">
alter user scott account unlock;
conn scott/tiger
</pre>
</li>

<li>修改密码
<pre class="example">
alter user scott identified by [newpassword];
</pre>
</li>
</ol>
</div>
</section>

<section id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 甜点</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 题库1</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>在芝加哥工作的人中，谁的工资最高
</li>
<li>查询每个部门下有多少员工
</li>
<li>查询除去 salesman 所有平均工资超过 1500 的部门
</li>
<li>查询在 new york 工作的所有员工的姓名，部门名称和工资信息
</li>
<li>查询姓名为 King 的员工的编号，名称跟部门
</li>
<li>查询各种工作的最低工资
</li>
<li>查询工龄大于10年的所有员工信息
</li>
<li>查询每个部门员工数量，平均工资和平均工作年限
</li>
<li>统计各部门每个工种的人数，平均工资。
</li>
<li>查询从事同一种工作但不属于同一部门的员工信息。
</li>
<li>查询所有员工工资都大于1000的部门的信息及员工信息
</li>
<li>查询入职日期早于其直接上级的所有员工信息。
</li>
<li>列出雇员中（除去mgr为空的人)工资第二高的人。
</li>
<li>列出1981年来公司所有员工的总收入（包括sal和comm）
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 题库2</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>查询工资为 2500 到 4000 的人的数量（用不同方式查询）
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> <span class="org-builtin">count</span><span class="org-rainbow-delimiters-depth-1">(</span>*<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt;= 2500 <span class="org-keyword">and</span> sal &lt;= 4000;
<span class="org-comment">-- vs.</span>
<span class="org-keyword">select</span> <span class="org-builtin">count</span><span class="org-rainbow-delimiters-depth-1">(</span>*<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal <span class="org-keyword">between</span> 2500 <span class="org-keyword">and</span> 4000;
</pre>
</div>
</li>
<li>查询部门编号为 10 和 30 的所有人（用不同方式查询）
</li>
<li>查询部门编号为 10 和 30 中名字中不含有 'C' 的所有人
</li>
<li>查询部门编号为 10 和 30 中名字首字母之外不含有 'C' 的所有人
</li>
<li>查询部门编号为 10 和 30 中所有的经理以及名字首字母之外不含有 'C' 的所有人
</li>
<li>查询纽约和芝加哥地区所有的经理以及名字首字母之外不含有 'C' 的所有人
</li>
<li>查询纽约和芝加哥地区所有的经理以及顶头上司名字的首字母之外不含有 'C' 的所有人
</li>
<li>查询每个人的工资等级
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21021;&#22987;&#21270;&#25968;&#25454;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">salgrade</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> scott.salgrade;

<span class="org-comment">-- &#20998;&#21035;&#26597;&#30475;&#25968;&#25454;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> salgrade;

<span class="org-comment">-- &#26434;&#20132;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp, salgrade;

<span class="org-comment">-- &#36807;&#28388;&#25481;&#19981;&#21512;&#36866;&#30340;</span>
<span class="org-keyword">select</span> ename, grade <span class="org-keyword">from</span> emp e, salgrade s <span class="org-keyword">where</span> e.sal <span class="org-keyword">between</span> s.losal <span class="org-keyword">and</span> s.hisal;
</pre>
</div>
</li>
<li>查询每个部门的平均工资的等级
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#20998;&#26512;&#39064;&#30446;</span>
<span class="org-comment">-- 1. &#38656;&#35201;&#20808;&#26597;&#35810;&#20986;&#27599;&#20010;&#37096;&#38376;&#30340;&#24179;&#22343;&#24037;&#36164;</span>
<span class="org-comment">-- 2. &#26681;&#25454; salgrade &#34920;&#20013;&#30340;&#25968;&#25454;&#65292;&#33719;&#21462;&#27599;&#20010;&#37096;&#38376;&#24179;&#22343;&#24037;&#36164;&#30340;&#31561;&#32423;</span>

<span class="org-comment">-- &#36825;&#26159;&#25152;&#26377;&#30340;&#20154;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp;
<span class="org-comment">-- &#25353;&#29031;&#37096;&#38376;&#20998;&#32452;</span>
<span class="org-keyword">select</span> deptno, <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno;
<span class="org-comment">-- &#32467;&#26524;&#65306;</span>
<span class="org-comment">-- | DEPTNO |   AVG(SAL)    |</span>
<span class="org-comment">-- |     30  | 1566.66667  |</span>
<span class="org-comment">-- |     20 |  2258.33333  |</span>
<span class="org-comment">-- |     10 |  2916.66667  |</span>

<span class="org-comment">-- &#36319; salgrade &#34920;&#65292;&#26434;&#20132;&#65292;&#24635;&#20849; 15 &#26465;&#32467;&#26524;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span>
  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> deptno, <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-2">(</span>sal<span class="org-rainbow-delimiters-depth-2">)</span> sal <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno<span class="org-rainbow-delimiters-depth-1">)</span> t,
  salgrade s;

<span class="org-comment">-- &#36807;&#28388;&#25481;&#24037;&#36164;&#33539;&#22260;&#19981;&#21512;&#36866;&#30340;&#25968;&#25454;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span>
  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> deptno, <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-2">(</span>sal<span class="org-rainbow-delimiters-depth-2">)</span> sal <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno<span class="org-rainbow-delimiters-depth-1">)</span> t,
  salgrade s
<span class="org-keyword">where</span>
  t.sal <span class="org-keyword">between</span> s.losal <span class="org-keyword">and</span> s.hisal;
<span class="org-comment">-- &#32467;&#26524;&#23601;&#26159;&#36825;&#26679;&#65292;&#23601;&#23545;&#20102;</span>
<span class="org-comment">-- | DEPTNO |  SAL        |  GRADE |  LOSAL |  HISAL  |</span>
<span class="org-comment">-- |     10 |  2916.66667 |      4 |   2001 |   3000  |</span>
<span class="org-comment">-- |     20 |  2258.33333 |      4 |   2001 |   3000  |</span>
<span class="org-comment">-- |     30 |  1566.66667 |      3 |   1401 |   2000  |</span>


<span class="org-comment">-- &#38656;&#35201;&#23558;&#37096;&#38376;&#21517;&#31216;&#26174;&#31034;&#20986;&#26469;&#65292;&#20877;&#26434;&#20132;-&gt;&#36807;&#28388;&#19968;&#27425;&#23601;&#21487;&#20197;&#20102;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span>
  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> deptno, <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-2">(</span>sal<span class="org-rainbow-delimiters-depth-2">)</span> sal <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno<span class="org-rainbow-delimiters-depth-1">)</span> t,
  salgrade s,
  dept d
<span class="org-keyword">where</span>
  t.deptno = d.deptno <span class="org-keyword">and</span>
  t.sal <span class="org-keyword">between</span> s.losal <span class="org-keyword">and</span> s.hisal;


<span class="org-comment">-- &#26368;&#21518;&#30340;&#26368;&#21518;&#65292;&#35774;&#32622;&#26174;&#31034;&#23383;&#27573;</span>
<span class="org-keyword">select</span> dname, grade <span class="org-keyword">from</span>
  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> deptno, <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-2">(</span>sal<span class="org-rainbow-delimiters-depth-2">)</span> sal <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno<span class="org-rainbow-delimiters-depth-1">)</span> t,
  salgrade s,
  dept d
<span class="org-keyword">where</span>
  t.deptno = d.deptno <span class="org-keyword">and</span>
  t.sal <span class="org-keyword">between</span> s.losal <span class="org-keyword">and</span> s.hisal;
<span class="org-comment">-- &#26368;&#32456;&#32467;&#26524;&#65292;&#23436;&#32654;</span>
<span class="org-comment">--| DNAME      |  GRADE  |</span>
<span class="org-comment">--| ACCOUNTING |      4  |</span>
<span class="org-comment">--| RESEARCH   |      4  |</span>
<span class="org-comment">--| SALES      |      3  |</span>
</pre>
</div>
</li>
</ul>
</div>
</div>



<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 题库3</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>查询每个组最高工资的那些人
</li>
<li>有下面一个表，写一条 sql 语句计算男女之差
<table>


<colgroup>
<col  class="left">

<col  class="right">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">gender</th>
<th scope="col" class="right">number</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">男</td>
<td class="right">46</td>
</tr>

<tr>
<td class="left">女</td>
<td class="right">10</td>
</tr>
</tbody>
</table>
</li>
<li>给 emp 中的人加工资，请写出相关语句:
<table>


<colgroup>
<col  class="left">

<col  class="right">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">条件</th>
<th scope="col" class="right">加多少</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">1000元以下</td>
<td class="right">50%</td>
</tr>

<tr>
<td class="left">2000元以下</td>
<td class="right">30%</td>
</tr>

<tr>
<td class="left">3000元以下</td>
<td class="right">20%</td>
</tr>

<tr>
<td class="left">其他</td>
<td class="right">5%</td>
</tr>
</tbody>
</table>
</li>
<li>给 emp 中的人加工资，如上。但 <code>1981/5/1</code> 之后来的所有人，只加 <code>2%</code>, 请写出语句。
</li>
<li>计算你们从入学到现在过了多少个周末
</li>
<li>计算你们从现在到毕业还有多少天，还有多少个周末
</li>
<li>计算你们在学校的时间内，每天花费多少钱
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> 查询各种工作中的最低工资</h3>
<div class="outline-text-3" id="text-2-4">
<p>
看到最低、最大、平均之类的题目，首先想到的是分组函数的使用。
</p>

<p>
也就是 group by, having。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> job, <span class="org-builtin">min</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> job;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> 在芝加哥工作的人中，谁的工资最高</h3>
<div class="outline-text-3" id="text-2-5">
<p>
[题目] 从 scott 用户的 emp/dept 表中，找到 “来自芝加哥最有钱的那个人” 。
</p>

<p>
首先，我们需要理清思路。
</p>

<p>
这里总共有两个条件：
</p>
<ol class="org-ol">
<li>这个人来自芝加哥
</li>
<li>这个人是最有钱的，而且是芝加哥最有钱的
</li>
</ol>

<p>
我们可以看出，第二个条件是依赖第一个条件的。
</p>

<p>
所以，分两步查询：
</p>
<ol class="org-ol">
<li>找出所有来自芝加哥的人
</li>
<li>从这些人中，找到最有钱的那个。这一步，可以通过 max 函数或者 order by 方式实现。
</li>
</ol>

<p>
<b>下面是语句示例：</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">---- &#31532;&#19968;&#27493;&#65306;&#25214;&#21040;&#26469;&#33258;&#33437;&#21152;&#21733;&#30340;&#25152;&#26377;&#20154;&#12290;&#19979;&#38754;&#20004;&#31181;&#20889;&#27861;&#31561;&#20215;&#65306;</span>

<span class="org-keyword">select</span> e.* <span class="org-keyword">from</span> emp e
  <span class="org-keyword">join</span> dept d <span class="org-keyword">on</span> <span class="org-rainbow-delimiters-depth-1">(</span>e.deptno=d.deptno<span class="org-rainbow-delimiters-depth-1">)</span>
  <span class="org-keyword">where</span> d.loc=<span class="org-string">'CHICAGO'</span>;

<span class="org-keyword">select</span> e.* <span class="org-keyword">from</span> emp e, dept d
  <span class="org-keyword">where</span> d.deptno = e.deptno
        <span class="org-keyword">and</span> d.loc=<span class="org-string">'CHICAGO'</span>;


<span class="org-comment">---- &#31532;&#20108;&#27493;&#65292;&#22522;&#20110;&#19978;&#38754;&#32467;&#26524;&#65292;&#31579;&#36873;&#20986;&#26368;&#26377;&#38065;&#30340;&#37027;&#20010;</span>

<span class="org-comment">-- &#21487;&#20197;&#36890;&#36807; max &#20989;&#25968;</span>
<span class="org-keyword">select</span> e.* <span class="org-keyword">from</span> emp e, dept d
  <span class="org-keyword">where</span> e.deptno = d.deptno
        <span class="org-keyword">and</span> d.loc=<span class="org-string">'CHICAGO'</span>
        <span class="org-keyword">and</span> sal = 
            <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> <span class="org-builtin">max</span><span class="org-rainbow-delimiters-depth-2">(</span>sal<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">from</span> emp e, dept d
              <span class="org-keyword">where</span> e.deptno = d.deptno
                    <span class="org-keyword">and</span> d.loc=<span class="org-string">'CHICAGO'</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#21487;&#20197;&#36890;&#36807; order by &#26041;&#24335;</span>
<span class="org-keyword">select</span> ename <span class="org-keyword">from</span>
  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> e.*, d.* <span class="org-keyword">from</span> emp e, dept d
    <span class="org-keyword">where</span> e.deptno = d.deptno
          <span class="org-keyword">and</span> d.loc=<span class="org-string">'CHICAGO'</span>
    <span class="org-keyword">order</span> <span class="org-keyword">by</span> sal <span class="org-keyword">desc</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-keyword">where</span> rownum = 1;
</pre>
</div>

<p>
注意，实现的方式，不止上面的那些。但总体 <b>思路</b> 是一样的。
</p>

<p>
所以，思路永远是最重要的。
</p>
</div>
</div>


<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> 查询所有员工工资都大于1000的部门的信息及员工信息</h3>
<div class="outline-text-3" id="text-2-6">
<p>
<b>最核心的问题：</b> 查询出符合条件的部门编号。
</p>
</div>

<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="section-number-4">2.6.1</span> 第一种思路</h4>
<div class="outline-text-4" id="text-2-6-1">
<ol class="org-ol">
<li>查询出所有的部门编号
<pre class="example">
select * from emp;
</pre>
</li>

<li>查询出所有工资少于 1000 的人，
我们要把它所在的部门，从上面的结果中排除掉。
<pre class="example">
select deptno from emp where sal &lt; 1000;
</pre>
</li>

<li>将上面查询出的不符合条件的部门排除掉
<pre class="example">
select distinct deptno from emp
 where deptno not in 
  (select deptno from emp where sal &lt; 1000);
</pre>
</li>

<li>修改上面语句，增加最终的条件，查询所有的其他信息
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> d.dname, e.* <span class="org-keyword">from</span> emp e <span class="org-keyword">join</span> dept d <span class="org-keyword">on</span><span class="org-rainbow-delimiters-depth-1">(</span>e.deptno = d.deptno<span class="org-rainbow-delimiters-depth-1">)</span>
  <span class="org-keyword">where</span> e.deptno <span class="org-keyword">not</span> <span class="org-keyword">in</span>
    <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> deptno <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &lt; 1000<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</li>
</ol>
</div>
</div>


<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2"><span class="section-number-4">2.6.2</span> 第二种思路</h4>
<div class="outline-text-4" id="text-2-6-2">
<p>
使用分组函数(<code>group by</code> / <code>having</code>)。
</p>

<p>
分组函数主要用来统计分析。
</p>

<p>
一个完整的查询语句如下，其中 group by 和 having 是用来分组和筛选分组。
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> <span class="org-rainbow-delimiters-depth-1">[</span>&#23383;&#27573;<span class="org-rainbow-delimiters-depth-1">]</span> <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">[</span>&#34920;&#21517;<span class="org-rainbow-delimiters-depth-1">]</span>
  <span class="org-keyword">where</span> <span class="org-rainbow-delimiters-depth-1">[</span>&#26465;&#20214;<span class="org-rainbow-delimiters-depth-1">]</span>
  <span class="org-keyword">group</span> <span class="org-keyword">by</span> <span class="org-rainbow-delimiters-depth-1">[</span>&#20998;&#32452;&#23383;&#27573;<span class="org-rainbow-delimiters-depth-1">]</span>
  <span class="org-keyword">having</span> <span class="org-rainbow-delimiters-depth-1">[</span>&#23545;&#20998;&#32452;&#32467;&#26524;&#36827;&#34892;&#31579;&#36873;<span class="org-rainbow-delimiters-depth-1">]</span>
  <span class="org-keyword">order</span> <span class="org-keyword">by</span> <span class="org-rainbow-delimiters-depth-1">[</span>&#23383;&#27573;<span class="org-rainbow-delimiters-depth-1">]</span>
</pre>
</div>

<p>
示例：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> deptno,     <span class="org-comment">-- &#20998;&#32452;&#23383;&#27573;</span>
       <span class="org-builtin">count</span><span class="org-rainbow-delimiters-depth-1">(</span>*<span class="org-rainbow-delimiters-depth-1">)</span>,   <span class="org-comment">-- &#20154;&#25968;</span>
       <span class="org-builtin">sum</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>,   <span class="org-comment">-- &#24037;&#36164;&#24635;&#21644;</span>
       <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>,   <span class="org-comment">-- &#24179;&#22343;&#24037;&#36164;</span>
       <span class="org-builtin">max</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>,   <span class="org-comment">-- &#26368;&#39640;&#24037;&#36164;</span>
       <span class="org-builtin">min</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>    <span class="org-comment">-- &#26368;&#20302;&#24037;&#36164;</span>
  <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno         <span class="org-comment">-- &#25353;&#29031;&#37096;&#38376;&#20998;&#32452;&#65292;&#36827;&#34892;&#32479;&#35745;</span>
           <span class="org-keyword">having</span> <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span> &gt; 2000; <span class="org-comment">-- &#21482;&#26174;&#31034;&#24179;&#22343;&#24037;&#36164;&#22823;&#20110; 2000 &#30340;&#20998;&#32452;</span>
</pre>
</div>


<p>
<b>那我们的题目的解决思路就是：</b>
</p>
<ol class="org-ol">
<li>按照部门分组
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> deptno <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno;
</pre>
</div>
</li>

<li>筛选，排除最低工资小于 1000 的部门。
即：得到符合条件的部门的编号。
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> deptno <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno <span class="org-keyword">having</span> <span class="org-builtin">min</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span> &gt; 1000;
</pre>
</div>
</li>

<li>完善最终语句，得到最终结果。
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp e, dept d
  <span class="org-keyword">where</span> e.deptno = d.deptno
        <span class="org-keyword">and</span> e.deptno <span class="org-keyword">in</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> deptno <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno <span class="org-keyword">having</span> <span class="org-builtin">min</span><span class="org-rainbow-delimiters-depth-2">(</span>sal<span class="org-rainbow-delimiters-depth-2">)</span> &gt; 1000<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7"><span class="section-number-3">2.7</span> 查询当月总共有多少个周五</h3>
<div class="outline-text-3" id="text-2-7">
<p>
<b>首先，第一步，得到本月所有日期的结果集，两种方式:</b>
</p>
<ol class="org-ol">
<li>使用已有表的 rownum 构建
</li>
<li>使用 oracle 的 connect by level 语句（结构化查询）
</li>
</ol>

<p>
得到有 n 条记录的虚表：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> rownum <span class="org-keyword">from</span> dba_objects <span class="org-keyword">where</span> rownum &lt; 32;
<span class="org-keyword">select</span> <span class="org-keyword">level</span> <span class="org-keyword">from</span> dual <span class="org-keyword">connect</span> <span class="org-keyword">by</span> <span class="org-keyword">level</span> &lt; 32;
</pre>
</div>

<p>
将虚表转化为我们需要的日期表：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> trunc<span class="org-rainbow-delimiters-depth-1">(</span>sysdate, <span class="org-string">'MON'</span><span class="org-rainbow-delimiters-depth-1">)</span> + rownum - 1 <span class="org-keyword">from</span> dba_objects <span class="org-keyword">where</span> rownum &lt; 32;
<span class="org-keyword">select</span> trunc<span class="org-rainbow-delimiters-depth-1">(</span>sysdate, <span class="org-string">'MON'</span><span class="org-rainbow-delimiters-depth-1">)</span> + <span class="org-keyword">level</span> - 1 <span class="org-keyword">from</span> dual <span class="org-keyword">connect</span> <span class="org-keyword">by</span> <span class="org-keyword">level</span> &lt; 32;
</pre>
</div>

<p>
<b>其次，在上面结果集的基础上进行筛选：</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- 1.</span>
<span class="org-keyword">select</span> *
  <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> trunc<span class="org-rainbow-delimiters-depth-2">(</span>sysdate, <span class="org-string">'MON'</span><span class="org-rainbow-delimiters-depth-2">)</span> + rownum - 1 d
          <span class="org-keyword">from</span> dba_objects
         <span class="org-keyword">where</span> rownum &lt; 32<span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-keyword">where</span> to_char<span class="org-rainbow-delimiters-depth-1">(</span>d, <span class="org-string">'day'</span><span class="org-rainbow-delimiters-depth-1">)</span> = <span class="org-string">'&#26143;&#26399;&#20116;'</span>
   <span class="org-keyword">and</span> d &lt;= last_day<span class="org-rainbow-delimiters-depth-1">(</span>sysdate<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- 2.</span>
<span class="org-keyword">select</span> *
  <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> trunc<span class="org-rainbow-delimiters-depth-2">(</span>sysdate, <span class="org-string">'MON'</span><span class="org-rainbow-delimiters-depth-2">)</span> + <span class="org-keyword">level</span> - 1 d
          <span class="org-keyword">from</span> dual
        <span class="org-keyword">connect</span> <span class="org-keyword">by</span> <span class="org-keyword">level</span> &lt; 32<span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-keyword">where</span> to_char<span class="org-rainbow-delimiters-depth-1">(</span>d, <span class="org-string">'day'</span><span class="org-rainbow-delimiters-depth-1">)</span> = <span class="org-string">'&#26143;&#26399;&#20116;'</span>
   <span class="org-keyword">and</span> d &lt;= last_day<span class="org-rainbow-delimiters-depth-1">(</span>sysdate<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
当然，你也可以将 last_day 这一段放到里面：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> *
  <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> trunc<span class="org-rainbow-delimiters-depth-2">(</span>sysdate, <span class="org-string">'MON'</span><span class="org-rainbow-delimiters-depth-2">)</span> + <span class="org-keyword">level</span> - 1 d
          <span class="org-keyword">from</span> dual
        <span class="org-keyword">connect</span> <span class="org-keyword">by</span> <span class="org-keyword">level</span> &lt;= <span class="org-builtin">extract</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">day</span> <span class="org-keyword">from</span> last_day<span class="org-rainbow-delimiters-depth-3">(</span>sysdate<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-keyword">where</span> to_char<span class="org-rainbow-delimiters-depth-1">(</span>d, <span class="org-string">'d'</span><span class="org-rainbow-delimiters-depth-1">)</span> = 6;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 冷饮</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> 学生管理系统</h3>
<div class="outline-text-3" id="text-3-1">
<p>
根据我们学校的实际情况，请帮助设计一个学生管理系统。
</p>
<pre class="example">
比如, 学生，老师，班级，课程。按照你自己的设计，酌情增加。
</pre>

<p>
基本步骤：
</p>
<ol class="org-ol">
<li>先用 e-r 图，将实体的关系表述出来。

<p>
这样的图能帮助我们理清思路，并能帮助团队间的有效交流。
</p>

<p>
一定在图画好之后再去着手数据库表的创建。要秉承先设计后实现的思路。
</p>

<p>
你可以用一些知名的工具(如 visio)去画，也可以手动在纸上画。
</p>
</li>

<li>根据设计好的图，写出相应的建表语句。
</li>

<li>也可以进一步根据实体关系和表，创建相应的 Java 实体类。进一步可以 DAO，进一步可以 Service【可选】
</li>

<li>最后，将图跟语句一起上交。这个过程着重思考下项目从设计到编码是怎么一个过程。
<pre class="example">
需求分析 -&gt; *概要设计* -&gt; 详细实现。 
</pre>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> 博客管理系统</h3>
<div class="outline-text-3" id="text-3-2">
<p>
首先，设计一个博客表(<code>blog</code>), 至少有下面字段
</p>
<ul class="org-ul">
<li>id
</li>
<li>author
</li>
<li>title
</li>
<li>content(要求是 clob 类型)
</li>
<li>image(要求是 blob 类型)
</li>
<li>create_time
</li>
</ul>

<p>
用 Java 完成基本的 <code>CRUD</code>，并掌握使用 PL/SQL 操作 blob/clob 的技巧。
</p>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> 购物车逻辑的表设计(从设计E-R图开始)</h3>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> 微博/博客系统(从设计E-R图开始)</h3>
</div>
<div id="outline-container-sec-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> 论坛(从设计E-R图开始)</h3>
</div>
</section>
<section id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 体系结构</h2>
<div class="outline-text-2" id="text-4">
<p>
Oracle 采取的是 Client/Server 架构。
</p>


<figure>
<p><img src="assets/dot/oracle_cs.gif" alt="oracle_cs.gif">
</p>
</figure>


<p>
客户端(<code>Client</code>)操作数据库的请求发送后，服务端的监听器(<code>TNSListener</code>)接收到请求，并将其转发给相应的数据库实例(<code>Instance</code>)，再由实例(<code>Instance</code>)去操纵数据库(<code>Database</code>)。
返回操作结果，是一个相反的过程。下面是个简陋的图示:
</p>


<figure>
<p><img src="assets/dot/oracle_construct.gif" alt="oracle_construct.gif">
</p>
</figure>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Client</h3>
<div class="outline-text-3" id="text-4-1">
</div><div id="outline-container-sec-4-1-1" class="outline-4">
<h4 id="sec-4-1-1"><span class="section-number-4">4.1.1</span> Sqlplus</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
这是一个轻量级的功能强大的客户端, 是 dba 必须掌握的工具。
</p>

<p>
用 <code>sqlplus</code> 连接数据库的语法为：
</p>
<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Usage:</span>
<span class="org-comment-delimiter">#   </span><span class="org-comment">sqlplus &#29992;&#25143;&#21517;/&#23494;&#30721;@&#20027;&#26426;&#21517;:&#31471;&#21475;&#21495;/&#23454;&#20363;&#21517;</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#21442;&#25968;&#20010;&#25968;&#19981;&#26159;&#22266;&#23450;&#30340;</span>

sqlplus                         <span class="org-comment-delimiter"># </span><span class="org-comment">&#20250;&#35201;&#27714;&#20320;&#36755;&#20837;&#29992;&#25143;&#21517;&#23494;&#30721;&#65292;&#40664;&#35748;&#36830;&#25509;&#26412;&#22320; ORACLE_SID &#21464;&#37327;&#25351;&#23450;&#30340;&#25968;&#25454;&#24211;</span>
sqlplus vip                     <span class="org-comment-delimiter"># </span><span class="org-comment">&#20250;&#35201;&#27714;&#20320;&#36755;&#20837;&#23494;&#30721;</span>
sqlplus vip/vip                 <span class="org-comment-delimiter"># </span><span class="org-comment">&#36830;&#25509;&#26412;&#22320; ORACLE_SID &#21464;&#37327;&#25351;&#23450;&#30340;&#25968;&#25454;&#24211;</span>

sqlplus sys/hello as sysdba     <span class="org-comment-delimiter"># </span><span class="org-comment">sys &#29992;&#25143;&#24517;&#39035;&#29992; sysdba &#25110; sysoper &#30340;&#36523;&#20221;&#30331;&#24405;</span>

sqlplus vip@192.168.0.111/orcl  <span class="org-comment-delimiter"># </span><span class="org-comment">&#36830;&#25509; 192.168.0.111 &#26426;&#22120;&#19978;&#30340; orcl &#25968;&#25454;&#24211;&#65292;&#29992;&#25143;&#21517;&#20026; vip</span>
sqlplus vip@192db               <span class="org-comment-delimiter"># </span><span class="org-comment">&#36830;&#25509; &#21035;&#21517; &#20026; 192db &#30340;&#25968;&#25454;&#24211;</span>
</pre>
</div>


<p>
我们可以配置 sqlplus 的一些行为，两个命令：
</p>
<ol class="org-ol">
<li>show. 用来显示配置参数
</li>
<li>set.  用来设置配置参数
</li>
</ol>

<p>
比如：
</p>
<pre class="example">
show all               -- 显示所有配置参数
show lines             -- 显示 lines 的配置信息
show errors            -- 显示错误
set lines[ize] 333     -- 将行宽设置为 333
set pages[ize] 444     -- 将每页的记录数设置为 444
set echo off/on        -- 导入外部文件，是否要显示原始 sql 语句
set feedback on/off    -- 是否显示“查询到xx数据”等信息
set timing on/off      -- 是否显示语句的执行时间
set autocommit on/off  -- 是否启用自动提交
set autotrace on/off   -- 是否输出执行计划
set serveroutput on/off-- 是否显示来自服务端的信息
column aaa format a22  -- 将列 'aaa' 的宽度限制为 22 个字幕'a'的大小。column 命令很强大，语句也复杂，此处不提。
</pre>

<p>
在 sqlplus 中有缓冲区的概念:
</p>
<pre class="example">
缓冲区是用来记录上一次执行的命令语句的空间。
</pre>

<p>
我们可以通过一些列简单命令，对上一次输入的语句进行一些控制:
</p>
<ul class="org-ul">
<li>增 <code>append/insert</code>
</li>
<li>删 <code>delete</code>
</li>
<li>改 <code>change</code>
</li>
<li>查 <code>list</code>
</li>
<li>执行修改后的语句 <code>run</code> 或者 <code>/</code>
</li>
</ul>

<p>
例子：
</p>
<pre class="example">
list         -- 显示完整的缓存区
list 3       -- 显示并定位到第三行
list 3 5     -- 显示第三行到第五行的内容
list last    -- 定位到最后一行
</pre>

<pre class="example">
list 3
del               -- 删除第三行
</pre>

<pre class="example">
list 3
append  order by sal  -- 定位到第三行，然后追加 order by sal
insert order by sal   -- 开启新的一行，插入 order by sal
</pre>

<pre class="example">
list 3
change /emp/dept      -- 定位到第三行，将这一行的 emp 换为 dept
</pre>

<p>
还有其他一些命令：
</p>
<pre class="example">
get D:\aaa.sql        -- 将文件加载到缓冲区，但不执行
start D:\aaa.sql      -- 将文件加载到缓冲区，并且执行
@D:\aaa.sql           -- 是上面一条语句的简写形式
save D:\bbb.sql       -- 将缓冲区的内容保存到文件中
edit                  -- 调用外部编辑器，编辑缓冲区
clear screen          -- 清空缓冲区
</pre>

<pre class="example">
show user             -- 显示当前用户
show parameters       -- 显示 oracle 的配置参数
show parameters nls   -- 显示 oracle 中所有跟语言配置相关的一些参数
describe emp          -- 显示 emp 表的结构信息
</pre>
</div>
</div>

<div id="outline-container-sec-4-1-2" class="outline-4">
<h4 id="sec-4-1-2"><span class="section-number-4">4.1.2</span> JDBC</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
用 Java 连接数据库，需要用到 jdbc 驱动，它们可以在下面目录中找到：
</p>
<pre class="example">
主目录\product\12.1.0\dbhome_1\jdbc\lib\*.jar
</pre>

<p>
比如 <code>ojdbc7_g.jar</code>, <code>7</code> 表示适用于 JDK 版本 1.7, <code>g</code> 表示自带更多调试信息。
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> TNSListener</h3>
<div class="outline-text-3" id="text-4-2">
<p>
TNSListener，是用来监听来自客户端的请求，并将其转发给相对应的服务端实例的一种后台服务。
</p>

<p>
它是沟通客户端与服务端的一个桥梁。
</p>

<p>
比如，下面用 <code>sqlplus</code> 客户端将会连接 <code>localhost</code> 上的 <code>orcl</code> 数据库:
</p>
<pre class="example">
sqlplus vip/vip@localhost/orcl
</pre>

<p>
请求会发送到 localhost 主机的 1521 号端口，
作为监听的 TNSListener 收到这个请求后，再把请求转发给对应的 orcl 数据库实例。
</p>

<p>
所以必须开启监听服务，并且配置正确，才能连接操作数据库。
</p>
<pre class="example">
注：如果用 sqlplus vip/vip 的方式连接数据库，即没有指定连接的机器，那么默认连接的是本机数据库
这种连接是不需要监听服务的，因为为了增加连接速度，这样的本地连接 oracle 会使用一个专用的进程直接连接实例
</pre>

<p>
我们可以使用 Oracle 提供的 <code>lsnrctl</code> 命令操纵监听服务的开启或关闭：
</p>
<pre class="example">
lsnrctl status    # 查看状态
lsnrctl stop      # 停止监听服务
lsnrctl start     # 开启监听服务
lsnrctl reload    # 重启监听服务
lsnrctl services  # 查看监听的连接情况
</pre>

<p>
我们可以使用 Oracle 的 Net Manager 工具来配置自己的监听器。
</p>

<p>
实质上，用 Net Manager 配置跟直接修改下面文件的作用是一样的：
</p>
<pre class="example">
主目录\product\12.1.0\dbhome_1\network\admin\listener.ora
</pre>

<p>
我们在 Net Manager 中对 listener 的配置对应的是这一段代码：
</p>
<pre class="example">
LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))
    )
    ...
  )
</pre>

<p>
只要修改其中的 host/port 等，重启监听服务即可。
</p>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Server</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Oracle 服务端分为两部分：
</p>
<ol class="org-ol">
<li><code>Instance</code> 实例
</li>
<li><code>Database</code> 数据库
</li>
</ol>
</div>

<div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> 实例(Instance)</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
<b>实例</b>, 又称为数据库引擎，由 <code>SGA(System Global Area, 系统全局区)</code> 和 <code>一系列后台进程</code> 组成。
它需要启动才会生成，用来加载并管理一个数据库。
</p>

<p>
<b>服务启动的大致过程：</b>
</p>
<ol class="org-ol">
<li>[读取] 读取系统的 ORACLE_SID 环境变量，确定要启动的实例名字，比如为 xxoo
</li>
<li>[加载] 从 <code>$ORABASE/admin/xxoo</code> 和 <code>$ORA_HOME/database/SPFILEXXOO.ora</code> 等位置加载相关配置文件。配置文件的名字是根据 sid 来定义的。
</li>
<li>[启动] 从配置文件中，读取相关信息，比如数据库名字、数据库控制文件位置、SGA 等信息，并根据这些，初始化数据库加载需要的 <code>内存空间(SGA)</code> 和 <code>相关进程</code> 。
</li>
<li>[装载] 根据配置文件中读取的数据库信息，找到各种数据文件位置，并装载数据库。
</li>
<li>[启动] 进行数据校验等，如果没有问题，启动数据库。
</li>
</ol>

<p>
可以通过查看启动过程协助理解：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#39318;&#20808;&#65292;&#30331;&#24405; sys &#29992;&#25143;&#65292;&#21482;&#26377;&#31649;&#29702;&#21592;&#25165;&#26377;&#23436;&#20840;&#25805;&#32437;&#25968;&#25454;&#24211;&#30340;&#26435;&#21147;</span>
<span class="org-comment">-- shutdown &#29992;&#26469;&#20851;&#38381;&#12290;&#22914;&#26524;&#19981;&#24102;&#21442;&#25968;&#65292;&#40664;&#35748;&#20026; normal</span>
<span class="org-comment">---- immediate &#34920;&#31034;&#31435;&#21363;&#20851;&#38381;&#65292;&#22914;&#26524;&#26377;&#26410;&#22788;&#29702;&#23436;&#25805;&#20316;&#65292;&#22238;&#28378;&#24182;&#26029;&#24320;</span>
<span class="org-comment">---- normal &#34920;&#31034;&#31561;&#24453;&#25152;&#26377;&#36830;&#25509;&#26029;&#24320;&#25165;&#20851;&#38381;&#25968;&#25454;&#24211;</span>
<span class="org-comment">---- &#20854;&#20182;&#21442;&#25968;&#65292;&#30053;</span>
shutdown <span class="org-keyword">immediate</span>;

<span class="org-comment">-- &#21551;&#21160;&#25968;&#25454;&#24211;&#65292;&#20998;&#35299;&#20026;&#19977;&#20010;&#21160;&#20316;&#65306;</span>
<span class="org-comment">---- &#21551;&#21160;&#23454;&#20363;</span>
<span class="org-comment">---- &#21033;&#29992;&#21551;&#21160;&#30340;&#23454;&#20363;&#21435;&#25346;&#36733;&#25968;&#25454;&#24211;</span>
<span class="org-comment">---- &#26657;&#39564;&#24182;&#25171;&#24320;&#25968;&#25454;&#24211;</span>
<span class="org-comment">-- &#21482;&#26377;&#23436;&#20840;&#25171;&#24320;&#65292;&#25165;&#33021;&#36827;&#34892;&#23436;&#20840;&#30340;&#25968;&#25454;&#25805;&#20316;</span>
<span class="org-comment">-- &#20063;&#21487;&#20197;&#25351;&#23450;&#21442;&#25968;&#65292;&#21551;&#21160;&#21040;&#26576;&#20010;&#38454;&#27573;&#12290;&#36825;&#26159;&#22312;&#32500;&#25252;&#25968;&#25454;&#24211;&#20013;&#20351;&#29992;&#30340;&#21629;&#20196;&#12290;</span>
startup             <span class="org-comment">-- &#22914;&#26524;&#19981;&#21152;&#21442;&#25968;&#65292;</span>
startup nomount     <span class="org-comment">-- &#21551;&#21160;&#21040; nomount &#38454;&#27573;</span>
startup mount       <span class="org-comment">-- &#21551;&#21160;&#21040; mount &#38454;&#27573;</span>

<span class="org-comment">-- &#24403;&#28982;&#65292;&#20063;&#21487;&#20197;&#36825;&#26679;&#20998;&#27493;&#21551;&#21160;&#65306;</span>
startup nomount
<span class="org-keyword">alter</span> database mount
<span class="org-keyword">alter</span> database <span class="org-keyword">open</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> 数据库(Database)</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
<b>数据库</b>, 是保存在硬盘上的文件集合，它是数据的主要载体。
</p>
<pre class="example">
$OracleBase\oradata\[数据库名字]\
</pre>

<p>
可以从不同的角度去认识数据库，比如物理/逻辑角度：
</p>
</div>
<ol class="org-ol"><li><a id="sec-4-3-2-1" name="sec-4-3-2-1"></a>物理组件<br ><div class="outline-text-5" id="text-4-3-2-1">
<p>
数据库是保存在操作系统的一系列文件。
</p>

<p>
默认安装情况下，这些文件都在 <code>$ORACLE_BASE/oradata</code> 文件夹下：
</p>
<pre class="example">
oradata/
└── orcl [数据库的名字]
    ├── CONTROL01.CTL
    ├── CONTROL02.CTL
    ├── EXAMPLE01.DBF
    ├── REDO01.LOG
    ├── REDO02.LOG
    ├── REDO03.LOG
    ├── SYSAUX01.DBF
    ├── SYSTEM01.DBF
    ├── TEMP01.DBF
    ├── UNDOTBS01.DBF
    └── USERS01.DBF
</pre>

<p>
从文件角度分析，一个数据库包含下面几类（组件）：
</p>
<ol class="org-ol">
<li>控制文件(control file)。记录数据库的物理结构和其他信息，如数据库名称、各种文件位置等。多副本。
<pre class="example">
select * from v$controlfile;
</pre>
</li>
<li>数据文件(data file)。用来存储数据的文件，会自动扩张。数据以块为单位进行保存。
<pre class="example">
select name, status, enabled from v$datafile;
</pre>
</li>
<li>重做日志文件(redo log)。用来记录用户的所有操作，为了备份恢复。
一个数据库至少有两个日志组，每个日志组至少有一个成员，成员之间是镜像关系。
用户的操作会记录到 redo log 中，当一个组记录满了，会自动切换到下一个组。轮流循环。
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#38656;&#35201;&#29702;&#35299; Oracle &#26085;&#24535;&#30340;&#24605;&#36335;:</span>
<span class="org-comment">-- &#23427;&#37319;&#21462;&#20102;&#12304;&#22810;&#20010;&#20998;&#32452;&#65292;&#36718;&#27969;&#24490;&#29615;&#20889;&#20837;&#65307;&#27599;&#32452;&#22810;&#25104;&#21592;&#65292;&#20114;&#20026;&#38236;&#20687;&#65307;&#20445;&#23384;&#26356;&#22810;&#20449;&#24687;&#65292;&#20351;&#29992;&#24402;&#26723;&#27169;&#24335;&#12305;&#30340;&#26041;&#24335;&#65292;&#20445;&#35777;&#20102;&#35760;&#24405;&#23433;&#20840;&#24615;&#12290;</span>
<span class="org-comment">-- &#22312;&#29983;&#20135;&#29615;&#22659;&#20013;&#65292;&#38656;&#35201;&#26085;&#24535;&#35843;&#25972;&#21040;&#19981;&#21516;&#30340;&#30913;&#30424;&#20013;&#65292;&#36825;&#26679;&#65292;&#21363;&#20351;&#26576;&#20010;&#25991;&#20214;&#25439;&#22351;&#65292;&#25110;&#26576;&#22359;&#30913;&#30424;&#25439;&#22351;&#65292;&#37117;&#21487;&#20197;&#36890;&#36807;&#38236;&#20687;&#30340;&#26085;&#24535;&#25991;&#20214;&#23545;&#25968;&#25454;&#36827;&#34892;&#24674;&#22797;&#12290;</span>

<span class="org-comment">-- &#26597;&#30475; redo log &#26085;&#24535;&#32452;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> v$log;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> v$logfile;

<span class="org-comment">-- &#22686;&#21152;/&#21024;&#38500; &#26085;&#24535;&#32452;</span>
<span class="org-keyword">alter</span> database <span class="org-keyword">add</span>  logfile <span class="org-string">'d:/sss.rlog'</span> <span class="org-keyword">size</span> 100m;
<span class="org-keyword">alter</span> database <span class="org-keyword">drop</span> logfile <span class="org-string">'d:/sss.rlog'</span>;

<span class="org-comment">-- &#28165;&#31354;&#26085;&#24535;&#32452;</span>
<span class="org-keyword">alter</span> database clear logfile <span class="org-keyword">group</span> 1;
<span class="org-keyword">alter</span> database clear unarchived logfile <span class="org-keyword">group</span> 1;

<span class="org-comment">-- &#20026;&#26085;&#24535;&#32452; &#22686;&#21152;/&#21024;&#38500; &#25104;&#21592;</span>
<span class="org-keyword">alter</span> database <span class="org-keyword">add</span>  logfile member <span class="org-string">'d:/ssss.log'</span> <span class="org-keyword">to</span> <span class="org-keyword">group</span> 1;
<span class="org-keyword">alter</span> database <span class="org-keyword">drop</span> logfile member <span class="org-string">'d:/ssss.log'</span>;

<span class="org-comment">-- &#37325;&#21629;&#21517;&#25991;&#20214;</span>
<span class="org-comment">-- &#39318;&#20808;&#65292;&#22312;&#25991;&#20214;&#22841;&#31649;&#29702;&#22120;&#37324;&#65292;&#23558;&#25991;&#20214;&#25913;&#21517;&#65292;&#27604;&#22914;&#65292;&#25913;&#20026; ssss.redolog</span>
<span class="org-comment">-- &#20854;&#27425;&#65292;&#37325;&#21551;&#25968;&#25454;&#24211;&#21040; mount &#29366;&#24577;&#65292;&#28982;&#21518;&#25191;&#34892;&#37325;&#21629;&#21517;&#21629;&#20196;</span>
<span class="org-keyword">alter</span> database rename file <span class="org-string">'d:/ssss.log'</span> <span class="org-keyword">to</span> <span class="org-string">'d:/ssss.redolog'</span>;

<span class="org-comment">-- &#26085;&#24535;&#32452;&#19968;&#33324;&#26159;&#22312;&#20889;&#28385;&#30340;&#26102;&#20505;&#33258;&#21160;&#20999;&#25442;&#12290;</span>
<span class="org-comment">-- &#25105;&#20204;&#20063;&#21487;&#20197;&#25163;&#21160;&#20999;&#25442;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">system</span> switch logfile;
</pre>
</div>
</li>
<li>归档日志文件。是重做日志的补充（redo log 记录的记录是有限的），可以把写满的 redo log 进行备份。
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- Oracle &#30340;&#24402;&#26723;&#27169;&#24335;&#40664;&#35748;&#26159;&#20851;&#38381;&#30340;</span>
<span class="org-comment">-- &#24402;&#26723;&#27169;&#24335;&#20250;&#21344;&#29992;&#22823;&#37327;&#31354;&#38388;</span>
<span class="org-comment">-- &#20294;&#20182;&#20204;&#29992;&#26356;&#22810;&#30340;&#31354;&#38388;&#65292;&#20445;&#23384;&#26356;&#22810;&#30340;&#21382;&#21490;&#35760;&#24405;&#65292;&#20445;&#38556;&#26356;&#22823;&#30340;&#23433;&#20840;&#24615;</span>

<span class="org-comment">-- &#26597;&#30475;&#29366;&#24577;</span>
archive log list;

<span class="org-comment">-- &#20999;&#25442;&#25968;&#25454;&#24211;&#21040;&#24402;&#26723;&#27169;&#24335;</span>
<span class="org-keyword">alter</span> database archivelog;

<span class="org-comment">-- &#21551;&#21160;</span>
archive log <span class="org-keyword">start</span>;

<span class="org-comment">-- &#26597;&#30475;&#29366;&#24577;</span>
archive log list;
</pre>
</div>
</li>
<li>其他文件
</li>
</ol>
</div>
</li>

<li><a id="sec-4-3-2-2" name="sec-4-3-2-2"></a>逻辑组件<br ><div class="outline-text-5" id="text-4-3-2-2">
<p>
<a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/physical.htm#CNCPT1082">https://docs.oracle.com/cd/B28359_01/server.111/b28318/physical.htm#CNCPT1082</a>
</p>

<p>
从 Oracle 内部管理数据的角度，可以将 Oracle 分为4个组件：
</p>
<ol class="org-ol">
<li>表空间(tablespace)
<ul class="org-ul">
<li>最基本的逻辑结构，是 Oracle 中进行数据恢复的最小单位，容纳着表、索引等对象
</li>
<li>数据库是由若干表空间组成的。一个表空间至少对应一个物理文件。
</li>
<li>实际开发中，不建议使用默认表空间。请为自己的业务创建自己的表空间。
</li>
</ul>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#20869;&#32622;&#30340;&#21508;&#31181;&#34920;&#31354;&#38388;</span>
<span class="org-comment">---- system/sysaux &#31995;&#32479;&#34920;&#31354;&#38388;/&#31995;&#32479;&#36741;&#21161;&#34920;&#31354;&#38388;&#65292;&#29992;&#26469;&#20445;&#23384;&#31995;&#32479;&#23383;&#20856;&#34920;&#21644;&#20854;&#20182;&#20449;&#24687;&#65292;&#25968;&#25454;&#24211;&#21019;&#24314;&#23436;&#20250;&#33258;&#21160;&#29983;&#25104;</span>
<span class="org-comment">---- users &#29992;&#25143;&#34920;&#31354;&#38388;&#65292;&#21019;&#24314;&#26032;&#29992;&#25143;&#26102;&#65292;&#40664;&#35748;&#20351;&#29992;&#30340;&#34920;&#31354;&#38388;</span>
<span class="org-comment">---- temp &#20020;&#26102;&#34920;&#31354;&#38388;</span>
<span class="org-comment">---- undo &#22238;&#28378;&#34920;&#31354;&#38388;</span>

<span class="org-comment">-- &#26597;&#30475;&#34920;&#31354;&#38388;&#20449;&#24687;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> v$tablespace;

<span class="org-comment">-- &#26597;&#30475;&#25152;&#26377;&#34920;&#31354;&#38388;&#36319;&#25991;&#20214;&#23545;&#24212;&#20851;&#31995;</span>
<span class="org-keyword">SELECT</span>  FILE_NAME, BLOCKS, TABLESPACE_NAME <span class="org-keyword">from</span> dba_data_files;

<span class="org-comment">-- &#21019;&#24314;&#34920;&#31354;&#38388;</span>
<span class="org-keyword">create</span> tablespace xxx
  datafile   <span class="org-string">'D:/sss.dbf'</span>
  <span class="org-keyword">size</span>       50m
  autoextend <span class="org-keyword">on</span>
  <span class="org-keyword">next</span>       50m
  maxsize    1024m;

<span class="org-comment">-- &#21019;&#24314;&#20020;&#26102;&#34920;&#31354;&#38388;</span>
<span class="org-keyword">create</span> <span class="org-keyword">temporary</span> tablespace yyy
  tempfile <span class="org-string">'D:/ANOTHER_TMP.dbf'</span>
  <span class="org-keyword">size</span> 5m;

<span class="org-comment">-- &#21024;&#38500;&#34920;&#31354;&#38388;</span>
<span class="org-keyword">drop</span> tablespace xxx;
</pre>
</div>
</li>
<li>段(Segment)
<ul class="org-ul">
<li>段是对象在数据库中占用的空间
</li>
<li>包括索引段、数据段等
</li>
<li>表空间被划分为若干区域，每个区域负责存放不同类型数据，这些区域这就是段
</li>
</ul>
</li>
<li>区(Extend)
<ul class="org-ul">
<li>由连续的数据块组成，由 Oracle 自动分配管理
</li>
<li>会自动扩展大小
</li>
</ul>
</li>
<li>块(Block)
<ul class="org-ul">
<li>数据块是 Oracle 数据库最小的逻辑单元
</li>
<li>它代表在读写操作的时候，每次处理的数据大小是多少
</li>
<li>正常情况下，它是操作系统块的整数倍，默认是 8 KB
</li>
<li>可以通过参数 db_block_size 控制
<pre class="example">
show parameters block;
</pre>
</li>
</ul>
</li>
</ol>


<figure>
<p><img src="assets/image/database-oracle/oracle_logic_2017-08-17_14-33-06.jpg" alt="oracle_logic_2017-08-17_14-33-06.jpg">
</p>
</figure>
</div>
</li></ol>
</div>
</div>
</section>

<section id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 用户权限</h2>
<div class="outline-text-2" id="text-5">
<p>
安装完 Oracle，缺省有两个用户：
</p>
<ol class="org-ol">
<li><code>SYS</code> 用户，又叫数据库系统管理员、特权用户，数据库中至高无上的存在。
<ul class="org-ul">
<li>它是数据库的系统管理员，负责数据库的安装、维护、升级、备份、恢复、优化等操作。
</li>
<li>在它之下，保存着数据库所有的系统字典。
</li>
<li>不能用 normal 身份登录，必须用 SYSDBA/SYSOPER 身份登录。
</li>
</ul>
</li>
<li><code>SYSTEM</code> 用户，数据库管理员，它拥有 DBA 角色，主要负责对数据库中各种对象，各种资源的管理。
</li>
<li><code>SCOTT</code> 用户，一个示例用户，默认是锁定的，需要解锁使用。
</li>
</ol>

<p>
新创建的用户，是不能做任何事情的（甚至不能登录）。
必须要为用户授予权限，才能做相应的事情。
可以说，用户是权限的容器。
</p>

<p>
权限分为两种：
</p>

<figure>
<p><img src="assets/dot/oracle_privs.jpg" alt="oracle_privs.jpg">
</p>
</figure>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 用户(User)</h3>
<div class="outline-text-3" id="text-5-1">
<p>
用户是用于 <b>资源管理</b> 和 <b>权限控制</b> 的一个概念。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21019;&#24314;&#29992;&#25143;&#30340;&#35821;&#27861;</span>
<span class="org-keyword">CREATE</span> <span class="org-builtin">USER</span> <span class="org-keyword">name</span>
  IDENTIFIED <span class="org-keyword">BY</span> password          <span class="org-comment">-- &#19968;&#20010;&#29992;&#25143;&#65292;&#33267;&#23569;&#25317;&#26377;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;</span>
  <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-keyword">DEFAULT</span> TABLESPACE users<span class="org-rainbow-delimiters-depth-1">]</span>      <span class="org-comment">-- &#25351;&#23450;&#27492;&#29992;&#25143;&#19979;&#25968;&#25454;&#40664;&#35748;&#20445;&#23384;&#20301;&#32622;&#65292;&#22914;&#26524;&#19981;&#25351;&#23450;&#65292;&#40664;&#35748;&#20026; Users &#34920;&#31354;&#38388;</span>
  <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-keyword">TEMPORARY</span> TABLESPACE temp<span class="org-rainbow-delimiters-depth-1">]</span>     <span class="org-comment">-- &#25351;&#23450;&#20020;&#26102;&#34920;&#31354;&#38388;&#65292;&#40664;&#35748;&#20026; temp &#34920;&#31354;&#38388;</span>
  <span class="org-rainbow-delimiters-depth-1">[</span>QUOTA 100M/unlimited <span class="org-keyword">ON</span> USERS<span class="org-rainbow-delimiters-depth-1">]</span> <span class="org-comment">-- &#22312;&#34920;&#31354;&#38388;&#19978;&#26377;&#22810;&#23569;&#31354;&#38388;&#30340;&#20351;&#29992;&#26435;&#21147;&#65292;&#40664;&#35748;&#20026; 0, unlimited &#34920;&#31034;&#26080;&#19978;&#38480;</span>
  <span class="org-rainbow-delimiters-depth-1">[</span>ACCOUNT LOCK/UNLOCK<span class="org-rainbow-delimiters-depth-1">]</span>           <span class="org-comment">-- &#36134;&#21495;&#30340;&#21021;&#22987;&#29366;&#24577;&#65306;&#38145;&#23450;/&#26410;&#38145;&#23450;&#65292;&#40664;&#35748;&#20026;&#26410;&#38145;&#23450;</span>
  <span class="org-rainbow-delimiters-depth-1">[</span>PASSWORD EXPIRE<span class="org-rainbow-delimiters-depth-1">]</span>               <span class="org-comment">-- &#36134;&#21495;&#30340;&#21021;&#22987;&#29366;&#24577;&#65306;&#24378;&#21046;&#35201;&#27714;&#37325;&#35774;&#23494;&#30721;&#65292;&#40664;&#35748;&#19981;&#24378;&#21046;</span>
  <span class="org-rainbow-delimiters-depth-1">[</span>PROFILE <span class="org-keyword">DEFAULT</span><span class="org-rainbow-delimiters-depth-1">]</span>               <span class="org-comment">-- &#25351;&#23450;&#20351;&#29992;&#30340;&#36164;&#28304;&#25991;&#20214;&#65292;&#40664;&#35748;&#26159; default</span>
;

<span class="org-comment">-- &#20462;&#25913;&#29992;&#25143;&#30340;&#35821;&#27861;</span>
<span class="org-keyword">ALTER</span> <span class="org-builtin">USER</span> <span class="org-keyword">name</span> <span class="org-rainbow-delimiters-depth-1">[</span>&#36319;&#21019;&#24314;&#29992;&#25143;&#30340;&#21442;&#25968;&#26159;&#19968;&#26679;&#30340;<span class="org-rainbow-delimiters-depth-1">]</span>;

<span class="org-comment">-- &#21024;&#38500;&#29992;&#25143;&#30340;&#35821;&#27861;</span>
<span class="org-keyword">DROP</span> <span class="org-builtin">USER</span> <span class="org-keyword">name</span> <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-keyword">cascade</span><span class="org-rainbow-delimiters-depth-1">]</span>;
</pre>
</div>

<p>
为了对用户行为有更精细的控制，需要使用 <b>资源文件</b> (<code>profile</code>)。
资源文件是口令限制、资源限制的命名集合。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#22686;&#21152;&#36164;&#28304;&#25991;&#20214;&#30340;&#35821;&#27861;</span>
<span class="org-keyword">CREATE</span> PROFILE <span class="org-keyword">name</span> <span class="org-keyword">LIMIT</span>
  RESOURCE_&#21442;&#25968; n/unlimited/<span class="org-keyword">default</span>  <span class="org-comment">-- &#25511;&#21046;&#30340;&#26159;&#36164;&#28304;&#30340;&#21344;&#29992;</span>
  PASSWORD_&#21442;&#25968;;                     <span class="org-comment">-- &#25511;&#21046;&#30340;&#26159;&#23494;&#30721;&#30340;&#20351;&#29992;</span>

<span class="org-comment">-- &#20462;&#25913;&#36164;&#28304;&#25991;&#20214;&#30340;&#35821;&#27861;</span>
<span class="org-keyword">ALTER</span> PROFILE <span class="org-keyword">name</span> ...;

<span class="org-comment">-- &#21024;&#38500;&#36164;&#28304;&#25991;&#20214;&#30340;&#35821;&#27861;</span>
<span class="org-keyword">DROP</span> PROFILE <span class="org-keyword">name</span>;

<span class="org-comment">-- &#20026;&#29992;&#25143;&#25351;&#23450;&#36164;&#28304;&#25991;&#20214;</span>
<span class="org-keyword">ALTER</span> <span class="org-builtin">USER</span> <span class="org-keyword">name</span> PROFILE profile_name;
</pre>
</div>

<p>
常用资源文件选项：
</p>
<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">名字</th>
<th scope="col" class="left">类型</th>
<th scope="col" class="left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">SESSIONS_PER_USER</td>
<td class="left">resource</td>
<td class="left">每个用户最多能创建的连接数</td>
</tr>

<tr>
<td class="left">CONNECT_TIME</td>
<td class="left">resource</td>
<td class="left">每个连接最多能保持的时间(分钟)</td>
</tr>

<tr>
<td class="left">IDLE_TIME</td>
<td class="left">resource</td>
<td class="left">每个连接不操作多长时间自动断开(分钟)</td>
</tr>

<tr>
<td class="left">CPU_PER_SESSION</td>
<td class="left">resource</td>
<td class="left">每个连接最多能占用的 CPU 时间(百分之一秒)</td>
</tr>

<tr>
<td class="left">LOGICAL_READS_PER_SESSION</td>
<td class="left">resource</td>
<td class="left">每个连接最多能读取的数据块</td>
</tr>

<tr>
<td class="left">PRIVATE_SGA</td>
<td class="left">resource</td>
<td class="left">最多占用的 SGA 大小</td>
</tr>

<tr>
<td class="left">PASSWORD_LIFE_TIME</td>
<td class="left">password</td>
<td class="left">限制指定时间中必须重新修改密码(天)</td>
</tr>

<tr>
<td class="left">PASSWORD_REUSE_TIME/MAX</td>
<td class="left">password</td>
<td class="left">密码重用的限制</td>
</tr>

<tr>
<td class="left">FAILED_LOGIN_ATTEMPTS</td>
<td class="left">password</td>
<td class="left">允许的密码输错次数</td>
</tr>

<tr>
<td class="left">PASSWORD_LOCK_TIME</td>
<td class="left">password</td>
<td class="left">因输错密码锁定的天数(天)</td>
</tr>

<tr>
<td class="left">PASSWORD_VERIFY_FUNCTION</td>
<td class="left">password</td>
<td class="left">用于自定义密码验证</td>
</tr>
</tbody>
</table>


<p>
操作示例：
</p>
<div class="org-src-container">

<pre class="src src-sql"> <span class="org-comment">-- &#25152;&#26377;&#30340;&#29992;&#25143;&#20449;&#24687;&#65292;&#20445;&#23384;&#22312;&#23383;&#20856;&#34920; dba_users &#37324;&#38754;</span>
 <span class="org-keyword">select</span> * <span class="org-keyword">from</span> dba_users <span class="org-keyword">where</span> USERNAME=<span class="org-string">'VIP'</span>;
 <span class="org-comment">-- &#25152;&#26377;&#30340;&#36164;&#28304;&#25991;&#20214;&#20449;&#24687;&#65292;&#20445;&#23384;&#22312; dba_profiles &#37324;&#38754;</span>
 <span class="org-keyword">select</span> * <span class="org-keyword">from</span> dba_profiles <span class="org-keyword">where</span> profile=<span class="org-string">'DEFAULT'</span>;


 <span class="org-comment">-- &#21019;&#24314;&#29992;&#25143;&#30340;&#26368;&#22522;&#26412;&#35821;&#21477;&#65292;&#38656;&#35201;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;</span>
 <span class="org-comment">-- &#20854;&#20182;&#23646;&#24615;&#37319;&#29992;&#30340;&#37117;&#26159;&#40664;&#35748;&#20540;</span>
 <span class="org-keyword">create</span> <span class="org-builtin">user</span> vip identified <span class="org-keyword">by</span> vip;


 <span class="org-comment">-- &#20877;&#19968;&#20010;&#31245;&#24494;&#22797;&#26434;&#19968;&#28857;&#30340;&#21019;&#24314;&#35821;&#21477;</span>
 <span class="org-keyword">create</span> <span class="org-builtin">user</span> vip
   identified <span class="org-keyword">by</span> vip
   <span class="org-keyword">default</span> tablespace users
   <span class="org-keyword">temporary</span> <span class="org-keyword">temporary</span> temp
   quota unlimited <span class="org-keyword">on</span> users
   password expire;


 <span class="org-comment">-- &#22312;&#23454;&#38469;&#29615;&#22659;&#20013;&#65292;&#19968;&#20010;&#33391;&#22909;&#30340;&#20064;&#24815;&#26159;&#65306;</span>
 <span class="org-comment">-- &#20026;&#25105;&#20204;&#26032;&#24314;&#30340;&#29992;&#25143;&#21019;&#24314;&#29420;&#31435;&#30340;&#34920;&#31354;&#38388;</span>
 <span class="org-keyword">create</span> tablespace db_vip
   datafile <span class="org-string">'d:/db_vip.dbf'</span>
   <span class="org-keyword">size</span> 50m;

 <span class="org-keyword">create</span> <span class="org-builtin">user</span> vip
   identified <span class="org-keyword">by</span> vip
   <span class="org-keyword">default</span> tablespace db_vip
   quota unlimited <span class="org-keyword">on</span> db_vip
   password expire;


 <span class="org-comment">-- &#22914;&#26524;&#24819;&#23545;&#29992;&#25143;&#20570;&#19968;&#20123;&#38480;&#21046;</span>
 <span class="org-comment">-- &#38656;&#35201;&#20026;&#23427;&#21019;&#24314;&#30456;&#24212;&#30340;&#36164;&#28304;&#25991;&#20214;</span>
 <span class="org-keyword">create</span> profile vip_profile <span class="org-keyword">limit</span>
   failed_login_attempts 3
   password_life_time    unlimited
   sessions_per_user     2;

<span class="org-comment">-- &#23558;&#36164;&#28304;&#25991;&#20214;&#20998;&#37197;&#32473;&#29992;&#25143;&#65292;&#20063;&#21487;&#20197;&#22312;&#21019;&#24314;&#29992;&#25143;&#30340;&#26102;&#20505;&#25351;&#23450;</span>
 <span class="org-keyword">alter</span> <span class="org-builtin">user</span> profile vip_profile;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> 权限(Privilege)</h3>
<div class="outline-text-3" id="text-5-2">
<p>
<b>权限指的是执行特定命令或访问数据库对象的权利，分为系统权限和对象权限。</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#25480;&#26435;</span>
<span class="org-comment">-- with admin option &#21487;&#20197;&#20801;&#35768;&#33719;&#24471;&#26435;&#38480;&#30340;&#29992;&#25143;&#21487;&#20197;&#23558;&#36825;&#20010;&#26435;&#38480;&#32487;&#32493;&#25480;&#20104;&#21035;&#20154;</span>
<span class="org-keyword">GRANT</span> &#26435;&#38480; <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-keyword">ON</span> &#23545;&#35937;<span class="org-rainbow-delimiters-depth-1">]</span> <span class="org-keyword">TO</span> &#35841; <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-keyword">WITH</span> <span class="org-keyword">ADMIN</span> <span class="org-keyword">OPTION</span><span class="org-rainbow-delimiters-depth-1">]</span>;

<span class="org-comment">-- &#25764;&#38144;&#25480;&#26435;</span>
<span class="org-keyword">REVOKE</span> &#26435;&#38480; <span class="org-keyword">FROM</span> &#35841;;

<span class="org-comment">-- &#21019;&#24314;&#35282;&#33394;</span>
<span class="org-keyword">CREATE</span> <span class="org-keyword">ROLE</span> &#35282;&#33394;&#21517;;
</pre>
</div>

<p>
操作示例：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#23545;&#35937;&#26435;&#38480;&#26377; select/insert/update/delete/alter/execute &#31561;</span>
<span class="org-comment">-- &#31995;&#32479;&#20013;&#25152;&#26377;&#30340;&#31995;&#32479;&#26435;&#38480;&#21644;&#35282;&#33394;&#20445;&#23384;&#22312;&#30456;&#20851;&#23383;&#20856;&#34920;&#20013;:</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> system_privilege_map;  <span class="org-comment">-- &#21015;&#20986;&#31995;&#32479;&#20013;&#25152;&#26377;&#30340;&#31995;&#32479;&#26435;&#38480;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dba_role;              <span class="org-comment">-- &#21015;&#20986;&#31995;&#32479;&#20013;&#25152;&#26377;&#30340;&#35282;&#33394;</span>


<span class="org-comment">-- &#26597;&#30475;&#24050;&#25480;&#20104;&#30340;&#26435;&#38480;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dba_sys_privs <span class="org-keyword">where</span> grantee=<span class="org-string">'VIP'</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dba_tab_privs <span class="org-keyword">where</span> grantee=<span class="org-string">'VIP'</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dba_role_privs <span class="org-keyword">where</span> grantee=<span class="org-string">'VIP'</span>;


<span class="org-comment">--- &#20851;&#20110;&#26435;&#38480;&#30340;&#31649;&#29702;</span>
<span class="org-comment">-- &#26032;&#24314;&#29992;&#25143;&#20808;</span>
<span class="org-keyword">create</span> <span class="org-builtin">user</span> vip identified <span class="org-keyword">by</span> vip quota 1m <span class="org-keyword">on</span> users;
<span class="org-comment">-- &#26032;&#29992;&#25143;&#20160;&#20040;&#37117;&#24178;&#19981;&#20102;&#65292;&#29978;&#33267;&#19981;&#33021;&#30331;&#24405;&#65292;&#22914;&#26524;&#24819;&#35753;&#23427;&#21487;&#20197;&#30331;&#24405;&#65292;&#32473;&#23427;&#19968;&#20010;&#30456;&#24212;&#26435;&#38480;&#65306;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">create</span> <span class="org-keyword">session</span> <span class="org-keyword">to</span> vip;
<span class="org-comment">-- &#29616;&#22312;&#21487;&#20197;&#30331;&#24405; vip &#20102;&#12290;&#20294;&#26159;&#19981;&#33021;&#21019;&#24314;&#34920;&#65292;&#38656;&#35201;&#25105;&#20204;&#32473;&#19968;&#20010;&#30456;&#24212;&#26435;&#38480;&#65306;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-keyword">to</span> vip;
<span class="org-comment">-- &#29616;&#22312;&#65292;&#21487;&#20197;&#21019;&#24314;&#34920;&#20102;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">aaa</span> <span class="org-rainbow-delimiters-depth-1">(</span>i <span class="org-type">int</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> aaa <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>888<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">commit</span>;
<span class="org-comment">-- &#19978;&#38754;&#21019;&#24314;&#29992;&#25143;&#12289;&#25480;&#26435;&#30340;&#35821;&#21477;&#21487;&#20197;&#32553;&#20889;&#20026;&#65306;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">create</span> <span class="org-keyword">session</span>, <span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-keyword">to</span> vip identified vip quota 1m <span class="org-keyword">on</span> <span class="org-builtin">user</span>;
<span class="org-comment">-- &#33258;&#24049;&#21019;&#24314;&#30340;&#34920;&#65292;&#33258;&#24049;&#20250;&#26377;&#23436;&#20840;&#30340;&#25805;&#20316;&#26435;&#21147;&#65292;&#20294;&#22914;&#26524;&#24819;&#35201;&#30475;&#21035;&#30340;&#29992;&#25143;&#30340;&#34920;&#65292;&#38656;&#35201;&#25480;&#26435;&#65306;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">select</span> <span class="org-keyword">on</span> scott.emp <span class="org-keyword">to</span> vip;
<span class="org-comment">-- &#19978;&#38754;&#23601;&#26377;&#20102;&#26597;&#35810;&#30340;&#26435;&#38480;&#12290;&#20294;&#19981;&#33021;&#20462;&#25913;&#12290;&#22914;&#26524;&#35201;&#20462;&#25913;&#65292;&#38656;&#35201;&#30456;&#24212;&#26435;&#38480;&#12290;&#24403;&#28982;&#65292;&#22914;&#26524;&#24819;&#25226;&#23545;&#35937;&#19978;&#30340;&#25152;&#26377;&#26435;&#21147;&#19968;&#24182;&#25480;&#20104;&#65292;&#38656;&#35201;&#29992;&#21040; All:</span>
<span class="org-keyword">grant</span> <span class="org-keyword">all</span> <span class="org-keyword">on</span> scott.emp <span class="org-keyword">to</span> vip;
<span class="org-comment">-- &#36890;&#36807;&#19979;&#38754;&#35821;&#21477;&#65292;&#21487;&#20197;&#30475;&#21040;&#23545;&#35937;&#26435;&#38480;&#30340;&#25480;&#20104;&#24773;&#20917;&#65306;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dba_tab_privs <span class="org-keyword">where</span> grantee=<span class="org-string">'VIP'</span>;
</pre>
</div>

<p>
<b>角色是权限的命名集合，它可以简化授权。</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21019;&#24314;&#35282;&#33394;</span>
<span class="org-keyword">create</span> <span class="org-keyword">role</span> myrole;
<span class="org-comment">-- &#23558;&#26435;&#38480;&#36171;&#20104;&#35282;&#33394;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">create</span> <span class="org-keyword">session</span>, <span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-keyword">to</span> myrole;
<span class="org-keyword">grant</span> <span class="org-keyword">create</span> <span class="org-keyword">view</span> <span class="org-keyword">to</span> myrole;
<span class="org-comment">-- &#29978;&#33267;&#21487;&#20197;&#23558;&#21478;&#19968;&#20010;&#35282;&#33394;&#36171;&#20104;&#25105;&#20204;&#30340;&#35282;&#33394;</span>
<span class="org-keyword">grant</span> resource <span class="org-keyword">to</span> myrole;
<span class="org-comment">-- &#20351;&#29992;&#35282;&#33394;</span>
<span class="org-keyword">grant</span> myrole <span class="org-keyword">to</span> vip;
<span class="org-keyword">grant</span> myrole <span class="org-keyword">to</span> vip <span class="org-keyword">with</span> <span class="org-keyword">admin</span> <span class="org-keyword">option</span>;
<span class="org-comment">-- &#21024;&#38500;&#35282;&#33394;</span>
<span class="org-keyword">drop</span> <span class="org-keyword">role</span> myrole;
</pre>
</div>

<p>
<b>[Oracle 预定义角色]</b> Oracle 自带了很多角色，常用的有：
</p>
<ol class="org-ol">
<li>CONNECT，只包含了 create session 等权限，即登录系统的权限
<pre class="example">
select * from dba_sys_privs where grantee='CONNECT';
</pre>
</li>
<li>RESOURCE，包含了若干 create xxx 权限，即创建对象、创建资源的权限
<pre class="example">
select * from dba_sys_privs where grantee=RESOURCE';
</pre>
</li>
<li>DBA，包含了200多个系统权限，是用来进行系统管理的角色
<pre class="example">
grant connect, resource to A_Common_User;
grant dba to A_Super_User;
</pre>
</li>
</ol>

<p>
<b>[特殊的 PUBLIC 角色]</b> 公用角色，默认是授予每个用户的。
</p>
<pre class="example">
grant connect to public;  -- 这样，不需要进行任何其他操作，所有新建的用户就都拥有登录的功能了。
</pre>

<p>
<b>[最小权限原则]</b> 我们开发的时候，为了方便，经常要做这样的操作：
</p>
<pre class="example">
grant dba to xxx identified by yyy;  -- 创建一个用户 xxx，密码为 yyy，授予 dba 角色
</pre>

<p>
但这权力太大，在正式环境中，这样的授权是非常不合适的。一般要遵守 <code>最小权限原则</code>, 也就是：
</p>
<pre class="example">
创建一个用户，授予能完成任务的尽量少的权限，多一个也不好。
</pre>


<p>
比如，我们有客户需要查看 vip 用户下的 student 表，我们需要创建一个用户给他：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#31532;&#19968;&#27493;&#65292;&#20026;&#23458;&#25143;&#38656;&#27714;&#21019;&#24314;&#19968;&#20010;&#29992;&#25143;</span>
<span class="org-keyword">create</span> <span class="org-builtin">user</span> guest identified <span class="org-keyword">by</span> ***;

<span class="org-comment">-- &#31532;&#20108;&#27493;&#65292;&#25480;&#20104;&#36830;&#25509;&#25968;&#25454;&#24211;&#30340;&#26435;&#38480;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">connect</span> <span class="org-keyword">to</span> guest;

<span class="org-comment">-- &#31532;&#19977;&#27493;&#65292;&#25480;&#20104; vip.student &#30340; select &#26435;&#38480;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">select</span> <span class="org-keyword">on</span> vip.student <span class="org-keyword">to</span> guest;


<span class="org-comment">-- &#24403;&#28982;&#65292;&#19978;&#38754;&#21487;&#20197;&#20877;&#31616;&#21270;&#20026;&#20197;&#19979;&#12290;That's All.</span>
<span class="org-keyword">grant</span> <span class="org-keyword">connect</span> <span class="org-keyword">to</span> guest identified <span class="org-keyword">by</span> ***;
<span class="org-keyword">grant</span> <span class="org-keyword">select</span> <span class="org-keyword">on</span> vip.student <span class="org-keyword">to</span> guest;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> SQL 语句</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Data Type</h3>
<div class="outline-text-3" id="text-6-1">

<figure>
<p><img src="assets/dot/oracle_dataType.jpg" alt="oracle_dataType.jpg">
</p>
</figure>

<p>
查看数据所占空间的两个函数：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#26597;&#30475;&#25152;&#21344;&#23383;&#33410;&#25968;</span>
<span class="org-keyword">select</span> <span class="org-keyword">length</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#20320;&#22909;&#65292;&#19990;&#30028;'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-comment">-- &#26597;&#30475;&#25152;&#21344;&#23383;&#31526;&#25968;&#65292;&#21363;&#22810;&#23569;&#20010;&#23383;&#27597;&#65292;&#22810;&#23569;&#20010;&#27721;&#23383;</span>
<span class="org-keyword">select</span> lengthb<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24744;&#22909;&#65292;&#32654;&#22899;'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;

<span class="org-comment">-- &#27604;&#22914;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">aaa</span> <span class="org-rainbow-delimiters-depth-1">(</span>a varchar2<span class="org-rainbow-delimiters-depth-2">(</span>6<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> aaa <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'aaa'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> aaa <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#20320;&#22909;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> a, <span class="org-keyword">length</span><span class="org-rainbow-delimiters-depth-1">(</span>a<span class="org-rainbow-delimiters-depth-1">)</span>, lengthb<span class="org-rainbow-delimiters-depth-1">(</span>a<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> aaa;
</pre>
</div>
</div>

<div id="outline-container-sec-6-1-1" class="outline-4">
<h4 id="sec-6-1-1"><span class="section-number-4">6.1.1</span> 字符类型</h4>
<div class="outline-text-4" id="text-6-1-1">
<ul class="org-ul">
<li>char，固定长度，默认1，最大2000，如果长度不够，用空格填充。
</li>
<li>varchar2 类型，变长字符串，最多4000字节长度。
</li>
<li>nvarchar2，跟上面比，增加了字符集的支持。
</li>
<li>long，用于存储大数据，最多 2G。不建议使用，已被 clob 类型替代。

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#23427;&#30340;&#20351;&#29992;&#36319; SQL &#30340;&#26631;&#20934; varchar &#22522;&#26412;&#31867;&#20284;&#65292;</span>
<span class="org-comment">-- &#20294;&#26159;&#65292;&#22312; Oracle &#20013;&#35831;&#20351;&#29992; varchar2 &#32780;&#19981;&#26159; varchar&#65292;</span>
<span class="org-comment">-- varchar2 &#30340;&#25928;&#29575;&#26356;&#39640;&#65292;&#24182;&#19988;&#22312;&#20860;&#23481;&#24615;&#19978;&#20570;&#30340;&#26356;&#22909;</span>
<span class="org-comment">-- &#21021;&#22987;&#21270;&#30340;&#35821;&#21477;&#20026;&#65306; name varchar2(20)</span>
<span class="org-comment">-- &#20854;&#20013; 20 &#20195;&#34920;&#26368;&#22823;&#38271;&#24230;&#65292; &#40664;&#35748;&#21333;&#20301;&#26159;&#23383;&#33410;&#12290;</span>
<span class="org-comment">-- &#22914;&#26524;&#23450;&#20041;&#20026;&#65306; name varchar2(20 char)&#65292;&#34920;&#31034;&#26368;&#22823;&#20445;&#23384;20&#20010;&#23383;&#31526;&#38271;&#24230;&#30340;&#23383;&#31526;&#20018;&#12290;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">aaa</span> <span class="org-rainbow-delimiters-depth-1">(</span>
   a varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>,        <span class="org-comment">-- &#26368;&#22823;&#26159;20&#20010;&#23383;&#33410;&#38271;&#24230;&#65292;&#40664;&#35748;&#21333;&#20301;&#23383;&#33410;</span>
   b varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20 byte<span class="org-rainbow-delimiters-depth-2">)</span>,   <span class="org-comment">-- &#26368;&#22823;&#20026;20&#20010;&#23383;&#33410;&#38271;&#24230;&#65292;&#36319;&#19978;&#38754;&#26159;&#19968;&#26679;&#30340;</span>
   c varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20 <span class="org-type">char</span><span class="org-rainbow-delimiters-depth-2">)</span>    <span class="org-comment">-- &#26368;&#22823;&#20026;20&#20010;&#23383;&#31526;&#38271;&#24230;</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- varchar2 &#26368;&#22823;&#33021;&#20445;&#23384; 4000 &#20010;&#23383;&#33410;</span>
<span class="org-comment">-- &#22914;&#26524;&#26159;&#33521;&#25991;&#65292;&#21017;&#26159; 4000 &#20010;&#33521;&#25991;&#23383;&#27597;</span>
<span class="org-comment">-- &#22914;&#26524;&#26159;&#20013;&#25991;&#65292;&#38656;&#35201;&#25353;&#29031;&#23383;&#31526;&#38598;&#21028;&#26029;&#65306;</span>
<span class="org-comment">--   GBK &#29992;&#20004;&#20010;&#23383;&#33410;&#34920;&#31034;&#19968;&#20010;&#27721;&#23383;&#65292;&#25152;&#20197; varchar2 &#26368;&#22810;&#34920;&#31034; 2000 &#20010;&#27721;&#23383;</span>
<span class="org-comment">--   UTF-8 &#26159;&#21464;&#38271;&#23383;&#31526;&#38598;&#65292;&#29992;&#19968;&#20010;&#23383;&#33410;&#34920;&#31034;&#19968;&#20010;&#33521;&#25991;&#23383;&#27597;&#65292;&#29992;3&#20010;&#25110;4&#20010;&#23383;&#33410;&#34920;&#31034;&#19968;&#20010;&#27721;&#23383;&#65292;&#25152;&#20197;&#65292;&#26368;&#22810;&#21487;&#20197;&#20445;&#25345;1333&#20010;&#27721;&#23383;&#12290;</span>
<span class="org-keyword">select</span> <span class="org-keyword">length</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#20320;&#22909;'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;   <span class="org-comment">-- 2</span>
<span class="org-keyword">select</span> lengthb<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#20320;&#22909;'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;  <span class="org-comment">-- 4</span>


<span class="org-comment">-- char &#31867;&#22411;&#26159;&#22266;&#23450;&#38271;&#24230;&#30340;&#65292;&#21487;&#33021;&#20250;&#21344;&#29992;&#26356;&#22810;&#31354;&#38388;&#12290;&#20294;&#26159;&#22240;&#20026;&#38271;&#24230;&#22266;&#23450;&#65292;&#22359;&#30340;&#20998;&#37197;&#31649;&#29702;&#27604;&#36739;&#22359;&#65292;&#25928;&#29575;&#24456;&#39640;&#12290;</span>
<span class="org-comment">-- varchar2 &#26159;&#21464;&#38271;&#30340;&#65292;&#20250;&#21344;&#29992;&#23613;&#37327;&#23569;&#30340;&#31354;&#38388;&#12290;&#20294;&#26159;&#38656;&#35201;&#28040;&#32791;&#26356;&#22810;&#36164;&#28304;&#20026;&#20998;&#37197;&#21464;&#38271;&#31354;&#38388;&#65292;&#25928;&#29575;&#30053;&#20302;&#12290;</span>
<span class="org-comment">-- &#25152;&#20197;&#65292;&#29992;&#21738;&#19968;&#31181;&#65292;&#37196;&#24773;&#32780;&#23450;&#12290;</span>

<span class="org-comment">-- nchar/nvarchar2 &#26159; char/varchar2 &#30340;&#23383;&#31526;&#38598;&#25903;&#25345;&#29256;&#26412;&#65292;&#23545;&#22810;&#23383;&#33410;&#23383;&#31526;&#26377;&#31639;&#27861;&#19978;&#30340;&#20248;&#21270;&#12290;</span>
<span class="org-comment">-- &#24863;&#35273;&#29992;&#30340;&#27604;&#36739;&#23569;&#12290;</span>
</pre>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-1-2" class="outline-4">
<h4 id="sec-6-1-2"><span class="section-number-4">6.1.2</span> 数值类型</h4>
<div class="outline-text-4" id="text-6-1-2">
<ul class="org-ul">
<li>number，占用 38 位，有自己的内部表示方式，可以表示天文数字。
</li>
<li>int/float，number 类型的子类型
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- number &#31867;&#22411;&#30340;&#35821;&#27861;&#20026; NUMBER [&#20301;&#25968;[,&#23567;&#25968;&#28857;&#25968;]]</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">bbb</span> <span class="org-rainbow-delimiters-depth-1">(</span>
  a <span class="org-keyword">number</span>,         <span class="org-comment">-- &#19968;&#20849; 38 &#20301;&#65292;&#20854;&#20182;&#25353;&#29031;&#25554;&#20837;&#30340;&#20540;&#33258;&#21160;&#21028;&#26029;</span>
  b <span class="org-keyword">number</span><span class="org-rainbow-delimiters-depth-2">(</span>5<span class="org-rainbow-delimiters-depth-2">)</span>,      <span class="org-comment">-- &#19968;&#20849;5&#20301;</span>
  c <span class="org-keyword">number</span><span class="org-rainbow-delimiters-depth-2">(</span>5, 2<span class="org-rainbow-delimiters-depth-2">)</span>,   <span class="org-comment">-- &#19968;&#20849;5&#20301;&#65292;3&#20301;&#25972;&#25968;&#65292;2&#20301;&#23567;&#25968;</span>
  d <span class="org-keyword">number</span> <span class="org-rainbow-delimiters-depth-2">(</span>*, 2<span class="org-rainbow-delimiters-depth-2">)</span>   <span class="org-comment">-- &#20445;&#23384;&#20004;&#20301;&#23567;&#25968;&#65292;&#20854;&#20182;&#38543;&#24847;</span>
  e <span class="org-keyword">number</span> <span class="org-rainbow-delimiters-depth-2">(</span>*, 0<span class="org-rainbow-delimiters-depth-2">)</span>,  <span class="org-comment">-- &#30456;&#24403;&#20110; int</span>
  f <span class="org-type">int</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#25554;&#20837;&#30340;&#26102;&#20505;&#65292;&#22810;&#20313;&#30340;&#23567;&#25968;&#20250;&#34987;&#20999;&#25481;&#65292;&#20294;&#22914;&#26524;&#25972;&#25968;&#20301;&#36229;&#20102;&#65292;&#20250;&#25253;&#38169;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> bbb <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>111.223, 111.223, 111.223, 111.223, 22<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#19968;&#33324;&#24773;&#20917;&#19979;&#65292;&#20316;&#20026;&#34920;&#30340;&#20027;&#38190;&#65292;&#35774;&#20026; int &#31867;&#22411;&#23601;&#21487;&#20197;&#20102;</span>
</pre>
</div>
</li>
</ul>
</div>
</div>





<div id="outline-container-sec-6-1-3" class="outline-4">
<h4 id="sec-6-1-3"><span class="section-number-4">6.1.3</span> 日期类型</h4>
<div class="outline-text-4" id="text-6-1-3">
<ul class="org-ul">
<li>date，存储的年月日，时分秒
</li>
<li>timestamp，存储的更详细，包括时区，还有精确到小数点后6位的秒数等
</li>
<li>timestamp with time zone，可以设置时区
</li>
<li>sysdate/systimestamp 连个函数用来查询当前的日期
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#26174;&#31034;&#24403;&#21069;&#26102;&#38388;</span>
<span class="org-keyword">select</span> sysdate <span class="org-keyword">from</span> dual;
<span class="org-keyword">select</span> systimestamp <span class="org-keyword">from</span> dual;

<span class="org-comment">-- &#26102;&#38388;&#30340;&#26174;&#31034;&#26684;&#24335;&#65292;&#30001; nls_date/time_format &#31561;&#21442;&#25968;&#25511;&#21046;</span>
show <span class="org-keyword">parameter</span> nls
<span class="org-comment">-- &#22914;&#26524;&#24819;&#26684;&#24335;&#21270;&#26102;&#38388;&#65292;&#21487;&#20197;&#26377;&#19979;&#38754;&#26041;&#27861;&#65306;</span>
<span class="org-comment">-- 1. &#26356;&#25913;&#27880;&#20876;&#34920;&#20013;&#21464;&#37327;</span>
<span class="org-comment">-- # set NLS_DATE_FORMAT='yyyy.mm.dd'</span>
<span class="org-comment">-- 2. &#26356;&#25913;&#24403;&#21069;&#20250;&#35805;&#20013;&#30340;&#26684;&#24335;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">session</span> <span class="org-keyword">set</span> NLS_DATE_FORMAT=<span class="org-string">'yyyy.mm.dd'</span>;
<span class="org-comment">-- 3. &#25163;&#21160;&#36716;&#22411;&#65306;to_char</span>
<span class="org-comment">-------- yyyy &#20195;&#34920;&#22235;&#20301;&#30340;&#24180;, rr &#20195;&#34920;&#20004;&#20301;&#30340;&#24180;</span>
<span class="org-comment">-------- mm &#20195;&#34920;&#20004;&#20301;&#30340;&#25968;&#23383;&#26376;,</span>
<span class="org-comment">-------- dd &#20195;&#34920;&#20004;&#20301;&#30340;&#25968;&#23383;&#26085;,</span>
<span class="org-comment">-------- hh &#20195;&#34920;12&#26684;&#24335;&#30340;&#23567;&#26102;, hh24 &#20195;&#34920;24&#26684;&#24335;&#30340;&#23567;&#26102;</span>
<span class="org-comment">-------- mi &#20195;&#34920;&#20998;&#38047;&#25968;</span>
<span class="org-comment">-------- ss &#20195;&#34920;&#31186;&#25968;</span>
<span class="org-keyword">select</span> to_char<span class="org-rainbow-delimiters-depth-1">(</span>sysdate, <span class="org-string">'yyyy-mm-dd'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;


<span class="org-comment">-- date &#27604; timestamp &#21344;&#29992;&#26356;&#23569;&#31354;&#38388;</span>
<span class="org-comment">-- timestamp &#27604; date &#26356;&#31934;&#30830;</span>
<span class="org-comment">-- &#27809;&#26377;&#20248;&#21155;&#65292;&#20351;&#29992;&#21738;&#19968;&#20010;&#65292;&#25353;&#29031;&#38656;&#27714;&#26469;</span>


<span class="org-comment">-- &#25554;&#20837;&#26102;&#38388;&#65292;&#20351;&#29992; to_date &#36716;&#22411;&#12290;</span>
<span class="org-comment">-- &#31526;&#21512;&#26631;&#20934;&#26085;&#26399;&#26684;&#24335;&#30340;&#23383;&#31526;&#20018;&#65292;&#21487;&#20197;&#38544;&#24335;&#36716;&#22411;&#12290;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">stu</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, birth <span class="org-type">date</span> <span class="org-keyword">default</span> sysdate<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> stu <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'aaa'</span>, sysdate<span class="org-rainbow-delimiters-depth-1">)</span>;      <span class="org-comment">-- &#24403;&#21069;&#26102;&#38388;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> stu <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'bbb'</span>, <span class="org-string">'20100303'</span><span class="org-rainbow-delimiters-depth-1">)</span>;   <span class="org-comment">-- &#25554;&#20837;&#25104;&#21151;&#65292;char &#33258;&#21160;&#36716;&#22411;&#20026; date</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> stu <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'ccc'</span>, to_date<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'1999-01-11'</span>, <span class="org-string">'yyyy-mm-dd'</span><span class="org-rainbow-delimiters-depth-2">)</span>; <span class="org-comment">-- &#25163;&#21160;&#36716;&#22411;</span>
</pre>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-1-4" class="outline-4">
<h4 id="sec-6-1-4"><span class="section-number-4">6.1.4</span> 二进制类型</h4>
<div class="outline-text-4" id="text-6-1-4">
<ul class="org-ul">
<li>RAW
</li>
<li>LONG RAW
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-1-5" class="outline-4">
<h4 id="sec-6-1-5"><span class="section-number-4">6.1.5</span> LOB 类型</h4>
<div class="outline-text-4" id="text-6-1-5">
<p>
Large Object，用来存储大数据。
</p>

<p>
Oracle 提供了 <code>DBMS_LOG</code> 包对 LOB 类型的数据进行处理。
也可以在 jdbc 中通过 <code>getXLob()</code> 的方式进行 lob 字段的处理。
</p>

<ul class="org-ul">
<li>CLOB，charactor，存储大容量字符串
</li>
<li>BLOB，Binary，存储二进制文件，如小图片、小电影
</li>
<li>BFile/XMLType 等
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">article</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
  id <span class="org-type">int</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
  title varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
  content <span class="org-type">clob</span>,
  createtime <span class="org-type">date</span> <span class="org-keyword">default</span> sysdate
<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> article <span class="org-rainbow-delimiters-depth-1">(</span>id, title, content<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>1, <span class="org-string">'Oracle &#20351;&#29992;&#25351;&#21335;'</span>, <span class="org-string">'&#20320;&#22909;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-1-6" class="outline-4">
<h4 id="sec-6-1-6"><span class="section-number-4">6.1.6</span> 伪列(Pseudo Column)</h4>
<div class="outline-text-4" id="text-6-1-6">
</div><ol class="org-ol"><li><a id="sec-6-1-6-1" name="sec-6-1-6-1"></a>rowid<br ><div class="outline-text-5" id="text-6-1-6-1">
<p>
rowid 是 oracle 中的伪列。可以通过下面语句显示:
</p>
<pre class="example">
select d.rowid, d.* from dept d
</pre>

<p>
它是唯一的，不可变的，固定长度的。
</p>

<p>
它是数据存储物理地址的一种映射。一共有18位，前6位表示对象id，后3位表示fno，后6位表示块编号，最后3位表示行编号。 所以，通过rowid可以最快速度地定位到数据所在的位置。
</p>

<p>
比如，如果某行数据的 rowid 是 <code>AAAO0fAAFAAAAlmAAA</code>, 那么可以根据它直接定位数据的物理地址：
</p>
<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">AAAO0f</td>
<td class="left">AAF</td>
<td class="left">AAAAlm</td>
<td class="left">AAA</td>
</tr>

<tr>
<td class="left">对象号(6个字符)</td>
<td class="left">文件号(3个字符)</td>
<td class="left">块号(6个字符)</td>
<td class="left">行号(3个字符)</td>
</tr>
</tbody>
</table>

<p>
rowid 是 oracle 特有的。
</p>

<p>
不建议使用 rowid 作为表的主键。迁移的需求，有改变的风险。
</p>
</div>
</li>

<li><a id="sec-6-1-6-2" name="sec-6-1-6-2"></a>rownum<br ><div class="outline-text-5" id="text-6-1-6-2">
<p>
列出每一行数据的行数，从1开始，自然增长。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#22522;&#26412;&#29992;&#27861;</span>
<span class="org-keyword">select</span> rownum, d.* <span class="org-keyword">from</span> dept;
<span class="org-keyword">select</span> rownum, d.* <span class="org-keyword">from</span> dept d <span class="org-keyword">where</span> rownum &lt; 3;     <span class="org-comment">-- &#26174;&#31034;&#21069;&#20004;&#26465;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> rownum rn, d.* <span class="org-keyword">from</span> dept d<span class="org-rainbow-delimiters-depth-1">)</span> t <span class="org-keyword">where</span> t.rn = 3;   <span class="org-comment">-- &#21482;&#26174;&#31034;&#31532;&#19977;&#26465;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">order</span> <span class="org-keyword">by</span> sal <span class="org-keyword">desc</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">where</span> rownum&lt;=3;  <span class="org-comment">-- &#26174;&#31034; emp &#34920;&#20013;&#24037;&#36164;&#21069;&#19977;&#20301;&#30340;&#38599;&#21592;&#20449;&#24687;&#12290;</span>
</pre>
</div>
</div>
</li></ol>
</div>

<div id="outline-container-sec-6-1-7" class="outline-4">
<h4 id="sec-6-1-7"><span class="section-number-4">6.1.7</span> NULL</h4>
<div class="outline-text-4" id="text-6-1-7">
<p>
它是 Oracle 中非常特殊的一种类型。它表示不确定，表示没有值。并且它能转化成所有的类型。 向数据库中插入空字符串时，oracle 会把它自动转化为 null 类型。所以，在查询空字符的时候：
</p>
<pre class="example">
select * from n3 where s = '';
</pre>

<p>
上面的语句是非法，不合适的。应该这样查：
</p>
<pre class="example">
select * from n3 where s is null;
select * from n3 where s is not null;
</pre>

<p>
创建表的时候，为了约束插入的数据不能为空，应该在字段的后面写上 not null 约束。
</p>
<pre class="example">
create table n5 (s varchar2(20) not null);
</pre>

<p>
跟 null 做任何的运算，结果仍然是 null.
</p>
<pre class="example">
select null + '' from dual;   -- null
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> 运算符</h3>
<div class="outline-text-3" id="text-6-2">
</div><div id="outline-container-sec-6-2-1" class="outline-4">
<h4 id="sec-6-2-1"><span class="section-number-4">6.2.1</span> 算术运算符</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
加 / 减 / 乘 / 除
</p>
</div>
</div>

<div id="outline-container-sec-6-2-2" class="outline-4">
<h4 id="sec-6-2-2"><span class="section-number-4">6.2.2</span> 连接运算符</h4>
<div class="outline-text-4" id="text-6-2-2">
<p>
是用来连接字符串的。跟java中的 + 是一致的。
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> <span class="org-string">'abc'</span> || <span class="org-string">' bcd '</span> <span class="org-keyword">as</span> &#36830;&#25509;&#21518;&#30340;&#32467;&#26524; <span class="org-keyword">from</span> dual;
<span class="org-keyword">select</span> d.dname || <span class="org-string">' &#37096;&#38376;'</span> <span class="org-keyword">from</span> dept d;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-2-3" class="outline-4">
<h4 id="sec-6-2-3"><span class="section-number-4">6.2.3</span> 比较运算符</h4>
<div class="outline-text-4" id="text-6-2-3">
<p>
&gt; / &lt; / &gt;= / &lt;= / != / &lt;&gt; /IS NULL / Like / Between / In / Exsist
</p>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21028;&#26029; null &#20540;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> n5 <span class="org-keyword">where</span> s <span class="org-keyword">is</span> <span class="org-keyword">null</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> n5 <span class="org-keyword">where</span> s <span class="org-keyword">is</span> <span class="org-keyword">not</span> <span class="org-keyword">null</span>;

<span class="org-comment">-- like &#27169;&#31946;&#26597;&#35810;&#12290;&#24910;&#29992;&#65292;&#26377;&#21487;&#33021;&#20250;&#23548;&#33268;&#20840;&#34920;&#25195;&#25551;&#65292;&#25928;&#29575;&#20302;&#12290;</span>
<span class="org-comment">-- % &#21305;&#37197;0&#21040;&#22810;&#20010;&#23383;&#31526;&#65292;_ &#21305;&#37197;&#19968;&#20010;&#23383;&#31526;</span>
<span class="org-keyword">select</span> username <span class="org-keyword">from</span> dba_users <span class="org-keyword">where</span> username <span class="org-keyword">like</span> <span class="org-string">'VI_'</span>;
<span class="org-keyword">select</span> username <span class="org-keyword">from</span> dba_users <span class="org-keyword">where</span> username <span class="org-keyword">like</span> <span class="org-string">'SC%'</span>;
<span class="org-keyword">select</span> username <span class="org-keyword">from</span> dba_users <span class="org-keyword">where</span> username <span class="org-keyword">like</span> <span class="org-string">'%SC%'</span>;

<span class="org-comment">-- in&#65292;&#26159; where x = a or x = b or x = c &#30340;&#19968;&#31181;&#32553;&#20889;&#12290;&#19979;&#38754;&#20004;&#26465;&#26159;&#31561;&#20215;&#30340;&#12290;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> empno <span class="org-keyword">in</span> <span class="org-rainbow-delimiters-depth-1">(</span>700, 800, 900<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> empno = 700 <span class="org-keyword">or</span> empno = 800 <span class="org-keyword">or</span> empno = 900;
<span class="org-comment">-- in &#21518;&#38754;&#36319;&#30340;&#19981;&#19968;&#23450;&#26159;&#36887;&#21495;&#20998;&#38548;&#30340;&#21333;&#39033;&#65292;&#20063;&#21487;&#33021;&#26159;&#19968;&#20010;&#23436;&#25972;&#30340;&#26597;&#35810;&#35821;&#21477;&#12290;</span>
<span class="org-comment">-- &#19979;&#38754;&#20004;&#26465;&#32467;&#26524;&#26159;&#19968;&#33268;&#30340;</span>
<span class="org-comment">-- &#36825;&#31181; in &#24910;&#29992;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> deptno <span class="org-keyword">in</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> deptno <span class="org-keyword">from</span> dept <span class="org-keyword">where</span> dname = <span class="org-string">'SALES'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> a.* <span class="org-keyword">from</span> emp a,dept d <span class="org-keyword">where</span> a.deptno =d.deptno <span class="org-keyword">and</span> d.dname=<span class="org-string">'SALES'</span>;


<span class="org-comment">-- between...and</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> empno <span class="org-keyword">between</span> 7800 <span class="org-keyword">and</span> 9000;
<span class="org-comment">-- &#31561;&#21516;&#20110;&#65306;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> empno &gt;= 7800 <span class="org-keyword">and</span> empno &lt;= 9000;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-2-4" class="outline-4">
<h4 id="sec-6-2-4"><span class="section-number-4">6.2.4</span> 逻辑运算符</h4>
<div class="outline-text-4" id="text-6-2-4">
<p>
and / or / not
</p>

<p>
<b>not 的优先级 &gt; and 的优先级 &gt; or 的优先级</b>
</p>
</div>
</div>

<div id="outline-container-sec-6-2-5" class="outline-4">
<h4 id="sec-6-2-5"><span class="section-number-4">6.2.5</span> 集合操作符</h4>
<div class="outline-text-4" id="text-6-2-5">
<p>
Union / UnionAll / Intersect / Minus
</p>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#29983;&#25104;&#27979;&#35797;&#25968;&#25454;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">dept_01</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> dept <span class="org-keyword">where</span> rownum &lt; 6;
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">dept_02</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> dept <span class="org-keyword">where</span> rownum &lt; 4;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> dept_02 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>98, <span class="org-string">'&#23567;&#21507;&#37096;'</span>, <span class="org-string">'&#26007;&#38376;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> dept_02 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>99, <span class="org-string">'&#22806;&#21334;&#37096;'</span>, <span class="org-string">'&#39321;&#27954;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">commit</span>;

<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dept_01
<span class="org-keyword">union</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dept_02;

<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dept_01
<span class="org-keyword">union</span> <span class="org-keyword">all</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dept_02;

<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dept_01
<span class="org-keyword">intersect</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dept_02;

<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dept_01
minus
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> dpet_02;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Join Query</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21021;&#22987;&#21270;&#34920;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">loc</span> <span class="org-rainbow-delimiters-depth-1">(</span>id <span class="org-type">int</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span>, <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, locid <span class="org-keyword">references</span> loc<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#21021;&#22987;&#21270;&#25968;&#25454;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> gp <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>1, <span class="org-string">'&#21644;&#24179;'</span>, <span class="org-string">'&#19975;&#23681;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> gp <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>2, <span class="org-string">'&#33258;&#30001;'</span>, <span class="org-string">'&#24456;&#22909;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> gp <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>3, <span class="org-string">'&#27665;&#20027;'</span>, <span class="org-string">'&#29233;&#22269;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> gp <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>4, <span class="org-string">'&#25964;&#19994;'</span>, <span class="org-string">'&#21451;&#21892;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> loc <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>11, <span class="org-string">'&#24191;&#19996;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> loc <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>22, <span class="org-string">'&#23665;&#19996;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> loc <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>33, <span class="org-string">'&#28246;&#21335;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> loc <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>44, <span class="org-string">'&#27743;&#35199;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#29579;&#26032;&#28828;'</span>, 33<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#21556;&#33521;&#24179;'</span>, 33<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#26460;&#24535;&#28023;'</span>, 44<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#33539;&#38160;'</span>, 11<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">commit</span>;

<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> loc;

<span class="org-comment">-- &#26597;&#35810;&#23601;&#26159;&#19968;&#20010;&#36880;&#27493;&#36807;&#28388;&#30340;&#36807;&#31243;</span>
<span class="org-comment">-- &#21449;&#20056;&#65292;&#20869;&#37096;&#26434;&#20132;&#65292;&#34394;&#25311;&#34920;&#65292;16&#26465;&#25968;&#25454;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person, loc;
<span class="org-comment">-- &#36807;&#28388;&#25481;&#19981;&#31526;&#21512;&#26465;&#20214;&#30340;&#25968;&#25454;&#12290;&#21363;&#23436;&#25104;&#19968;&#27425;&#22806;&#36830;&#25509;&#12290;</span>
<span class="org-comment">-- &#21363;&#65306;&#22686;&#19968;&#34920;&#65292;&#21152;&#19968;&#26465;&#20214;&#12290;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person, loc <span class="org-keyword">where</span> person.locid = loc.id;
<span class="org-comment">-- &#20854;&#20182;&#26465;&#20214;&#65292;&#21363;&#22312;&#19978;&#38754;&#30340;&#22522;&#30784;&#19978;&#32487;&#32493;&#36807;&#28388;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person, loc <span class="org-keyword">where</span> person.locid = loc.id <span class="org-keyword">and</span> person.<span class="org-keyword">name</span> <span class="org-keyword">like</span> <span class="org-string">'&#29579;%'</span>;


<span class="org-comment">-- &#22686;&#21152;&#21478;&#19968;&#20010;&#34920;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">gp</span> <span class="org-rainbow-delimiters-depth-1">(</span>id <span class="org-type">int</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span>, <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, logo varchar2<span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>; 
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">add</span>  <span class="org-rainbow-delimiters-depth-1">(</span>gpid <span class="org-type">int</span> <span class="org-keyword">references</span> gp<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#20462;&#25913;&#27599;&#20010;&#20154;&#30340; group</span>
<span class="org-comment">-- update ..</span>

<span class="org-keyword">select</span> * <span class="org-keyword">from</span> gp;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> loc;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person;

<span class="org-keyword">update</span> loc <span class="org-keyword">set</span> <span class="org-keyword">name</span>=<span class="org-string">'&#20013;&#21326;&#20154;&#27665;&#20849;&#21644;&#22269;&#28246;&#21335;&#30465;'</span> <span class="org-keyword">where</span> id=33;
<span class="org-keyword">commit</span>;

<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person p, loc l, gp g;
<span class="org-comment">-- &#23558;&#19981;&#31526;&#21512;&#30340;&#25490;&#38500;&#25481;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person p, loc l, gp g
  <span class="org-keyword">where</span> p.locid = l.id
    <span class="org-keyword">and</span> p.gpid = g.id
    <span class="org-comment">-- and   l.name = '&#27743;&#35199;'</span>
    <span class="org-keyword">and</span> g.<span class="org-keyword">name</span>=<span class="org-string">'&#21644;&#24179;'</span>
    <span class="org-keyword">and</span> p.<span class="org-keyword">name</span> <span class="org-keyword">like</span> <span class="org-string">'&#29579;%'</span>;

<span class="org-comment">-- </span>
<span class="org-comment">-- oracle &#20889;&#27861;&#65292;&#38750;&#26631;&#20934;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person p, loc l, gp g
  <span class="org-keyword">where</span> p.locid = l.id <span class="org-keyword">and</span> p.gpid = g.id;

<span class="org-comment">-- ansi sql &#20889;&#27861;&#65292;join &#40664;&#35748;&#26159; inner join</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person p
   <span class="org-keyword">join</span> loc l <span class="org-keyword">on</span> p.locid = l.id
   <span class="org-keyword">join</span> gp g <span class="org-keyword">on</span> p.gpid = g.id;


<span class="org-comment">-- &#22686;&#21152;&#19968;&#20010;&#27809;&#26377;&#22320;&#21306;&#30340;&#20154;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#40644;&#31168;'</span>, <span class="org-keyword">null</span>, <span class="org-keyword">null</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">commit</span>;

<span class="org-comment">-- &#26174;&#31034;&#25152;&#26377;&#20154;&#65292;&#24182;&#23558;&#20854;&#22320;&#21306;&#20449;&#24687;&#26597;&#35810;&#20986;&#26469;&#12290;</span>
<span class="org-comment">-- &#38656;&#35201;&#20351;&#29992;&#22806;&#36830;&#25509;&#65292;&#23558;&#21363;&#20351;&#19981;&#21305;&#37197;&#30340;&#20154;&#20063;&#26597;&#35810;&#20986;&#26469;</span>
<span class="org-comment">-- oracle &#20889;&#27861;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person, loc
  <span class="org-keyword">where</span> person.locid = loc.id<span class="org-rainbow-delimiters-depth-1">(</span>+<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#26631;&#20934;&#20889;&#27861;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person p
  <span class="org-keyword">left</span> <span class="org-keyword">outer</span> <span class="org-keyword">join</span> loc l <span class="org-keyword">on</span> p.locid = l.id;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> Functions</h3>
<div class="outline-text-3" id="text-6-4">
</div><div id="outline-container-sec-6-4-1" class="outline-4">
<h4 id="sec-6-4-1"><span class="section-number-4">6.4.1</span> Numeric</h4>
<div class="outline-text-4" id="text-6-4-1">
<ul class="org-ul">
<li>abs/mod 绝对值/求模
</li>
<li>sqrt/power/exp    求幂
</li>
<li>ceil/floor/round  取整
</li>
<li>trunc 截取小数点
</li>
<li>sin/cos/ln/log   数学函数
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-4-2" class="outline-4">
<h4 id="sec-6-4-2"><span class="section-number-4">6.4.2</span> Charactor</h4>
<div class="outline-text-4" id="text-6-4-2">
<ul class="org-ul">
<li>chr/ascii   ascii码      
</li>
<li>length/lengthb   字符/字节长度
</li>
<li>initcap/upper/lower   字母大小写   
</li>
<li>substr/translate/replace/instr   子串/替换    
</li>
<li>ltrim/rtrim/lpad/rpad   修剪/填充    
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-4-3" class="outline-4">
<h4 id="sec-6-4-3"><span class="section-number-4">6.4.3</span> Datetime</h4>
<div class="outline-text-4" id="text-6-4-3">
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> sysdate, systimestamp, <span class="org-builtin">current_date</span> <span class="org-keyword">from</span> dual;
<span class="org-comment">-- x &#22825;&#20043;&#21518;&#30340;&#26085;&#26399;</span>
<span class="org-keyword">select</span> sysdate + 365 <span class="org-keyword">from</span> dual;
<span class="org-comment">-- x &#20010;&#26376;&#21518;&#30340;&#26085;&#26399;</span>
<span class="org-keyword">select</span> add_months<span class="org-rainbow-delimiters-depth-1">(</span>sysdate, -5<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-comment">-- &#30456;&#24046;&#20960;&#20010;&#26376;</span>
<span class="org-keyword">select</span> months_between<span class="org-rainbow-delimiters-depth-1">(</span>to_date<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'20180501'</span><span class="org-rainbow-delimiters-depth-2">)</span>, sysdate<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-comment">-- &#19979;&#21608; x &#30340;&#26085;&#26399;</span>
<span class="org-keyword">select</span> next_day<span class="org-rainbow-delimiters-depth-1">(</span>sysdate, <span class="org-string">'&#26143;&#26399;&#19968;'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-keyword">select</span> next_day<span class="org-rainbow-delimiters-depth-1">(</span>sysdate, 2<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;  <span class="org-comment">-- 1 &#20195;&#34920;&#26143;&#26399;&#22825;, 0 &#20195;&#34920;&#26143;&#26399;&#19968;, &#31867;&#25512;</span>
<span class="org-comment">-- &#19968;&#20010;&#26376;&#30340;&#26368;&#21518;&#19968;&#22825;/&#31532;&#19968;&#22825;</span>
<span class="org-keyword">select</span> last_day<span class="org-rainbow-delimiters-depth-1">(</span>sysdate<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-keyword">select</span> trunc<span class="org-rainbow-delimiters-depth-1">(</span>sysdate,<span class="org-string">'MONTH'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-keyword">select</span> trunc<span class="org-rainbow-delimiters-depth-1">(</span>sysdate,<span class="org-string">'YEAR'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-comment">-- &#33719;&#21462;&#26085;&#26399;&#30340;&#21333;&#20010;&#23383;&#27573;</span>
<span class="org-keyword">select</span> <span class="org-builtin">extract</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">day</span> <span class="org-keyword">from</span> sysdate<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-comment">-- &#23545;&#26085;&#26399;&#36827;&#34892;&#25130;&#21462;</span>
<span class="org-keyword">select</span> round<span class="org-rainbow-delimiters-depth-1">(</span>to_date<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'20170916'</span><span class="org-rainbow-delimiters-depth-2">)</span>,<span class="org-string">'MONTH'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual; <span class="org-comment">-- &#22235;&#33293;&#20116;&#20837;</span>
<span class="org-keyword">select</span> trunc<span class="org-rainbow-delimiters-depth-1">(</span>to_date<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'20170916'</span><span class="org-rainbow-delimiters-depth-2">)</span>,<span class="org-string">'MONTH'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-4-4" class="outline-4">
<h4 id="sec-6-4-4"><span class="section-number-4">6.4.4</span> Nullable</h4>
<div class="outline-text-4" id="text-6-4-4">
<ul class="org-ul">
<li>nvl/nvl2/nullif
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-4-5" class="outline-4">
<h4 id="sec-6-4-5"><span class="section-number-4">6.4.5</span> Miscellaneous</h4>
<div class="outline-text-4" id="text-6-4-5">
<p>
<b>decode/case when</b>:
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#29983;&#25104;&#25968;&#25454;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">sss</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, gender <span class="org-type">int</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> sss <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#27185;&#26691;&#23567;&#20024;&#23376;'</span>, 2<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> sss <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#36335;&#39134;'</span>, 1<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> sss <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#22823;&#29066;'</span>, 3<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> sss <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#20809;&#22836;&#24378;'</span>, 1<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">commit</span>;

<span class="org-comment">-- &#26597;&#35810;&#65292;&#23558; gender &#30340;&#25968;&#23383;&#36716;&#21270;&#20026;&#30007;&#22899;</span>
<span class="org-comment">-- 1. decode &#20989;&#25968;&#30340;&#26041;&#24335;</span>
<span class="org-keyword">select</span> <span class="org-keyword">name</span>, decode<span class="org-rainbow-delimiters-depth-1">(</span>gender, 1, <span class="org-string">'&#38596;&#24615;'</span>,
                            2, <span class="org-string">'&#38604;&#24615;'</span>,
                               <span class="org-string">'&#26410;&#30693;&#24615;&#21035;'</span><span class="org-rainbow-delimiters-depth-1">)</span> "&#24615;&#21035;" <span class="org-keyword">from</span> sss;
<span class="org-comment">-- 2. case when &#30340;&#26041;&#24335;                               </span>
<span class="org-keyword">select</span> <span class="org-keyword">name</span>, <span class="org-keyword">case</span> gender
                <span class="org-keyword">when</span> 1 <span class="org-keyword">then</span> <span class="org-string">'&#38596;&#24615;'</span>
                <span class="org-keyword">when</span> 2 <span class="org-keyword">then</span> <span class="org-string">'&#38604;&#24615;'</span>
                  <span class="org-keyword">else</span> <span class="org-string">'&#26410;&#30693;&#24615;&#21035;'</span>
             <span class="org-keyword">end</span> "&#24615;&#21035;" <span class="org-keyword">from</span> sss;

<span class="org-comment">-- 3. case when &#30340;&#21478;&#19968;&#31181;&#26041;&#24335;             </span>
<span class="org-keyword">select</span> <span class="org-keyword">name</span>, <span class="org-keyword">case</span> 
                <span class="org-keyword">when</span> gender &lt;= 1 <span class="org-keyword">then</span> <span class="org-string">'&#38596;&#24615;'</span>
                <span class="org-keyword">when</span> gender &gt;= 2 <span class="org-keyword">then</span> <span class="org-string">'&#38604;&#24615;'</span>
                  <span class="org-keyword">else</span> <span class="org-string">'&#26410;&#30693;&#24615;&#21035;'</span>
              <span class="org-keyword">end</span> "&#24615;&#21035;" <span class="org-keyword">from</span> sss;

<span class="org-comment">-- &#32473; emp &#20013;&#30340;&#20154;&#21152;&#24037;&#36164;&#65306;</span>
<span class="org-comment">---- 1000 &#20803;&#20197;&#19979;&#30340;&#65292;&#21152; 50%</span>
<span class="org-comment">---- 2000 &#20803;&#20197;&#19979;&#30340;&#65292;&#21152; 30%</span>
<span class="org-comment">---- 3000 &#20803;&#20197;&#19979;&#30340;&#65292;&#21152; 20%</span>
<span class="org-comment">---- &#20854;&#20182;&#20154; 5%</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">emp3</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp;
<span class="org-comment">-- &#22914;&#26524;&#35201;&#23558;&#25152;&#26377;&#30340;&#24037;&#36164;&#32763;&#20493;&#65292;&#36825;&#20040;&#20889;&#65306;</span>
<span class="org-keyword">update</span> emp3 <span class="org-keyword">set</span> sal = sal*2;
<span class="org-comment">-- &#22914;&#26524;&#19981;&#21516;&#30340;&#20154;&#21152;&#19981;&#21516;&#30340;&#24037;&#36164;&#65292;&#38656;&#35201;&#29992;&#21040; case when:</span>
<span class="org-keyword">update</span> emp3 <span class="org-keyword">set</span> sal = <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">case</span>
                         <span class="org-keyword">when</span> sal &lt;= 1000 <span class="org-keyword">then</span> sal*1.5
                         <span class="org-keyword">when</span> sal &lt;= 2000 <span class="org-keyword">then</span> sal*1.3
                         <span class="org-keyword">when</span> sal &lt;= 3000 <span class="org-keyword">then</span> sal*1.2
                         <span class="org-keyword">else</span> sal*1.05
                       <span class="org-keyword">end</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#22914;&#26524; 1981/5/1 &#20043;&#21069;&#26469;&#20844;&#21496;&#30340;&#20154;&#25353;&#29031;&#19978;&#38754;&#35843;&#34218;&#65292;&#20854;&#20182;&#20154;&#21482;&#35843; 1% &#21602;&#65311;</span>
<span class="org-comment">-- [TODO]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-4-6" class="outline-4">
<h4 id="sec-6-4-6"><span class="section-number-4">6.4.6</span> Aggregate Function</h4>
<div class="outline-text-4" id="text-6-4-6">
<p>
聚合函数是用来统计每个分组的统计信息，它们要跟 group by 一起使用，用来将每个分组所有数据 <b>聚合</b> 成一条统计数据。
</p>

<p>
包括 max/min/count/avg/sum 等。
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#25353;&#29031;&#37096;&#38376;&#36827;&#34892;&#20998;&#32452;&#32479;&#35745;&#30340;&#35821;&#21477;</span>
<span class="org-keyword">select</span> deptno,             <span class="org-comment">-- &#22240;&#20026;&#25353;&#29031; deptno &#20998;&#32452;&#65292;select &#20013;&#21482;&#33021;&#26377; deptno &#23383;&#27573;</span>
       <span class="org-builtin">count</span><span class="org-rainbow-delimiters-depth-1">(</span>*<span class="org-rainbow-delimiters-depth-1">)</span>,           <span class="org-comment">-- &#27599;&#20010;&#20998;&#32452;&#22810;&#23569;&#26465;&#25968;&#25454;</span>
       <span class="org-builtin">max</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>,           <span class="org-comment">-- &#27599;&#20010;&#20998;&#32452;&#24037;&#36164;&#30340;&#26368;&#22823;&#20540;</span>
       <span class="org-builtin">min</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>,           <span class="org-comment">-- &#27599;&#20010;&#20998;&#32452;&#24037;&#36164;&#30340;&#26368;&#23567;&#20540;</span>
       <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>,           <span class="org-comment">-- &#27599;&#20010;&#20998;&#32452;&#24037;&#36164;&#30340;&#22343;&#20540;</span>
       <span class="org-builtin">sum</span><span class="org-rainbow-delimiters-depth-1">(</span>nvl<span class="org-rainbow-delimiters-depth-2">(</span>comm, 0<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>   <span class="org-comment">-- &#27599;&#20010;&#20998;&#32452;&#22870;&#37329;&#24635;&#21644;&#65292;&#22240;&#20026;&#22870;&#37329;&#21487;&#33021;&#20026; null&#65292;&#25152;&#20197;&#38656;&#35201;&#20351;&#29992; nvl &#36827;&#34892;&#21435;&#31354;</span>
  <span class="org-keyword">from</span> emp
 <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno;          <span class="org-comment">-- &#20998;&#32452;&#20381;&#25454;</span>


<span class="org-comment">-- &#21487;&#20197;&#29992; having &#23545;&#32467;&#26524;&#36827;&#34892;&#36807;&#28388;</span>
<span class="org-comment">-- &#25972;&#20010; select &#35821;&#21477;&#25191;&#34892;&#39034;&#24207;&#22823;&#33268;&#26159;: where -&gt; group by -&gt; having -&gt; order by</span>
<span class="org-keyword">select</span> deptno, <span class="org-builtin">count</span><span class="org-rainbow-delimiters-depth-1">(</span>*<span class="org-rainbow-delimiters-depth-1">)</span>, <span class="org-builtin">max</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>, <span class="org-builtin">min</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>, <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span>, <span class="org-builtin">sum</span><span class="org-rainbow-delimiters-depth-1">(</span>comm<span class="org-rainbow-delimiters-depth-1">)</span>
  <span class="org-keyword">from</span> emp
 <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno
 <span class="org-keyword">having</span> <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span> &gt; 2000;

<span class="org-comment">-- having &#31561;&#20215;&#20110;&#23884;&#22871;&#30340; where&#65292;&#21363;&#19978;&#38754;&#35821;&#21477;&#36319;&#19979;&#38754;&#36825;&#26465;&#31561;&#25928;&#12290;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-keyword">select</span> deptno, <span class="org-builtin">count</span><span class="org-rainbow-delimiters-depth-2">(</span>*<span class="org-rainbow-delimiters-depth-2">)</span>, <span class="org-builtin">max</span><span class="org-rainbow-delimiters-depth-2">(</span>sal<span class="org-rainbow-delimiters-depth-2">)</span>, <span class="org-builtin">min</span><span class="org-rainbow-delimiters-depth-2">(</span>sal<span class="org-rainbow-delimiters-depth-2">)</span>, <span class="org-builtin">avg</span><span class="org-rainbow-delimiters-depth-2">(</span>sal<span class="org-rainbow-delimiters-depth-2">)</span> asal, <span class="org-builtin">sum</span><span class="org-rainbow-delimiters-depth-2">(</span>comm<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-keyword">from</span> emp
   <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno
 <span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">where</span> asal &gt; 2000;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-4-7" class="outline-4">
<h4 id="sec-6-4-7"><span class="section-number-4">6.4.7</span> Analytic Function</h4>
<div class="outline-text-4" id="text-6-4-7">
<p>
<a href="https://docs.oracle.com/cd/E11882_01/server.112/e41084/functions004.htm#SQLRF06174">https://docs.oracle.com/cd/E11882_01/server.112/e41084/functions004.htm#SQLRF06174</a>
</p>

<p>
聚合函数统计的是一个分组的信息，聚合之后每个分组只能得到一条信息，但并不能够获取分组内成员的具体信息。
</p>

<p>
而分析函数可以详细显示分组内部的统计信息，它显示的信息更全面，语法也更复杂。
</p>

<p>
大致来说，分析函数的使用语法是这样的:
</p>
<pre class="example">
分析函数() over ([partition by xxx] order by yyy [rows/range ...])
</pre>

<p>
解释：
</p>
<ul class="org-ul">
<li>一个分析函数，需要跟着一个窗口函数。
</li>
<li>以 over 开始的部分叫 <b>窗口函数</b>, 它描述了要对哪些数据、按照什么方式进行分析的行为。
</li>
<li>窗口函数内部分为三部分，其中 order by 是必须的，其它可选
</li>
<li><code>partition by</code> 指定了数据按照什么方式 分组/分区
</li>
<li><code>order by</code> 指定了在分区之内，数据的排序方式
</li>
<li><code>rows/range</code> 可以对分区的数据进行限定
</li>
<li>分析函数有很多，比如 row_number/rank/dense_rank/max/count 等，row_number 等有如下区别
<pre class="example">
ROW_NUMBER 返回连续的排位，不论值是否相等
RANK 具有相等值的行排位相同，序数随后跳跃
DENSE_RANK 具有相等值的行排位相同，序号是连续的
</pre>
</li>
<li><b>需要查询组本身的信息，用聚合函数 group by; 需要查询组成员的统计信息，需要用分析函数。</b>
</li>
</ul>

<p>
示例：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#26368;&#22522;&#26412;&#65292;&#31383;&#21475;&#25551;&#36848;&#20869;&#21482;&#26377; order by</span>
<span class="org-keyword">select</span> e.*, <span class="org-builtin">sum</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span> over <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">order</span> <span class="org-keyword">by</span> sal<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp e;
<span class="org-keyword">select</span> e.*, row_number<span class="org-rainbow-delimiters-depth-1">()</span> over <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">order</span> <span class="org-keyword">by</span> sal<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp e;

<span class="org-comment">-- &#20197;&#32452;&#20026;&#21333;&#20301;&#65292;&#36827;&#34892;&#25490;&#24207;</span>
<span class="org-keyword">select</span> e.*, <span class="org-builtin">sum</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span> over <span class="org-rainbow-delimiters-depth-1">(</span>partition <span class="org-keyword">by</span> deptno <span class="org-keyword">order</span> <span class="org-keyword">by</span> sal<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp e;
<span class="org-keyword">select</span> e.*, row_number<span class="org-rainbow-delimiters-depth-1">()</span> over <span class="org-rainbow-delimiters-depth-1">(</span>partition <span class="org-keyword">by</span> deptno <span class="org-keyword">order</span> <span class="org-keyword">by</span> sal<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp e;


<span class="org-comment">-- &#27604;&#22914;&#65292;&#35201;&#26597;&#35810;&#27599;&#20010;&#32452;&#30340;&#26368;&#39640;&#24037;&#36164;&#65292;&#21487;&#20197;&#29992;&#32858;&#21512;&#20989;&#25968;</span>
<span class="org-keyword">select</span> deptno, <span class="org-builtin">max</span><span class="org-rainbow-delimiters-depth-1">(</span>sal<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp <span class="org-keyword">group</span> <span class="org-keyword">by</span> deptno;
<span class="org-comment">-- &#20294;&#22914;&#26524;&#35201;&#26597;&#30475;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;&#65292;&#32858;&#21512;&#20989;&#25968;&#26080;&#33021;&#20026;&#21147;&#65292;&#38656;&#35201;&#29992;&#21040;&#20998;&#26512;&#20989;&#25968;</span>
<span class="org-comment">---- 1. &#39318;&#20808;&#25353;&#32452;&#25490;&#24207;</span>
<span class="org-keyword">select</span> e.*, row_number<span class="org-rainbow-delimiters-depth-1">()</span> over <span class="org-rainbow-delimiters-depth-1">(</span>partition <span class="org-keyword">by</span> deptno <span class="org-keyword">order</span> <span class="org-keyword">by</span> sal <span class="org-keyword">desc</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> emp e;
<span class="org-comment">---- 2. &#36807;&#28388;&#65292;&#21482;&#21462;&#25490;&#21517;&#31532;&#19968;&#30340;&#37027;&#20010;&#20154;&#65292;ok</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span>
  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> e.*, row_number<span class="org-rainbow-delimiters-depth-2">()</span> over <span class="org-rainbow-delimiters-depth-2">(</span>partition <span class="org-keyword">by</span> deptno <span class="org-keyword">order</span> <span class="org-keyword">by</span> sal <span class="org-keyword">desc</span><span class="org-rainbow-delimiters-depth-2">)</span> rn <span class="org-keyword">from</span> emp e<span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-keyword">where</span> rn = 1;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="section-number-3">6.5</span> Pagination</h3>
<div class="outline-text-3" id="text-6-5">
<p>
使用 rownum 或者 row_number()：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#27880;&#24847;&#65292;&#36825;&#31181;&#20889;&#27861;&#26159;&#26080;&#25928;&#30340;&#65292;&#22240;&#20026;&#65306;rownum &gt; n &#36825;&#31181;&#20889;&#27861;&#26080;&#24847;&#20041;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> rownum &gt; 4 <span class="org-keyword">and</span> rownum &lt; 8;

<span class="org-comment">-- &#20026;&#20102;&#33021;&#20351;&#29992; rownum&gt;n&#65292;&#25105;&#20204;&#21482;&#38656;&#35201;&#23884;&#22871;&#19968;&#23618;&#26597;&#35810;&#21363;&#21487;</span>
<span class="org-keyword">select</span> *
  <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> rownum rn, e.* <span class="org-keyword">from</span> emp e<span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-keyword">where</span> rn &gt; 4
   <span class="org-keyword">and</span> rn &lt; 8;

<span class="org-comment">-- &#21516;&#26679;&#65292;&#20351;&#29992; row_number() &#20998;&#26512;&#20989;&#25968;&#65292;&#25105;&#20204;&#20063;&#38656;&#35201;&#23884;&#22871;&#19968;&#23618;</span>
<span class="org-keyword">select</span> *
  <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> row_number<span class="org-rainbow-delimiters-depth-2">()</span> over<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">order</span> <span class="org-keyword">by</span> rowid<span class="org-rainbow-delimiters-depth-2">)</span> rn, e.* <span class="org-keyword">from</span> emp e<span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-keyword">where</span> rn &gt; 4
   <span class="org-keyword">and</span> rn &lt; 8;

<span class="org-comment">-- &#32780;&#19979;&#38754;&#36825;&#31181;&#20889;&#27861;&#65292;&#22522;&#26412;&#19978;&#26159;&#26368;&#21512;&#29702;&#65292;&#26368;&#39640;&#25928;&#30340;&#65306;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-keyword">select</span> a.*, rownum rn <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-2">(</span>
    <span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp
  <span class="org-rainbow-delimiters-depth-2">)</span> a <span class="org-keyword">where</span> rownum &lt; 8<span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-keyword">where</span> rn &gt; 4;

<span class="org-comment">-- &#21363;:</span>
<span class="org-keyword">SELECT</span> * <span class="org-keyword">FROM</span> <span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-keyword">SELECT</span> a.*, ROWNUM rn <span class="org-keyword">FROM</span> <span class="org-rainbow-delimiters-depth-2">(</span>
    <span class="org-comment">-- &#35201;&#26597;&#35810;&#30340;&#35821;&#21477;</span>
  <span class="org-rainbow-delimiters-depth-2">)</span> a <span class="org-keyword">where</span> ROWNUM &lt; <span class="org-string">'#&#26368;&#22823;&#24207;&#21495;#'</span><span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-keyword">WHERE</span> rn &gt; <span class="org-string">'#&#26368;&#23567;&#24207;&#21495;#'</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-6" class="outline-3">
<h3 id="sec-6-6"><span class="section-number-3">6.6</span> 查询语句执行顺序</h3>
<div class="outline-text-3" id="text-6-6">
<p>
完整的查询语句类似是这样的：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> ..., ROWNUM
  <span class="org-keyword">from</span> <span class="org-keyword">table</span>
 <span class="org-keyword">where</span> &lt;<span class="org-keyword">where</span> clause&gt;
 <span class="org-keyword">group</span> <span class="org-keyword">by</span> &lt;columns&gt;
<span class="org-keyword">having</span> &lt;<span class="org-keyword">having</span> clause&gt;
 <span class="org-keyword">order</span> <span class="org-keyword">by</span> &lt;columns&gt;;
</pre>
</div>

<p>
它的处理顺序是：
</p>
<ol class="org-ol">
<li>首先，执行 FROM/WHERE 语句
</li>
<li>为结果赋予 ROWNUM 并同时根据 FROM/WHERE 语句进行 rownum 过滤
</li>
<li>执行 SELECT
</li>
<li>执行 GROUP BY
</li>
<li>执行 HAVING
</li>
<li>执行 ORDER BY
</li>
</ol>

<p>
PS: 如果存在分析函数(row_number etc)，那么，分析函数的执行会在 order by 之前。
</p>
</div>
</div>

<div id="outline-container-sec-6-7" class="outline-3">
<h3 id="sec-6-7"><span class="section-number-3">6.7</span> DDL/DML/TCL/DCL</h3>
<div class="outline-text-3" id="text-6-7">
<p>
<b>表的约束:</b>
</p>
<ul class="org-ul">
<li>是加在表上的一种对象，能保证每次插入或修改数据的时候，对数据的合法性进行检查，从而避免插入不合理数据。
</li>
<li>优点：通过检查，能保证数据的完整性和一致性。
</li>
<li>缺点：消耗一定的存储，数据量大的时候，每次检查会有一定的资源损耗
</li>
</ul>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#39318;&#20808;&#65292;&#21019;&#24314;&#34920;&#65306;&#31867;&#22411;&#12289;&#38271;&#24230;&#12289;&#38750;&#31354;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test1</span> <span class="org-rainbow-delimiters-depth-1">(</span>
   id <span class="org-type">int</span>,
   <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   birthday <span class="org-type">date</span>,
   sex <span class="org-type">int</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#22312;&#34920; ddl_test1 &#19978;&#22686;&#21152;&#19968;&#20010;&#21517;&#23383;&#20026; fk_ddl_sex_01 &#30340;&#32422;&#26463;</span>
<span class="org-comment">-- &#20316;&#29992;&#22312; sex &#21015;&#19978; / &#20851;&#32852;&#21040; ddl_sex &#34920;&#30340; id &#21015;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test1</span>
   <span class="org-keyword">add</span> <span class="org-keyword">constraint</span> fk_ddl_sex_01 <span class="org-keyword">foreign</span> <span class="org-keyword">key</span> <span class="org-rainbow-delimiters-depth-1">(</span>sex<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">references</span> ddl_sex <span class="org-rainbow-delimiters-depth-1">(</span>id<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_sex</span> <span class="org-rainbow-delimiters-depth-1">(</span>
   id <span class="org-type">int</span>,
   <span class="org-keyword">value</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_sex</span> <span class="org-keyword">add</span> <span class="org-keyword">constraint</span> pk_ddl_sex <span class="org-keyword">primary</span> <span class="org-keyword">key</span><span class="org-rainbow-delimiters-depth-1">(</span>id<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> ddl_sex;


<span class="org-comment">---- &#21019;&#24314;&#32422;&#26463;&#30340;&#20960;&#31181;&#26041;&#24335;</span>
<span class="org-comment">---- &#31532;&#19968;&#31181;&#26041;&#24335;&#65292;&#20808;&#21019;&#24314;&#34920;&#65292;&#20877;&#21021;&#22987;&#21270;&#25968;&#25454;&#65292;&#26368;&#21518;&#20877;&#21152;&#32422;&#26463;</span>
<span class="org-comment">-- &#21019;&#24314;&#34920;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test2</span> <span class="org-rainbow-delimiters-depth-1">(</span>
   id <span class="org-type">int</span>,
   <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   birthday <span class="org-type">date</span>,
   sex <span class="org-type">int</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_sex2</span> <span class="org-rainbow-delimiters-depth-1">(</span>
   id <span class="org-type">int</span>,
   <span class="org-keyword">value</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#25554;&#20837;&#25968;&#25454;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> ddl_sex <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>1, <span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> ddl_sex <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>2, <span class="org-string">'&#22899;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> ddl_test2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>2, <span class="org-string">'xx'</span>, sysdate, 1<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> ddl_sex <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>3, <span class="org-string">'&#19981;&#30693;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> ddl_test2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>1, <span class="org-string">'xx'</span>, sysdate, 1<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> ddl_test2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>3, <span class="org-string">'xx'</span>, sysdate, 1<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> ddl_test2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>4, <span class="org-string">'xx'</span>, sysdate, 1<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#22686;&#21152;&#32422;&#26463;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test2</span> <span class="org-keyword">add</span> <span class="org-keyword">constraint</span> fk_0023 <span class="org-keyword">foreign</span> <span class="org-keyword">key</span> <span class="org-rainbow-delimiters-depth-1">(</span>sex<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">references</span> ddl_sex;
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test2</span> <span class="org-keyword">add</span> <span class="org-keyword">constraint</span> pk_test2 <span class="org-keyword">primary</span> <span class="org-keyword">key</span> <span class="org-rainbow-delimiters-depth-1">(</span>id<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">---- &#31532;&#20108;&#31181;&#26041;&#24335;&#65292;&#22312;&#24314;&#34920;&#30340;&#23383;&#27573;&#19978;&#30452;&#25509;&#24314;&#31435;&#32422;&#26463;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test4</span>
<span class="org-rainbow-delimiters-depth-1">(</span> 
   id <span class="org-type">int</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
   <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   sex <span class="org-keyword">constraint</span> hello250 <span class="org-keyword">references</span> ddl_sex
<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">---- &#31532;&#19977;&#31181;&#26041;&#24335;&#65292;&#23558;&#24314;&#31435;&#32422;&#26463;&#30340;&#35821;&#21477;&#65292;&#25918;&#21040;&#24314;&#34920;&#35821;&#21477;&#26368;&#21518;&#12290;&#20248;&#28857;&#65292;&#28165;&#26224;&#26131;&#20110;&#31649;&#29702;&#12290;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test5</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
   id <span class="org-type">int</span>,
   <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   sex <span class="org-type">int</span>,

   <span class="org-keyword">constraint</span> hello260 <span class="org-keyword">primary</span> <span class="org-keyword">key</span><span class="org-rainbow-delimiters-depth-2">(</span>id<span class="org-rainbow-delimiters-depth-2">)</span>,
   <span class="org-keyword">foreign</span> <span class="org-keyword">key</span> <span class="org-rainbow-delimiters-depth-2">(</span>sex<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">references</span> ddl_sex
 <span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">---- &#32422;&#26463;&#30340;&#31181;&#31867;</span>
<span class="org-comment">---- &#20027;&#35201;&#26377;&#65306;&#20027;&#38190;&#32422;&#26463;&#12289;&#38750;&#31354;&#32422;&#26463;&#12289;&#21807;&#19968;&#32422;&#26463;&#12289;&#26816;&#26597;&#32422;&#26463;&#12289;&#22806;&#38190;&#32422;&#26463;&#31561;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test6</span> <span class="org-rainbow-delimiters-depth-1">(</span>
  id <span class="org-type">int</span>,
  sal <span class="org-keyword">number</span><span class="org-rainbow-delimiters-depth-2">(</span>5<span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test6</span> <span class="org-keyword">add</span> <span class="org-keyword">constraint</span> pk_test6 <span class="org-keyword">primary</span> <span class="org-keyword">key</span> <span class="org-rainbow-delimiters-depth-1">(</span>id<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test6</span> <span class="org-keyword">add</span> <span class="org-keyword">constraint</span> ck_2323 <span class="org-keyword">check</span><span class="org-rainbow-delimiters-depth-1">(</span>sal &gt; 1250<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> ddl_test6 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>1, 500<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> ddl_test6 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>2, 3500<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> ddl_test6;
</pre>
</div>

<p>
<b>表的命名:</b>
</p>
<ul class="org-ul">
<li>简
</li>
<li>明
</li>
</ul>

<p>
另外：
</p>
<ol class="org-ol">
<li>表名等在数据库内部会自动转化为大写的形式。如果想使用小写的形式，需要在创建的时候，加双引号。
<pre class="example">
create table "lowcase_name" (...);
</pre>
</li>
<li>表名尽量使用英文单词，或英文单词缩写词。如果有多个单词连接，请使用下划线。
</li>
<li>不要使用复数形式。比如使用 <code>boy</code> 而不是 <code>boys</code>, 使用 <code>student</code> 而非 <code>students</code>.
</li>
<li>字段名字有两种方式:
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#28165;&#26224;&#26126;&#20102;&#19981;&#25302;&#27877;&#24102;&#27700;&#65292;&#20294;&#22810;&#34920;&#32852;&#21512;&#26597;&#35810;&#65292;&#21487;&#33021;&#20986;&#29616;&#37325;&#22797;&#23383;&#27573;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">boy</span> <span class="org-rainbow-delimiters-depth-1">(</span>id <span class="org-type">int</span>, <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, wechat varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#20889;&#27861;&#19985;&#65292;&#20294;&#32852;&#21512;&#26597;&#35810;&#19981;&#20250;&#20986;&#29616;&#37325;&#22797;&#23383;&#27573;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">girl</span> <span class="org-rainbow-delimiters-depth-1">(</span>girl_id <span class="org-type">int</span>, girl_name varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, girl_wechat varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>
</li>
<li>主键请使用 <b>代理主键</b>, 即没有任何业务关联的字段作为主键。因为直觉上不变的东西，在特定情况下都可能发生变化。
</li>
<li>自增，请使用 <b>序列</b>, 最好为每个单独的主键创建一个专用的序列。
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#39318;&#20808;&#65292;&#20445;&#35777;&#26377;&#21019;&#24314;&#24207;&#21015;&#30340;&#26435;&#38480;</span>
<span class="org-keyword">GRANT</span> <span class="org-keyword">CREATE</span> <span class="org-keyword">SEQUENCE</span> <span class="org-keyword">TO</span> VIP;

<span class="org-comment">-- &#21019;&#24314;&#24207;&#21015;&#30340;&#26368;&#31616;&#35821;&#21477;</span>
<span class="org-comment">-- &#27880;&#24847;&#65292;&#21629;&#21517;&#20013;&#65292;&#26368;&#22909;&#24102; seq &#31561;&#23383;&#27573;&#65292;&#34920;&#31034;&#36825;&#26159;&#19968;&#20010;&#24207;&#21015;</span>
<span class="org-keyword">CREATE</span> <span class="org-keyword">SEQUENCE</span> <span class="org-function-name">seq_boy</span>;

<span class="org-comment">-- &#20351;&#29992;&#30340;&#26041;&#24335;&#24456;&#31616;&#21333;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> boy <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>seq_boy.nextval, <span class="org-string">'xxx'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> seq_boy.currval  <span class="org-comment">-- &#24207;&#21015;&#24403;&#21069;&#20540;</span>
       seq_boy.nextval  <span class="org-comment">-- &#24207;&#21015;&#19979;&#19968;&#20010;&#20540;</span>
  <span class="org-keyword">from</span> dual;

<span class="org-comment">-- &#24207;&#21015;&#21487;&#20197;&#26377;&#26356;&#22810;&#21442;&#25968;</span>
<span class="org-keyword">create</span> <span class="org-keyword">sequence</span> <span class="org-function-name">seq_boy2</span>
  minvalue 2      <span class="org-comment">-- &#26368;&#23567;&#20540;&#65292;&#40664;&#35748; 1</span>
  maxvalue 1000   <span class="org-comment">-- &#26368;&#22823;&#20540;&#65292;&#40664;&#35748;&#26080;&#38480;</span>
  <span class="org-keyword">start</span> <span class="org-keyword">with</span> 4    <span class="org-comment">-- &#21021;&#22987;&#20540;&#65292;&#40664;&#35748;&#36319; minvalue &#30456;&#21516;</span>
  increment <span class="org-keyword">by</span> 2  <span class="org-comment">-- &#27493;&#36827;</span>
  nocycle         <span class="org-comment">-- &#22914;&#26524;&#21040;&#36798;&#26368;&#22823;&#20540;&#65292;&#26159;&#21542;&#20174;&#24320;&#22987;&#20877;&#27425;&#24490;&#29615;</span>
  nocache         <span class="org-comment">-- &#35774;&#32622;&#32531;&#23384;</span>
  ;

<span class="org-comment">-- &#20462;&#25913;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">sequence</span> <span class="org-function-name">seq_boy2</span> cache 10;
<span class="org-keyword">alter</span> <span class="org-keyword">sequence</span> <span class="org-function-name">seq_boy2</span> maxvalue 2000 increment <span class="org-keyword">by</span> 5;

<span class="org-comment">-- &#21024;&#38500;</span>
<span class="org-keyword">drop</span> <span class="org-keyword">sequence</span> <span class="org-function-name">seq_boy2</span>;
</pre>
</div>
</li>
</ol>

<p>
<b>修改, ALTER:</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21019;&#24314;&#31034;&#20363;&#34920;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test1</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
   id <span class="org-type">int</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span>,
   <span class="org-keyword">name</span> <span class="org-type">varchar</span><span class="org-rainbow-delimiters-depth-2">(</span>2<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">not</span> <span class="org-keyword">null</span>,
   birth <span class="org-type">date</span> <span class="org-keyword">default</span> sysdate
<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#21508;&#31181;&#20462;&#25913;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test1</span> rename <span class="org-keyword">column</span> id <span class="org-keyword">to</span> testid;
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test1</span> <span class="org-keyword">modify</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>40<span class="org-rainbow-delimiters-depth-2">)</span>, birth <span class="org-type">timestamp</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test1</span> <span class="org-keyword">add</span> gender varchar2<span class="org-rainbow-delimiters-depth-1">(</span>10<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">not</span> <span class="org-keyword">null</span>;
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">ddl_test1</span> <span class="org-keyword">drop</span> <span class="org-keyword">column</span> gender;

<span class="org-comment">-- &#20316;&#29992;&#22312;&#24207;&#21015;&#19978;&#30340; DDL</span>
<span class="org-keyword">create</span> <span class="org-keyword">sequence</span> <span class="org-function-name">seq_aaa</span>;
<span class="org-keyword">alter</span> <span class="org-keyword">sequence</span> <span class="org-function-name">seq_aaa</span> <span class="org-keyword">start</span> <span class="org-keyword">with</span> 222;
<span class="org-keyword">drop</span> <span class="org-keyword">sequence</span> <span class="org-function-name">seq_bbb</span>;
</pre>
</div>

<p>
<b>查询, select:</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- SELECT &#35821;&#21477;&#20013;&#30340;&#22522;&#26412;&#35745;&#31639;&#65292;&#26159;&#22522;&#20110;&#34892;&#30340;</span>
<span class="org-comment">-- &#19981;&#21516;&#34892;&#20013;&#30340;&#25968;&#25454;&#65292;&#19981;&#33021;&#30452;&#25509;&#35745;&#31639;</span>
<span class="org-comment">-- &#25152;&#20197;&#65292;&#35299;&#20915;&#30340;&#26041;&#26696;&#26159;&#65306;&#23558;&#19981;&#21516;&#34892;&#30340;&#25968;&#25454;&#25972;&#21512;&#21040;&#21516;&#19968;&#34892;&#20013;&#65292;&#20877;&#20570;&#27604;&#36739;</span>
<span class="org-comment">-- &#32780;&#25972;&#21512;&#21040;&#21516;&#19968;&#34892;&#65292;&#26377;&#24456;&#22810;&#26041;&#27861;&#65306;</span>
<span class="org-comment">-- &#21487;&#20197;&#26159;&#34920;&#36319;&#34920;&#36827;&#34892;&#20851;&#32852;&#65307;&#21487;&#20197;&#26159;&#20998;&#32452;&#65307;&#31561;&#31561;&#12290;</span>
<span class="org-comment">-- &#20851;&#38190;&#26159;&#65306;&#24605;&#36335;&#65292;&#24605;&#36335;&#65292;&#24605;&#36335;&#12290;</span>

<span class="org-comment">-- &#19979;&#38754;&#26159;&#19968;&#20010;&#20363;&#23376;</span>
<span class="org-comment">-- &#26597;&#35810;&#30007;&#12289;&#22899;&#20043;&#24046;</span>

<span class="org-comment">-- &#39318;&#20808;&#65292;&#21021;&#22987;&#21270;&#25968;&#25454;</span>
<span class="org-comment">-- &#30007; / 46&#20154;</span>
<span class="org-comment">-- &#22899; / 10&#20154;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">aaa</span> <span class="org-rainbow-delimiters-depth-1">(</span>gender <span class="org-type">char</span><span class="org-rainbow-delimiters-depth-2">(</span>2<span class="org-rainbow-delimiters-depth-2">)</span>, num <span class="org-keyword">number</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> aaa <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#30007;'</span>, 46<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> aaa <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#22899;'</span>, 10<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- 1. &#36825;&#26159;&#19968;&#31181;&#26041;&#27861;&#65292;</span>
<span class="org-keyword">with</span>
    a <span class="org-keyword">as</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> * <span class="org-keyword">from</span>  aaa <span class="org-keyword">where</span> gender = <span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-1">)</span>,
    b <span class="org-keyword">as</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> * <span class="org-keyword">from</span>  aaa <span class="org-keyword">where</span> gender = <span class="org-string">'&#22899;'</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-keyword">select</span> a.num - b.num <span class="org-keyword">from</span> a, b;

<span class="org-comment">-- 2. &#19979;&#38754;&#26159;&#19978;&#38754;&#26041;&#24335;&#30340;&#31561;&#20215;&#20889;&#27861;</span>
<span class="org-keyword">select</span> a.num - b.num
  <span class="org-keyword">from</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> * <span class="org-keyword">from</span> aaa <span class="org-keyword">where</span> gender = <span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-1">)</span> a,
       <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> * <span class="org-keyword">from</span> aaa <span class="org-keyword">where</span> gender = <span class="org-string">'&#22899;'</span><span class="org-rainbow-delimiters-depth-1">)</span> b;

<span class="org-comment">-- 3. &#19979;&#38754;&#26159;&#21478;&#19968;&#31181;&#20889;&#27861;</span>
<span class="org-keyword">select</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> num <span class="org-keyword">from</span> aaa <span class="org-keyword">where</span> gender = <span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-1">)</span> - num <span class="org-keyword">from</span> aaa <span class="org-keyword">where</span> gender = <span class="org-string">'&#22899;'</span>;

<span class="org-comment">-- 4. &#26368;&#22522;&#26412;&#30340;&#65292;&#23545;&#34920;&#36827;&#34892;&#20851;&#32852;&#26597;&#35810;&#65292;&#20043;&#21518;&#20877;&#36807;&#28388;&#65292;&#20877;&#35745;&#31639;</span>
<span class="org-keyword">select</span> a.num - b.num <span class="org-keyword">from</span> aaa a, aaa b <span class="org-keyword">where</span> a.gender=<span class="org-string">'&#30007;'</span> <span class="org-keyword">and</span> b.gender=<span class="org-string">'&#22899;'</span>;

<span class="org-comment">-- 5. &#25110;&#32773;&#22522;&#20110;&#20998;&#32452;</span>
<span class="org-keyword">select</span> <span class="org-builtin">max</span><span class="org-rainbow-delimiters-depth-1">(</span>num<span class="org-rainbow-delimiters-depth-1">)</span> - <span class="org-builtin">min</span><span class="org-rainbow-delimiters-depth-1">(</span>num<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> aaa;

<span class="org-comment">-- 6.7.8. &#20854;&#20182;&#26041;&#27861;...</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 同义词/视图</h2>
<div class="outline-text-2" id="text-7">
<p>
这两种都用来：
</p>
<ol class="org-ol">
<li>精简语句
</li>
<li>隐藏细节
</li>
</ol>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> 同义词(Synonym)</h3>
<div class="outline-text-3" id="text-7-1">
<p>
为 <b>表或对象</b> 创建别名：
</p>
<ul class="org-ul">
<li>可以简化 sql 语句
</li>
<li>可以隐藏细节
</li>
<li>提供公共访问（公有同义词）
</li>
</ul>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#26597;&#30475;&#36319;&#21516;&#20041;&#35789;&#26377;&#20851;&#30340;&#26435;&#38480;</span>
<span class="org-comment">-- &#20998;&#20004;&#31181;&#65306;</span>
<span class="org-comment">--- synonym, &#21019;&#24314;&#26469;&#33258;&#24049;&#20351;&#29992;</span>
<span class="org-comment">--- public synonym, &#21019;&#24314;&#26469;&#25152;&#26377;&#20154;&#37117;&#21487;&#20197;&#20351;&#29992;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> system_privilege_map <span class="org-keyword">where</span> <span class="org-keyword">name</span> <span class="org-keyword">like</span> <span class="org-builtin">upper</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'%syn%'</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#23558;&#21019;&#24314;&#21516;&#20041;&#35789;&#30340;&#26435;&#38480;&#25480;&#26435;&#32473;&#29992;&#25143;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">create</span> synonym <span class="org-keyword">to</span> vip;
<span class="org-keyword">grant</span> <span class="org-keyword">create</span> <span class="org-keyword">public</span> synonym <span class="org-keyword">to</span> vip;

<span class="org-comment">-- &#21019;&#24314;</span>
<span class="org-keyword">create</span> synonym e <span class="org-keyword">for</span> scott.emp;
<span class="org-keyword">create</span> <span class="org-keyword">or</span> replace <span class="org-keyword">public</span> synonym d <span class="org-keyword">for</span> scott.dept;

<span class="org-comment">-- &#21487;&#20197;&#20026;&#34920;&#20043;&#22806;&#30340;&#23545;&#35937;&#21019;&#24314;&#21516;&#20041;&#35789;</span>
<span class="org-keyword">create</span> <span class="org-keyword">sequence</span> <span class="org-function-name">seq_aaaaaaforme</span>;
<span class="org-keyword">create</span> synonym seq_aaa <span class="org-keyword">for</span> seq_aaaaaaforme;

<span class="org-comment">-- &#20351;&#29992;&#65292;&#22312;&#19968;&#20999;&#21487;&#20197;&#20351;&#29992;&#21407;&#20808;&#23545;&#35937;&#30340;&#22320;&#26041;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> e <span class="org-keyword">join</span> d <span class="org-keyword">using</span> <span class="org-rainbow-delimiters-depth-1">(</span>deptno<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">desc</span> d;
<span class="org-keyword">select</span> seq_aaa.nextval <span class="org-keyword">from</span> dual;

<span class="org-comment">-- &#21024;&#38500;</span>
<span class="org-keyword">drop</span> synonym d;
<span class="org-keyword">drop</span> <span class="org-keyword">public</span> synonym d;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> 视图(View)</h3>
<div class="outline-text-3" id="text-7-2">
<p>
视图, 默认指的是关系视图, 又叫虚表。
</p>
<ul class="org-ul">
<li>不占用数据空间
</li>
<li>可以简化语句
</li>
<li>可以隐藏细节
</li>
<li>可以提升安全
</li>
</ul>

<p>
除了关系视图，广义的视图包括：
</p>
<ol class="org-ol">
<li>关系视图(狭义的视图，虚表)
</li>
<li>内嵌视图(子查询中的临时结果)
</li>
<li>对象视图(面向对象)
</li>
<li>物化视图(以空间换时间)
</li>
</ol>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#26597;&#35810;&#36319;&#35270;&#22270;&#30456;&#20851;&#30340;&#26435;&#38480;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> system_privilege_map <span class="org-keyword">where</span> <span class="org-keyword">name</span> <span class="org-keyword">like</span> <span class="org-string">'%VIEW%'</span>;
<span class="org-comment">-- &#30830;&#20445;&#29992;&#25143;&#26377;&#36275;&#22815;&#26435;&#38480;</span>
<span class="org-keyword">grant</span> <span class="org-keyword">create</span> <span class="org-keyword">view</span> <span class="org-keyword">to</span> vip;
<span class="org-keyword">grant</span> <span class="org-keyword">all</span> <span class="org-keyword">on</span> scott.emp <span class="org-keyword">to</span> vip;
<span class="org-keyword">grant</span> <span class="org-keyword">all</span> <span class="org-keyword">on</span> scott.dept <span class="org-keyword">to</span> vip;

<span class="org-comment">-- &#21019;&#24314;&#35270;&#22270;</span>
<span class="org-keyword">create</span> <span class="org-keyword">view</span> <span class="org-function-name">vemp</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> scott.emp;  <span class="org-comment">-- &#26368;&#31616;&#24418;&#24335;&#65292;&#20026;&#21333;&#20010;&#34920;&#21019;&#24314;&#35270;&#22270;</span>
<span class="org-keyword">create</span> <span class="org-keyword">view</span> <span class="org-function-name">v_emp_vip</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> scott.emp <span class="org-keyword">where</span> sal &gt;= 2000;  <span class="org-comment">-- &#21487;&#20197;&#20026;&#34920;&#30340;&#37096;&#20998;&#25968;&#25454;&#21019;&#24314;&#35270;&#22270;</span>
<span class="org-keyword">create</span> <span class="org-keyword">view</span> <span class="org-function-name">vvevip</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> vevip;  <span class="org-comment">-- &#21487;&#20197;&#20026;&#35270;&#22270;&#26597;&#35810;&#21019;&#24314;&#35270;&#22270;</span>
<span class="org-keyword">create</span> <span class="org-keyword">or</span> replace <span class="org-keyword">view</span> <span class="org-function-name">vevip</span> <span class="org-keyword">as</span>     <span class="org-comment">-- &#21487;&#20197;&#20026;&#22810;&#34920;&#32852;&#21512;&#26597;&#35810;&#30340;&#32467;&#26524;&#38598;&#21019;&#24314;&#35270;&#22270;&#12290;</span>
  <span class="org-keyword">select</span> e.*, d.dname, d.loc
    <span class="org-keyword">from</span> emp e, dept d
   <span class="org-keyword">where</span> e.deptno = d.deptno<span class="org-rainbow-delimiters-depth-1">(</span>+<span class="org-rainbow-delimiters-depth-1">)</span>
     <span class="org-keyword">and</span> e.sal &gt;= 2000;

<span class="org-comment">-- &#20351;&#29992;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> e;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> vemp;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> v_emp_vip;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> vevip;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> vvevip;

<span class="org-comment">-- &#21024;&#38500;</span>
<span class="org-keyword">drop</span> <span class="org-keyword">view</span> <span class="org-function-name">vemp</span>;


<span class="org-comment">-- force &#24378;&#36843;&#65281;&#65281;&#65281;&#19981;&#31649; select &#35821;&#21477;&#26159;&#21542;&#26377;&#38169;&#65292;&#37117;&#35201;&#21019;&#24314;&#12290;</span>
<span class="org-comment">-- or replace, &#22914;&#26524;&#35270;&#22270;&#24050;&#23384;&#22312;&#65292;&#35206;&#30422;</span>
<span class="org-comment">-- with read only, &#21019;&#24314;&#21482;&#35835;&#35270;&#22270;</span>
<span class="org-keyword">create</span> <span class="org-keyword">or</span> replace force <span class="org-keyword">view</span> <span class="org-function-name">vaaa</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> wohaoshuai <span class="org-keyword">with</span> <span class="org-keyword">read</span> <span class="org-keyword">only</span>;

<span class="org-comment">-- with check option, &#38450;&#27490;&#26356;&#26032;&#21518;&#30340;&#25968;&#25454;, &#36229;&#20986;&#35270;&#22270;&#30340;&#33539;&#22260;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> emp <span class="org-rainbow-delimiters-depth-1">(</span>empno, ename, sal<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>9988, <span class="org-string">'&#24352;&#24605;'</span>, 3333<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">create</span> <span class="org-keyword">or</span> replace <span class="org-keyword">view</span> <span class="org-function-name">vbbb</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt; 3332;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> vbbb; <span class="org-comment">-- &#20004;&#26465;&#25968;&#25454;&#65292;King &#21644; &#24352;&#24605;</span>
<span class="org-keyword">update</span> vbbb <span class="org-keyword">set</span> sal = 2000 <span class="org-keyword">where</span> empno = 9988;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> vbbb; <span class="org-comment">-- &#21482;&#21097;&#19968;&#26465;&#25968;&#25454;&#12290;</span>
<span class="org-comment">-- &#25353;&#29031;&#36947;&#29702;&#65292;update &#21482;&#26159;&#26356;&#26032;&#25968;&#25454;&#65292;&#19981;&#24212;&#35813;&#23548;&#33268;&#32467;&#26524;&#38598;&#21464;&#23569;&#12290;&#25152;&#20197;&#65292;&#38656;&#35201;&#36890;&#36807; with check option &#26469;&#38480;&#21046;&#19981;&#21512;&#29702;&#30340;&#20462;&#25913;</span>
<span class="org-keyword">create</span> <span class="org-keyword">or</span> replace <span class="org-keyword">view</span> <span class="org-function-name">vcc</span> <span class="org-keyword">as</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt; 1500  <span class="org-keyword">with</span> <span class="org-keyword">check</span> <span class="org-keyword">option</span>;
<span class="org-keyword">update</span> vbbb <span class="org-keyword">set</span> sal = 1000 <span class="org-keyword">where</span> empno = 9988;  <span class="org-comment">-- &#20250;&#25253;&#38169;</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> 效率和速度</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> 表分区</h3>
<div class="outline-text-3" id="text-8-1">
<p>
<b>分而治之</b>
</p>

<p>
目的：
</p>
<ol class="org-ol">
<li>安全（鸡蛋不要放在一个篮子里）
</li>
<li>效率****（快速找到南方it学院所有姓张的人）
</li>
<li>便于维护
</li>
</ol>

<p>
场景：
</p>
<ol class="org-ol">
<li>数据量极大（大于 2G）
</li>
<li>历史数据比重比较大
</li>
</ol>

<p>
分类：
</p>
<ol class="org-ol">
<li>范围分区
</li>
<li>列表分区
</li>
<li>哈希分区(hash)
</li>
</ol>

<p>
在以上分区的基础上，可以两两结合，形成 <b>复合分区</b>，但常用的就是两种：
</p>
<ol class="org-ol">
<li>范围-列表分区
</li>
<li>范围-哈希分区
</li>
</ol>

<p>
<b>范围分区:</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21019;&#24314;&#19968;&#20010;&#26222;&#36890;&#34920;&#30340;&#35821;&#21477;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person1</span> <span class="org-rainbow-delimiters-depth-1">(</span>id <span class="org-type">int</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span>, <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, birth <span class="org-type">date</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#25968;&#25454;&#23558;&#20250;&#22312;&#21516;&#19968;&#20010;&#34920;&#31354;&#38388;&#21516;&#19968;&#20010;&#27573;&#20869;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person1 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>1, <span class="org-string">'sss'</span>, sysdate<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#21019;&#24314;&#19968;&#20010;&#20998;&#21306;&#34920;</span>
<span class="org-comment">-- &#36825;&#37324;&#26159;&#25353;&#29031;&#29983;&#26085;&#36827;&#34892;&#33539;&#22260;&#20998;&#21306;</span>
<span class="org-comment">-- &#35821;&#21477;&#30340;&#22522;&#26412;&#26684;&#24335;&#23601;&#26159;&#22312;&#26222;&#36890;&#24314;&#34920;&#30340;&#35821;&#21477;&#19978;&#65292;&#22686;&#21152; partition by &#35821;&#21477;&#22359;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person2</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, birth <span class="org-type">date</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> range <span class="org-rainbow-delimiters-depth-1">(</span>birth<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
  partition p1 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'19950101'</span>,<span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>,  <span class="org-comment">-- 'values less than'</span>
  partition p2 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'20000101'</span>,<span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>,
  partition p3 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>maxvalue<span class="org-rainbow-delimiters-depth-2">)</span>                         <span class="org-comment">-- &#40664;&#35748;&#20998;&#21306;</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#25554;&#20837;&#65292;&#25968;&#25454;&#20250;&#26681;&#25454;&#20998;&#21306;&#30340;&#24773;&#20917;&#36827;&#20837;&#19981;&#21516;&#30340;&#20998;&#21306;&#20869;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24352;&#19977;'</span>, to_date<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'19940707'</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#26446;&#22235;'</span>, to_date<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'19980707'</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#29579;&#20116;'</span>, to_date<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'20040707'</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#26597;&#35810;&#34920;&#20013;&#25152;&#26377;&#25968;&#25454;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person2;
<span class="org-comment">-- &#26597;&#35810;&#29305;&#23450;&#20998;&#21306;&#19978;&#25968;&#25454;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person2 partition <span class="org-rainbow-delimiters-depth-1">(</span>p3<span class="org-rainbow-delimiters-depth-1">)</span>;


<span class="org-comment">-- &#21487;&#20197;&#20026;&#19981;&#21516;&#30340;&#20998;&#21306;&#25351;&#23450;&#19981;&#21516;&#30340;&#34920;&#31354;&#38388;</span>
<span class="org-comment">-- &#27809;&#26377;&#25351;&#23450;&#34920;&#31354;&#38388;&#30340;&#20998;&#21306;&#65292;&#20351;&#29992;&#29992;&#25143;&#30340;&#40664;&#35748;&#34920;&#31354;&#38388;</span>
<span class="org-comment">-- &#25152;&#20197;&#65292;&#19968;&#20010;&#34920;&#20869;&#30340;&#25968;&#25454;&#21487;&#20197;&#23384;&#22312;&#20110;&#19981;&#21516;&#34920;&#31354;&#38388;&#37324;&#65292;&#20063;&#23601;&#26159;&#21487;&#20197;&#23384;&#25918;&#22312;&#19981;&#21516;&#25968;&#25454;&#25991;&#20214;&#20013;&#65292;&#19981;&#21516;&#30913;&#30424;&#19978;</span>
<span class="org-comment">-- &#22240;&#27492;&#65292;&#20998;&#21306;&#34920;&#33021;&#22686;&#24378;&#25968;&#25454;&#30340;&#23433;&#20840;&#24615;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person3</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, birth <span class="org-type">date</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> range <span class="org-rainbow-delimiters-depth-1">(</span>birth<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
  partition p1 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'19950101'</span>,<span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> tablespace <span class="org-keyword">system</span>,
  partition p2 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'20000101'</span>,<span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> tablespace sysaux,
  partition p3 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>maxvalue<span class="org-rainbow-delimiters-depth-2">)</span> tablespace users
<span class="org-rainbow-delimiters-depth-1">)</span>;


<span class="org-comment">-- &#21487;&#20197;&#22312;&#20854;&#20182;&#31867;&#22411;&#19978;&#36827;&#34892;&#33539;&#22260;&#20998;&#21306;</span>
<span class="org-comment">-- &#20063;&#21487;&#20197;&#22312;&#22810;&#20010;&#23383;&#27573;&#19978;&#36827;&#34892;&#33539;&#22260;&#20998;&#21306;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person4</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, birth <span class="org-type">date</span>, score <span class="org-keyword">number</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> range <span class="org-rainbow-delimiters-depth-1">(</span>birth, score<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
  partition p1 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'19900101'</span>,<span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span>, 60<span class="org-rainbow-delimiters-depth-2">)</span>,
  partition p2 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'19900101'</span>,<span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span>, 90<span class="org-rainbow-delimiters-depth-2">)</span>,
  partition p3 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'19990101'</span>,<span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span>, 60<span class="org-rainbow-delimiters-depth-2">)</span>,
  partition p4 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'19990101'</span>,<span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span>, 90<span class="org-rainbow-delimiters-depth-2">)</span>,
  partition p5 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>maxvalue, maxvalue<span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<b>列表分区:</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#22914;&#26524;&#26159;&#29983;&#26085;&#30340;&#36825;&#26679;&#30340;&#23383;&#27573;&#65292;&#25968;&#25454;&#26159;&#36830;&#32493;&#30340;&#65292;&#24212;&#35813;&#20351;&#29992;&#33539;&#22260;&#20998;&#21306;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, birth <span class="org-type">date</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> range<span class="org-rainbow-delimiters-depth-1">(</span>birth<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
  partition p1 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'19900101'</span>, <span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> tablespace users,
  partition p2 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>maxvalue<span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'aaa'</span>, to_date<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'19871212'</span>, <span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person partition <span class="org-rainbow-delimiters-depth-1">(</span>p1<span class="org-rainbow-delimiters-depth-1">)</span>;


<span class="org-comment-delimiter">/* </span>
<span class="org-comment">where birth between 1987 and 1990 </span>
<span class="org-comment">where sex in ('&#30007;', '&#22899;')</span>
<span class="org-comment">*/</span>

<span class="org-comment">-- &#20294;&#26159;&#20687;&#24615;&#21035;&#12289;&#27665;&#26063;&#31561;&#23383;&#27573;&#65292;&#26356;&#36866;&#21512;&#20351;&#29992;&#30340;&#26159;&#21015;&#34920;&#20998;&#21306;</span>
<span class="org-comment">-- &#19979;&#38754;&#19968;&#20010;&#20363;&#23376;&#65292;&#20351;&#29992;&#24615;&#21035;&#20316;&#20026;&#20998;&#21306;&#23383;&#27573;&#65292;&#30007;&#30340;&#19968;&#20010;&#21306;&#65292;&#22899;&#30340;&#19968;&#20010;&#21306;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person2</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, sex <span class="org-type">varchar</span><span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> list <span class="org-rainbow-delimiters-depth-1">(</span>sex<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
    partition p1 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-2">)</span>,
    partition p2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'&#22899;'</span><span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'aaa'</span>, <span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'bbb'</span>, <span class="org-string">'&#22899;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'ccc'</span>, <span class="org-string">'&#26410;&#30693;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;  <span class="org-comment">-- &#25253;&#38169;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person2 partition <span class="org-rainbow-delimiters-depth-1">(</span>p2<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#40664;&#35748;&#20998;&#21306;&#30340;&#20889;&#27861;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person3</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, sex <span class="org-type">varchar</span><span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> list <span class="org-rainbow-delimiters-depth-1">(</span>sex<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
    partition p1 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-2">)</span>,
    partition p2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'&#22899;'</span><span class="org-rainbow-delimiters-depth-2">)</span>,
    partition p3 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">default</span><span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person3 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'ccc'</span>, <span class="org-string">'&#26410;&#30693;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person3 partition <span class="org-rainbow-delimiters-depth-1">(</span>p3<span class="org-rainbow-delimiters-depth-1">)</span>;


<span class="org-comment">-- &#21487;&#20197;&#20026;&#27599;&#20010;&#20998;&#21306;&#25351;&#23450;&#34920;&#31354;&#38388;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person3</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, sex <span class="org-type">varchar</span><span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> list <span class="org-rainbow-delimiters-depth-1">(</span>sex<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
    partition p1 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-2">)</span> tablespace users,
    partition p2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'&#22899;'</span><span class="org-rainbow-delimiters-depth-2">)</span> tablespace <span class="org-keyword">system</span>,
    partition p3 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">default</span><span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<b>哈希分区:</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21704;&#24076;&#20998;&#21306;</span>
<span class="org-comment">-- &#20027;&#35201;&#29992;&#22312;&#19968;&#20123;&#27604;&#36739;&#31163;&#25955;&#65292;&#19981;&#22909;&#20998;&#31867;&#30340;&#25968;&#25454;&#19978;&#65292;&#27604;&#22914;&#20135;&#21697;&#21517;&#23383;</span>
<span class="org-comment">-- &#35753; oracle &#20351;&#29992;&#21704;&#24076;&#31639;&#27861;&#33258;&#21160;&#35745;&#31639;&#25968;&#25454;&#30340;&#20998;&#21306;</span>

<span class="org-comment">-- &#21019;&#24314;&#35821;&#21477;&#65292;&#38750;&#24120;&#31616;&#21333;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person4</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, sex varchar2<span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> hash <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
  partition p1,
  partition p2 tablespace users
<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person4 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'aaa'</span>, <span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person4 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#25910;&#27454;'</span>, <span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person4 partition <span class="org-rainbow-delimiters-depth-1">(</span>p1<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">-- &#19978;&#38754;&#30340;&#35821;&#21477;&#21487;&#20197;&#36827;&#19968;&#27493;&#31616;&#21270;&#20026;&#65306;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person5</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, sex varchar2<span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> hash <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span><span class="org-rainbow-delimiters-depth-1">)</span>
partitions 5;

<span class="org-comment">-- &#20026;&#27599;&#20010;&#20998;&#21306;&#25351;&#23450;&#34920;&#31354;&#38388;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person6</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, sex varchar2<span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> hash <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span><span class="org-rainbow-delimiters-depth-1">)</span>
partitions 3 store <span class="org-keyword">in</span> <span class="org-rainbow-delimiters-depth-1">(</span>users, <span class="org-keyword">system</span>, sysaux<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<b>范围-列表分区:</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#39318;&#20808;&#65292;&#25353;&#29031;&#29983;&#26085;&#36827;&#34892;&#21015;&#34920;&#20998;&#21306;&#65292;&#20998;&#20102;&#19977;&#20010;&#21306;</span>
<span class="org-comment">-- &#20854;&#27425;&#65292;&#22312;&#27599;&#20010;&#20998;&#21306;&#20869;&#65292;&#21448;&#25353;&#29031;&#24615;&#21035;&#20998;&#20102;&#19977;&#20010;&#21306;</span>
<span class="org-comment">-- &#25152;&#20197;&#65292;&#24635;&#20849;&#26159; 3 &#20010;&#20998;&#21306; 9 &#20010;&#23376;&#20998;&#21306;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person8</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, sex varchar2<span class="org-rainbow-delimiters-depth-2">(</span>10<span class="org-rainbow-delimiters-depth-2">)</span>, birth <span class="org-type">date</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> range<span class="org-rainbow-delimiters-depth-1">(</span>birth<span class="org-rainbow-delimiters-depth-1">)</span>
subpartition <span class="org-keyword">by</span> list<span class="org-rainbow-delimiters-depth-1">(</span>sex<span class="org-rainbow-delimiters-depth-1">)</span>
subpartition template
<span class="org-rainbow-delimiters-depth-1">(</span>
   subpartition sp01 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'&#30007;'</span><span class="org-rainbow-delimiters-depth-2">)</span>,
   subpartition sp02 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'&#22899;'</span><span class="org-rainbow-delimiters-depth-2">)</span>,
   subpartition sp03 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">default</span><span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>
   partition p1 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'19900101'</span>, <span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>,
   partition p2 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'20000101'</span>, <span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>,
   partition p3 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>maxvalue<span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-keyword">insert</span> <span class="org-keyword">into</span> person8 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'aaa'</span>, <span class="org-string">'&#30007;'</span>, to_date<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'19900202'</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#26597;&#35810;&#36825;&#26465;&#25968;&#25454;&#65292;&#26377;&#20197;&#19979;&#19977;&#31181;&#26041;&#24335;&#65306;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person8;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person8 partition <span class="org-rainbow-delimiters-depth-1">(</span>p1<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> person8 subpartition <span class="org-rainbow-delimiters-depth-1">(</span>p1_sp01<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<b>范围-哈希分区:</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#20808;&#25353;&#29031;&#29983;&#26085;&#65292;&#23558;&#25968;&#25454;&#20998;&#20026;&#19977;&#20010;&#21306;</span>
<span class="org-comment">-- &#28982;&#21518;&#22312;&#27599;&#20010;&#20998;&#21306;&#20869;&#65292;&#21448;&#25353;&#29031;&#21704;&#24076;&#31639;&#27861;&#20998;&#25104;&#20102;&#19977;&#20010;&#21306;</span>
<span class="org-comment">-- &#36825;&#26679;&#23601;&#20445;&#35777;&#20102;&#27599;&#20010;&#20998;&#21306;&#20869;&#30340;&#25968;&#25454;&#23613;&#37327;&#30340;&#23569;&#65292;&#32780;&#19988;&#20998;&#21306;&#36827;&#34892;&#24179;&#34913;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">person7</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>, birth <span class="org-type">date</span><span class="org-rainbow-delimiters-depth-1">)</span>
partition <span class="org-keyword">by</span> range <span class="org-rainbow-delimiters-depth-1">(</span>birth<span class="org-rainbow-delimiters-depth-1">)</span>
subpartition <span class="org-keyword">by</span> hash <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span><span class="org-rainbow-delimiters-depth-1">)</span> subpartitions 3
<span class="org-rainbow-delimiters-depth-1">(</span>
  partition p1 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'19900101'</span>, <span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>,
  partition p2 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>to_date<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">'20000101'</span>, <span class="org-string">'yyyymmdd'</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>,
  partition p3 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-2">(</span>maxvalue<span class="org-rainbow-delimiters-depth-2">)</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<b>相关字典表:</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">select</span> * <span class="org-keyword">from</span> user_objects <span class="org-keyword">where</span> object_name =<span class="org-string">'PERSON8'</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> user_tables <span class="org-keyword">where</span> <span class="org-keyword">table_name</span> = <span class="org-string">'PERSON8'</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> user_tab_partitions <span class="org-keyword">where</span> <span class="org-keyword">table_name</span> = <span class="org-string">'PERSON8'</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> user_tab_subpartitions <span class="org-keyword">where</span> <span class="org-keyword">table_name</span> = <span class="org-string">'PERSON8'</span>;
</pre>
</div>

<p>
<b>操作表分区:</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#28155;&#21152;&#20998;&#21306;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">add</span> partition p9 <span class="org-keyword">values</span> <span class="org-keyword">less</span> <span class="org-keyword">than</span> <span class="org-rainbow-delimiters-depth-1">(</span>MAXVALUE<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">add</span> partition p9 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>1, 2<span class="org-rainbow-delimiters-depth-1">)</span>;   <span class="org-comment">-- &#38024;&#23545; list &#20998;&#21306;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">add</span> partition;                    <span class="org-comment">-- &#38024;&#23545; hash &#20998;&#21306;</span>

<span class="org-comment">-- &#21024;&#38500;&#20998;&#21306;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> <span class="org-keyword">drop</span> partition p3;

<span class="org-comment">-- &#21024;&#38500;&#20998;&#21306;&#20869;&#25968;&#25454;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> truncate partition p3;

<span class="org-comment">-- &#21512;&#24182;&#30456;&#37051;&#20998;&#21306;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> merge partitions p2, p3 <span class="org-keyword">into</span> partition p8;

<span class="org-comment">-- &#25286;&#20998;&#20998;&#21306;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> split partition p2 <span class="org-keyword">at</span> <span class="org-rainbow-delimiters-depth-1">(</span>3000<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">into</span> <span class="org-rainbow-delimiters-depth-1">(</span>partition p3, partition p14<span class="org-rainbow-delimiters-depth-1">)</span>;     <span class="org-comment">-- &#33539;&#22260;&#20998;&#21306;&#30340;&#25286;&#20998;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> split partition p2 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>1,2<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">into</span> <span class="org-rainbow-delimiters-depth-1">(</span>partition p3, partition p4<span class="org-rainbow-delimiters-depth-1">)</span>;   <span class="org-comment">-- &#21015;&#34920;&#20998;&#21306;&#30340;&#25286;&#20998;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> split partition p2 <span class="org-keyword">into</span> <span class="org-rainbow-delimiters-depth-1">(</span>partition p3 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span>1, 2<span class="org-rainbow-delimiters-depth-2">)</span>, partition p4 <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-2">(</span>3<span class="org-rainbow-delimiters-depth-2">)</span>, partition p5<span class="org-rainbow-delimiters-depth-1">)</span>;   <span class="org-comment">-- &#21015;&#34920;&#20998;&#21306;&#30340;&#25286;&#20998;</span>

<span class="org-comment">-- &#37325;&#21629;&#21517;&#20998;&#21306;</span>
<span class="org-keyword">alter</span> <span class="org-keyword">table</span> <span class="org-function-name">person</span> rename partition p2 <span class="org-keyword">to</span> p12;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> 物化视图</h3>
<div class="outline-text-3" id="text-8-2">
<p>
<b>以空间换时间</b>
</p>

<p>
物化视图，可以看做是 <b>加了同步功能的临时表</b>，它占用实际的存储空间。
</p>

<p>
创建的物化视图，可以在 <code>user_tables</code> 字典表里查到，因为本质上它就是一张表。
</p>

<p>
如果要创建这样的临时表，需要考虑几个方面：
</p>
<ol class="org-ol">
<li>什么时候初始化数据
<pre class="example">
build immediate   -- 建表的时候顺带初始化数据，默认
build deferred    -- 数据延迟创建
</pre>
</li>
<li>如果基表中的数据发生变化的时候，以什么样的策略保持同步
<pre class="example">
refresh complete  -- 全量刷新，即将旧的完全删掉，再重建
refresh fast      -- 增量刷新
refresh force     -- 由 Oracle 自动判断刷新方式，默认
refresh never     -- 不同步数据
</pre>
</li>
<li>如果基表中的数据发生变化，数据同步的时机
<pre class="example">
on commit         -- 基本的事务提交立刻同步到物化视图
on demand start with 开始时间 next 下一个时间  -- 定时同步
</pre>
</li>
<li>如果查询基表中的数据，而这些数据同时包含在物化视图中，那么，是不是让 Oracle 将查询语句更改为查询物化视图
<pre class="example">
enable query rewrite
disable query rewrite  -- 默认
</pre>
</li>
</ol>

<p>
<b>创建物化视图的示例：</b>
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21019;&#24314;&#19968;&#20010;&#31616;&#21333;&#30340;&#29289;&#21270;&#35270;&#22270;&#30340;&#20363;&#23376;</span>
<span class="org-keyword">create</span> materialized <span class="org-keyword">view</span> <span class="org-function-name">mv_emp1</span>
   build <span class="org-keyword">immediate</span>  <span class="org-comment">-- &#21019;&#24314;&#29289;&#21270;&#35270;&#22270;&#30340;&#26102;&#20505;&#65292;&#31435;&#21051;&#21021;&#22987;&#21270;&#25968;&#25454;</span>
   refresh complete <span class="org-comment">-- &#37319;&#21462;&#20840;&#37327;&#21516;&#27493;&#30340;&#26041;&#24335;</span>
   <span class="org-keyword">on</span> <span class="org-keyword">commit</span>        <span class="org-comment">-- &#22522;&#34920;&#20013;&#25968;&#25454;&#25552;&#20132;&#20250;&#35302;&#21457;&#21516;&#27493;&#34892;&#20026;</span>
   <span class="org-comment">-- on demand sysdate next sysdate + 1 -- &#27599;&#22825;&#26356;&#26032;&#19968;&#27425;</span>
   enable query rewrite
<span class="org-keyword">as</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt; 3000;
<span class="org-comment">-- &#26597;&#35810;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> mv_emp1;
<span class="org-comment">-- &#21521;&#22522;&#34920;&#20013;&#25554;&#20837;&#25968;&#25454;</span>
<span class="org-keyword">insert</span> <span class="org-keyword">into</span> emp <span class="org-rainbow-delimiters-depth-1">(</span>empno, ename, sal<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>8377, <span class="org-string">'&#29579;&#27494;'</span>, 4444<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment">-- &#20107;&#21153;&#30340;&#25552;&#20132;&#25165;&#20250;&#35302;&#21457;&#21516;&#27493;&#65292;&#25152;&#20197;&#36825;&#19968;&#27493;&#19981;&#21487;&#23569;</span>
<span class="org-keyword">commit</span>;
<span class="org-comment">-- &#26597;&#35810;&#65292;&#30475;&#25968;&#25454;&#26159;&#21542;&#24050;&#32463;&#21516;&#27493;</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> mv_emp1;



<span class="org-comment">-- &#22914;&#26524;&#35201;&#22686;&#37327;&#21516;&#27493;&#65292;&#38656;&#35201;&#35760;&#24405;&#22312;&#19978;&#27425;&#26356;&#26032;&#21040;&#19979;&#27425;&#26356;&#26032;&#26102;&#38388;&#20869;&#65292;&#22522;&#34920;&#20869;&#25152;&#26377;&#21464;&#21270;</span>
<span class="org-comment">-- &#22312;&#36825;&#37324;&#65292;&#20351;&#29992;&#30340;&#26159;&#29289;&#21270;&#35270;&#22270;&#26085;&#24535;</span>
<span class="org-comment">-- &#21019;&#24314;&#35821;&#21477;&#22914;&#19979;:</span>
<span class="org-keyword">create</span> materialized <span class="org-keyword">view</span> <span class="org-function-name">log</span> <span class="org-keyword">on</span> emp <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-keyword">with</span> rowid/<span class="org-keyword">primary</span> <span class="org-keyword">key</span><span class="org-rainbow-delimiters-depth-1">]</span>;
<span class="org-comment">-- &#28982;&#21518;&#23601;&#21487;&#20197;&#25351;&#23450;&#22686;&#37327;&#21516;&#27493;&#30340;&#26041;&#24335;&#20102;</span>
<span class="org-keyword">create</span> materialized <span class="org-keyword">view</span> <span class="org-function-name">mv_emp2</span>
   build <span class="org-keyword">immediate</span> 
   refresh fast                       <span class="org-comment">-- &#37319;&#21462;&#22686;&#37327;&#21516;&#27493;&#30340;&#26041;&#24335;</span>
   <span class="org-keyword">on</span> demand sysdate <span class="org-keyword">next</span> sysdate + 1 <span class="org-comment">-- &#27599;&#22825;&#26356;&#26032;&#19968;&#27425;&#65292;on demand &#21518;&#38754;&#36824;&#26377;&#20854;&#20182;&#24456;&#22810;&#19981;&#21516;&#24418;&#24335;&#30340;&#21629;&#20196;</span>
   enable query rewrite
<span class="org-keyword">as</span>
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt; 3000;


<span class="org-comment">-- &#21024;&#38500;</span>
<span class="org-keyword">drop</span> materialized <span class="org-keyword">view</span> <span class="org-function-name">log</span> <span class="org-keyword">on</span> emp;
<span class="org-keyword">drop</span> materialized <span class="org-keyword">view</span> <span class="org-function-name">mv_emp2</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> 索引</h3>
<div class="outline-text-3" id="text-8-3">
<p>
位图索引示例：
</p>
<table>


<colgroup>
<col  class="left">

<col  class="left">

<col  class="left">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="left">

<col  class="right">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">字段</th>
<th scope="col" class="left">字段</th>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="right">索引</th>
<th scope="col" class="right">索引</th>
<th scope="col" class="right">索引</th>
<th scope="col" class="right">索引</th>
<th scope="col" class="right">索引</th>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="right">查询(xb=女 and hy=否)</th>
</tr>

<tr>
<th scope="col" class="left">XB</th>
<th scope="col" class="left">HY</th>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="right">xb=男</th>
<th scope="col" class="right">xb=女</th>
<th scope="col" class="right">xb=未知</th>
<th scope="col" class="right">hy=是</th>
<th scope="col" class="right">hy=否</th>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="right">将两个索引做与运算</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">男</td>
<td class="left">是</td>
<td class="left">&#xa0;</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="left">&#xa0;</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">女</td>
<td class="left">是</td>
<td class="left">&#xa0;</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="left">&#xa0;</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">女</td>
<td class="left">否</td>
<td class="left">&#xa0;</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="left">&#xa0;</td>
<td class="right">1(符合条件)</td>
</tr>

<tr>
<td class="left">男</td>
<td class="left">是</td>
<td class="left">&#xa0;</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="left">&#xa0;</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">100亿</td>
<td class="left">100亿</td>
<td class="left">&#xa0;</td>
<td class="right">-</td>
<td class="right">-</td>
<td class="right">-</td>
<td class="right">-</td>
<td class="right">-</td>
<td class="left">&#xa0;</td>
<td class="right">-</td>
</tr>

<tr>
<td class="left">未知</td>
<td class="left">否</td>
<td class="left">&#xa0;</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="left">&#xa0;</td>
<td class="right">0</td>
</tr>

<tr>
<td class="left">女</td>
<td class="left">是</td>
<td class="left">&#xa0;</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="left">&#xa0;</td>
<td class="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>

<section id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> PL/SQL编程</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> PL/SQL块</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#23436;&#25972;&#35821;&#21477;</span>
<span class="org-rainbow-delimiters-depth-1">[</span><span class="org-keyword">DECLARE</span><span class="org-rainbow-delimiters-depth-1">]</span>
  <span class="org-comment">-- &#21464;&#37327;&#22768;&#26126;&#21306;</span>
<span class="org-keyword">BEGIN</span>
  <span class="org-comment">-- &#20195;&#30721;&#21306;</span>
<span class="org-rainbow-delimiters-depth-1">[</span><span class="org-keyword">EXCEPTION</span><span class="org-rainbow-delimiters-depth-1">]</span>
  <span class="org-comment">-- &#24322;&#24120;&#22788;&#29702;&#21306;</span>
<span class="org-keyword">END</span>;


<span class="org-comment">-- &#26368;&#22522;&#26412;</span>
<span class="org-keyword">begin</span>
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'hello, world'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">end</span>;

<span class="org-comment">-- &#39034;&#24207;&#25191;&#34892;</span>
<span class="org-keyword">begin</span>
  dbms_output.put<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'hello, '</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'world'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">end</span>;

<span class="org-comment">-- &#29992; declare &#22768;&#26126;&#21464;&#37327;</span>
<span class="org-comment">-- &#21464;&#37327;&#24517;&#39035;&#35201;&#36319;&#30528;&#31867;&#22411;</span>
<span class="org-keyword">declare</span>
  <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-1">(</span>20<span class="org-rainbow-delimiters-depth-1">)</span>;
  age <span class="org-keyword">number</span>;
<span class="org-keyword">begin</span>
  <span class="org-comment">-- &#21464;&#37327;&#36171;&#20540;</span>
  <span class="org-keyword">name</span> := <span class="org-string">'Tom'</span>;
  age := 12;

  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24744;&#22909;&#65292;'</span> || <span class="org-keyword">name</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24744;&#26159; '</span> || <span class="org-keyword">name</span> || <span class="org-string">', &#20320;&#29616;&#22312; '</span> || age || <span class="org-string">' &#23681;&#12290;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">end</span>;


<span class="org-comment">-- &#21487;&#20197;&#24102;&#24322;&#24120;&#22788;&#29702;</span>
<span class="org-keyword">declare</span>
  <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-1">(</span>20<span class="org-rainbow-delimiters-depth-1">)</span>;
  age <span class="org-keyword">number</span>;
  <span class="org-keyword">result</span> <span class="org-keyword">number</span>;
<span class="org-keyword">begin</span>
  <span class="org-keyword">name</span> := <span class="org-string">'Tom'</span>;
  age := 12;

  <span class="org-keyword">result</span> := 10/0;

  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24744;&#22909;&#65292;'</span> || <span class="org-keyword">name</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24744;&#26159; '</span> || <span class="org-keyword">name</span> || <span class="org-string">', &#20320;&#29616;&#22312; '</span> || age || <span class="org-string">' &#23681;&#12290;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">exception</span>
  <span class="org-keyword">when</span> others <span class="org-keyword">then</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> || <span class="org-string">', &#20320;&#31639;&#38169;&#20102;&#65292;&#38500;&#25968;&#19981;&#33021;&#20026; 0'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">end</span>;


<span class="org-comment">-- &#23558;&#24322;&#24120;&#20449;&#24687;&#20445;&#23384;&#21040;&#34920;&#20013;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">mylog</span> <span class="org-rainbow-delimiters-depth-1">(</span>msg varchar2<span class="org-rainbow-delimiters-depth-2">(</span>100<span class="org-rainbow-delimiters-depth-2">)</span>, createdate <span class="org-type">date</span> <span class="org-keyword">default</span> sysdate<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> mylog;
<span class="org-keyword">declare</span>
  <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-1">(</span>20<span class="org-rainbow-delimiters-depth-1">)</span>;
  age <span class="org-keyword">number</span>;
  <span class="org-keyword">result</span> <span class="org-keyword">number</span>;
  errmsg varchar2<span class="org-rainbow-delimiters-depth-1">(</span>40<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">begin</span>
  <span class="org-keyword">name</span> := <span class="org-string">'Tom'</span>;
  age := 12;

  <span class="org-keyword">result</span> := 10/0;

  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24744;&#22909;&#65292;'</span> || <span class="org-keyword">name</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24744;&#26159; '</span> || <span class="org-keyword">name</span> || <span class="org-string">', &#20320;&#29616;&#22312; '</span> || age || <span class="org-string">' &#23681;&#12290;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">exception</span>
  <span class="org-keyword">when</span> zero_divide <span class="org-keyword">then</span>
    errmsg := sqlerrm;
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> || <span class="org-string">', &#20320;&#31639;&#38169;&#20102;&#65292;&#38500;&#25968;&#19981;&#33021;&#20026; 0'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
    <span class="org-keyword">insert</span> <span class="org-keyword">into</span> mylog <span class="org-rainbow-delimiters-depth-1">(</span>msg<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'TOM:'</span> || errmsg<span class="org-rainbow-delimiters-depth-1">)</span>;
    <span class="org-keyword">commit</span>;
<span class="org-keyword">end</span>;


<span class="org-comment">-- &#21487;&#20197;&#32473;&#21464;&#37327;&#36171;&#20104;&#40664;&#35748;&#20540;&#65292;:= &#25110; default</span>
<span class="org-comment">-- &#21487;&#20197;&#36890;&#36807; constant &#35774;&#23450;&#24120;&#37327;&#65292;&#21363;&#19981;&#21487;&#26356;&#25913;&#30340;&#37327;</span>
<span class="org-comment">-- &#24322;&#24120;&#22788;&#29702;&#21306;&#65292;&#21487;&#20197;&#22788;&#29702;&#22810;&#20010;&#24322;&#24120;</span>
<span class="org-keyword">declare</span>
  <span class="org-keyword">name</span> CONSTANT varchar2<span class="org-rainbow-delimiters-depth-1">(</span>20<span class="org-rainbow-delimiters-depth-1">)</span> := <span class="org-string">'CAT'</span>;
  age <span class="org-keyword">number</span> <span class="org-keyword">default</span> 15;
<span class="org-keyword">begin</span>
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24744;&#22909;&#65292;'</span> || <span class="org-keyword">name</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24744;&#26159; '</span> || <span class="org-keyword">name</span> || <span class="org-string">', &#20320;&#29616;&#22312; '</span> || age || <span class="org-string">' &#23681;&#12290;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">exception</span>
  <span class="org-keyword">when</span> zero_divide <span class="org-keyword">then</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'aaaaa'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">when</span> others <span class="org-keyword">then</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'bbbbbbb'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">end</span>;



<span class="org-comment">-- &#21333;&#29420;&#20026;&#26576;&#19968;&#27573;&#20195;&#30721;&#22788;&#29702;&#24322;&#24120;</span>
<span class="org-keyword">DECLARE</span>
  vemp emp%rowtype;
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">BEGIN</span>
    <span class="org-keyword">select</span> * <span class="org-keyword">into</span> vemp <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> ename = <span class="org-string">'KINGs'</span>;
  <span class="org-keyword">EXCEPTION</span>
    <span class="org-keyword">WHEN</span> no_data_found <span class="org-keyword">THEN</span>
      dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'ccc'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">END</span>;

  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'bbb'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">EXCEPTION</span>
  <span class="org-keyword">WHEN</span> no_data_found <span class="org-keyword">THEN</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'aaa'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">END</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> 类型与赋值</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">DECLARE</span>
  <span class="org-comment">-- Scalar &#31867;&#22411;</span>
  a <span class="org-keyword">number</span>;
  b varchar2<span class="org-rainbow-delimiters-depth-1">(</span>20<span class="org-rainbow-delimiters-depth-1">)</span>; <span class="org-comment">-- 4000</span>
  c <span class="org-type">date</span>;
  d <span class="org-type">clob</span>;

  <span class="org-comment">-- &#23646;&#24615;&#31867;&#22411;</span>
  vempno emp.empno%<span class="org-keyword">type</span>;
  vsal emp.sal%<span class="org-keyword">type</span> <span class="org-keyword">default</span> 111;

<span class="org-keyword">BEGIN</span>
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'1: '</span> || vsal<span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-comment">-- &#31532;&#19968;&#31181;&#36171;&#20540;&#26041;&#24335;</span>
  vsal := 222;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'2: '</span> || vsal<span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-comment">-- &#31532;&#20108;&#31181;&#36171;&#20540;&#26041;&#24335;</span>
  <span class="org-keyword">select</span> sal <span class="org-keyword">into</span> vsal <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> ename = <span class="org-string">'KING'</span>;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'3: '</span> || vsal<span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-comment">-- &#31532;&#19977;&#31181;&#36171;&#20540;&#26041;&#24335;</span>
  <span class="org-keyword">update</span> emp <span class="org-keyword">set</span> sal = 444 <span class="org-keyword">where</span> ename = <span class="org-string">'KING'</span> returning sal + nvl<span class="org-rainbow-delimiters-depth-1">(</span>comm, 0<span class="org-rainbow-delimiters-depth-1">)</span>, empno <span class="org-keyword">into</span> vsal, vempno;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'4: '</span> || vsal<span class="org-rainbow-delimiters-depth-1">)</span>;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'5: '</span> || vempno<span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">rollback</span>;
  <span class="org-comment">-- &#31532;&#22235;&#31181;&#36171;&#20540;&#26041;&#24335;(fetch into, &#28216;&#26631;)</span>
<span class="org-keyword">END</span>;



<span class="org-comment">-- rowtype</span>
<span class="org-comment">-- &#21487;&#20197;&#36827;&#19968;&#27493;&#31616;&#21270;&#36171;&#20540;</span>
<span class="org-keyword">DECLARE</span>
  vemp emp%rowtype;
<span class="org-keyword">BEGIN</span>
  <span class="org-keyword">select</span> * <span class="org-keyword">into</span> vemp <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> ename = <span class="org-string">'KING'</span>;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span>vemp.empno || <span class="org-string">':'</span> || vemp.ename || <span class="org-string">':'</span> || vemp.sal || <span class="org-string">'/'</span> || vemp.deptno<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">END</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> 控制流程</h3>
<div class="outline-text-3" id="text-9-3">
<pre class="example">
if ... then ... else ... end if;
case ... when ... then ... when ... then ... else ... end case;
loop ... end loop;
for ... in x..y loop ... end loop;
while ... loop ... end loop;
</pre>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#21521;&#25968;&#25454;&#24211;&#20013;&#25554;&#20837;&#25209;&#37327;&#25968;&#25454;&#31034;&#20363;</span>
<span class="org-comment">-- &#29992;&#21040;&#20102; for in &#24490;&#29615; &#21644; if else &#21028;&#26029;</span>
<span class="org-keyword">create</span> <span class="org-keyword">table</span> <span class="org-function-name">haha</span> <span class="org-rainbow-delimiters-depth-1">(</span>id <span class="org-type">int</span> <span class="org-keyword">primary</span> <span class="org-keyword">key</span>, <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">create</span> <span class="org-keyword">sequence</span> <span class="org-function-name">seq_haha</span>;
<span class="org-comment">-- pl/sql</span>
<span class="org-keyword">DECLARE</span>
  begin_time <span class="org-type">timestamp</span>;
<span class="org-keyword">BEGIN</span> 
  begin_time := systimestamp;

  <span class="org-keyword">FOR</span> i <span class="org-keyword">IN</span> 1..100003 LOOP
    <span class="org-keyword">insert</span> <span class="org-keyword">into</span> haha <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>seq_haha.nextval, <span class="org-string">'X_'</span> || dbms_random.string<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'U'</span>, 10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
    if <span class="org-builtin">mod</span><span class="org-rainbow-delimiters-depth-1">(</span>i, 1000<span class="org-rainbow-delimiters-depth-1">)</span> = 0 <span class="org-keyword">then</span>
      <span class="org-keyword">commit</span>;
    elsif i = 100003 <span class="org-keyword">then</span>
      dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#24635;&#20849;&#33457;&#36153;&#20102;'</span> || <span class="org-rainbow-delimiters-depth-2">(</span>systimestamp - begin_time<span class="org-rainbow-delimiters-depth-2">)</span> || <span class="org-string">'&#26102;&#38388;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
      <span class="org-keyword">commit</span>;
    <span class="org-keyword">end</span> if;
  <span class="org-keyword">END</span> LOOP;
<span class="org-keyword">END</span>;



<span class="org-comment">-- &#20197;&#19979;&#19977;&#31181;&#26041;&#24335;&#26159;&#31561;&#25928;&#30340;</span>
<span class="org-comment">-- 1. for in</span>
<span class="org-keyword">begin</span>
  <span class="org-keyword">for</span> i <span class="org-keyword">in</span> 1..100000 loop
    <span class="org-keyword">insert</span> <span class="org-keyword">into</span> haha <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>seq_haha.nextval, <span class="org-string">'X_'</span> || dbms_random.string<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'U'</span>, 10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">end</span> loop;
  <span class="org-keyword">commit</span>;
<span class="org-keyword">end</span>;
<span class="org-comment">-- 2. while</span>
<span class="org-keyword">declare</span>
  n <span class="org-type">int</span> := 100001;
<span class="org-keyword">begin</span>
  while n &gt; 1 loop
    <span class="org-keyword">insert</span> <span class="org-keyword">into</span> haha <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>seq_haha.nextval, <span class="org-string">'X_'</span> || dbms_random.string<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'U'</span>, 10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
    n := n - 1;
  <span class="org-keyword">end</span> loop;
  <span class="org-keyword">commit</span>;
<span class="org-keyword">end</span>;
<span class="org-comment">-- 3. loop exit</span>
<span class="org-keyword">declare</span>
  n <span class="org-type">int</span> := 1;
<span class="org-keyword">begin</span>
  loop
    <span class="org-keyword">insert</span> <span class="org-keyword">into</span> haha <span class="org-keyword">values</span> <span class="org-rainbow-delimiters-depth-1">(</span>seq_haha.nextval, <span class="org-string">'X_'</span> || dbms_random.string<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">'U'</span>, 10<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
    n := n + 1;
    exit <span class="org-keyword">when</span> n &gt; 100000;
  <span class="org-keyword">end</span> loop;
  <span class="org-keyword">commit</span>;
<span class="org-keyword">end</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> 游标</h3>
<div class="outline-text-3" id="text-9-4">
<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-- &#38544;&#24335;&#28216;&#26631;</span>
<span class="org-keyword">begin</span>
  <span class="org-keyword">delete</span> <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt; 9500;
  <span class="org-comment">-- sql%isopen</span>
  <span class="org-comment">-- sql%found</span>
  <span class="org-comment">-- sql%notfound</span>
  <span class="org-comment">-- sql%rowcount</span>
  if <span class="org-keyword">sql</span>%<span class="org-keyword">found</span> <span class="org-keyword">then</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'you'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">else</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'wu'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">end</span> if;
  <span class="org-keyword">rollback</span>;
<span class="org-keyword">end</span>;


<span class="org-comment">-- &#22914;&#26524;&#32467;&#26524;&#38598;&#26377;&#22810;&#26465;&#25968;&#25454;&#65292;&#38544;&#24335;&#28216;&#26631;&#20250;&#25253;&#38169;</span>
<span class="org-comment">-- &#38656;&#35201;&#20351;&#29992;&#26174;&#24335;&#28216;&#26631;</span>
<span class="org-keyword">declare</span>
  vemp emp%rowtype;
<span class="org-keyword">begin</span>
  <span class="org-keyword">select</span> * <span class="org-keyword">into</span> vemp <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt; 3000;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span>vemp.ename<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">end</span>;

<span class="org-comment">-- &#28216;&#26631;&#30340;&#20351;&#29992;&#65292;&#20998;&#19979;&#38754;&#20960;&#27493;</span>
<span class="org-comment">-- 1. &#23450;&#20041;</span>
<span class="org-comment">-- 2. &#25171;&#24320;</span>
<span class="org-comment">-- 3. &#33719;&#21462;&#25968;&#25454;&#65288;&#24490;&#29615;&#65289;</span>
<span class="org-comment">-- 4. &#20851;&#38381;</span>
<span class="org-keyword">declare</span>
  vemp emp%rowtype;
  <span class="org-comment">-- &#23450;&#20041;&#28216;&#26631;</span>
  <span class="org-keyword">cursor</span> c_emp
    <span class="org-keyword">is</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt; 2000;
<span class="org-keyword">begin</span>
  <span class="org-comment">-- &#25171;&#24320;&#28216;&#26631;</span>
  <span class="org-keyword">open</span> c_emp;
  <span class="org-comment">-- &#25552;&#21462;&#28216;&#26631;&#24403;&#21069;&#25968;&#25454;</span>

  <span class="org-keyword">fetch</span> c_emp <span class="org-keyword">into</span> vemp;
  loop
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span>vemp.ename || <span class="org-string">'&#30340;&#24037;&#36164;&#26159;'</span> || vemp.sal<span class="org-rainbow-delimiters-depth-1">)</span>;
    <span class="org-keyword">fetch</span> c_emp <span class="org-keyword">into</span> vemp;
    exit <span class="org-keyword">when</span> c_emp%notfound;
  <span class="org-keyword">end</span> loop;

  <span class="org-comment">-- &#20851;&#38381;&#28216;&#26631;</span>
  <span class="org-keyword">close</span> c_emp;
<span class="org-keyword">end</span>;


<span class="org-comment">-- for in &#24490;&#29615;&#20250;&#33258;&#21160;&#32500;&#25252;&#28216;&#26631;&#30340;&#25171;&#24320;&#19982;&#20851;&#38381;</span>
<span class="org-keyword">declare</span>
  <span class="org-keyword">cursor</span> c_emp
    <span class="org-keyword">is</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt; 3000;
<span class="org-keyword">begin</span>
  <span class="org-keyword">for</span> vemp <span class="org-keyword">in</span> c_emp loop
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span>vemp.ename || <span class="org-string">'&#30340;&#24037;&#36164;&#26159;'</span> || vemp.sal<span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">end</span> loop;
<span class="org-keyword">end</span>;

<span class="org-comment">-- &#29978;&#33267;&#21487;&#20197;&#26356;&#31616;</span>
<span class="org-keyword">begin</span>
  <span class="org-keyword">for</span> vemp <span class="org-keyword">in</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> mgr = 7698<span class="org-rainbow-delimiters-depth-1">)</span> loop
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span>vemp.ename || <span class="org-string">'&#30340;&#24037;&#36164;&#26159;'</span> || vemp.sal<span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">end</span> loop;
<span class="org-keyword">end</span>;


<span class="org-comment">-- &#28216;&#26631;&#21487;&#20197;&#24102;&#21442;&#25968;</span>
<span class="org-keyword">declare</span>
  <span class="org-keyword">cursor</span> c_emp<span class="org-rainbow-delimiters-depth-1">(</span>s <span class="org-keyword">number</span><span class="org-rainbow-delimiters-depth-1">)</span>
    <span class="org-keyword">is</span> <span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal &gt; s;
<span class="org-keyword">begin</span>
  <span class="org-keyword">for</span> vemp <span class="org-keyword">in</span> c_emp<span class="org-rainbow-delimiters-depth-1">(</span>&amp;sal<span class="org-rainbow-delimiters-depth-1">)</span> loop
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span>vemp.ename || <span class="org-string">'&#30340;&#24037;&#36164;&#26159;'</span> || vemp.sal<span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">end</span> loop;
<span class="org-keyword">end</span>;


<span class="org-comment">-- &#21160;&#24577;&#28216;&#26631;</span>
<span class="org-comment">-- &#30053;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-9-5" class="outline-3">
<h3 id="sec-9-5"><span class="section-number-3">9.5</span> 动态语句</h3>
<div class="outline-text-3" id="text-9-5">
<p>
两种方式：
</p>
<ol class="org-ol">
<li>execute immediate
</li>
<li>dbms_sql package
</li>
</ol>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">DECLARE</span>
  <span class="org-keyword">name</span> varchar2<span class="org-rainbow-delimiters-depth-1">(</span>50<span class="org-rainbow-delimiters-depth-1">)</span>;
  sal <span class="org-keyword">number</span>;
<span class="org-keyword">BEGIN</span>
  <span class="org-comment">-- &#23383;&#31526;&#20018;</span>
  <span class="org-keyword">name</span> := <span class="org-builtin">upper</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&amp;ename'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-comment">-- &#21160;&#24577;&#25191;&#34892;</span>
  <span class="org-keyword">execute</span> <span class="org-keyword">immediate</span> <span class="org-string">'select sal+nvl(comm,0) from emp where ename ='''</span> || <span class="org-keyword">name</span> || <span class="org-string">''''</span> <span class="org-keyword">into</span> sal;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> || <span class="org-string">'&#30340;&#24037;&#36164;&#26159;'</span> || sal<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">END</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-9-6" class="outline-3">
<h3 id="sec-9-6"><span class="section-number-3">9.6</span> 异常处理</h3>
<div class="outline-text-3" id="text-9-6">
<p>
异常分两部分：
</p>
<ol class="org-ol">
<li>异常编号(sqlcode)
</li>
<li>异常描述(sqlerrm)，可选，有的异常只有编号但没有描述
</li>
</ol>

<p>
分两种：
</p>
<ol class="org-ol">
<li>系统异常，比如 data_not_found, zero_devide 等异常。
</li>
<li>用户自定义异常
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">DECLARE</span>
  myinput <span class="org-keyword">number</span>;
  <span class="org-comment">-- &#22768;&#26126;&#24322;&#24120;</span>
  myexception <span class="org-keyword">exception</span>;
<span class="org-keyword">BEGIN</span>
  myinput := &amp;mynum;
  if myinput &gt; 10 <span class="org-keyword">then</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'OK'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  elsif myinput &gt;= 0 <span class="org-keyword">then</span>
    <span class="org-comment">-- &#20027;&#21160;&#25243;&#20986;&#24322;&#24120;</span>
    raise myexception;
  <span class="org-keyword">else</span>
    <span class="org-comment">-- &#20027;&#21160;&#25243;&#20986;&#24322;&#24120;, &#26159; raise &#35821;&#21477;&#30340;&#23553;&#35013;</span>
    raise_application_error<span class="org-rainbow-delimiters-depth-1">(</span>-20002, <span class="org-string">'&#25968;&#23383;&#24517;&#39035;&#35201;&#22823;&#20110;0'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">end</span> if;
<span class="org-keyword">EXCEPTION</span>
  <span class="org-comment">-- &#25429;&#33719;&#24322;&#24120;</span>
  <span class="org-keyword">when</span> myexception <span class="org-keyword">then</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#25968;&#23383;&#22826;&#23567;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">END</span>;
</pre>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-9-7" class="outline-3">
<h3 id="sec-9-7"><span class="section-number-3">9.7</span> Procedure</h3>
<div class="outline-text-3" id="text-9-7">
<p>
有了名字的 pl/sql 块，可以反复使用。
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="org-keyword">CREATE</span> <span class="org-keyword">OR</span> REPLACE <span class="org-keyword">PROCEDURE</span> <span class="org-function-name">ptest1</span> <span class="org-rainbow-delimiters-depth-1">(</span>myinput <span class="org-keyword">number</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-keyword">AS</span>
  <span class="org-comment">-- &#22768;&#26126;&#24322;&#24120;</span>
  myexception <span class="org-keyword">exception</span>;
<span class="org-keyword">BEGIN</span>
  if myinput &gt; 10 <span class="org-keyword">then</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'OK'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  elsif myinput &gt;= 0 <span class="org-keyword">then</span>
    <span class="org-comment">-- &#20027;&#21160;&#25243;&#20986;&#24322;&#24120;</span>
    raise myexception;
  <span class="org-keyword">else</span>
    <span class="org-comment">-- &#20027;&#21160;&#25243;&#20986;&#24322;&#24120;, &#26159; raise &#35821;&#21477;&#30340;&#23553;&#35013;</span>
    raise_application_error<span class="org-rainbow-delimiters-depth-1">(</span>-20002, <span class="org-string">'&#25968;&#23383;&#24517;&#39035;&#35201;&#22823;&#20110;0'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
  <span class="org-keyword">end</span> if;
<span class="org-keyword">EXCEPTION</span>
  <span class="org-comment">-- &#25429;&#33719;&#24322;&#24120;</span>
  <span class="org-keyword">when</span> myexception <span class="org-keyword">then</span>
    dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'&#25968;&#23383;&#22826;&#23567;'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">END</span>;


<span class="org-comment">-- &#23384;&#20648;&#36807;&#31243;&#30340;&#21442;&#25968;&#31867;&#22411;</span>
<span class="org-keyword">create</span> <span class="org-keyword">or</span> replace <span class="org-keyword">procedure</span> <span class="org-function-name">pxxx</span>  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> <span class="org-keyword">in</span> varchar2,  <span class="org-comment">-- &#19981;&#33021;&#25351;&#23450;&#38271;&#24230;</span>
                                   s <span class="org-keyword">out</span> <span class="org-keyword">number</span>, c <span class="org-keyword">out</span> <span class="org-keyword">number</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-keyword">is</span>
<span class="org-keyword">begin</span>
  <span class="org-keyword">select</span> sal, nvl<span class="org-rainbow-delimiters-depth-1">(</span>comm, 0<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">into</span> s, c <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> ename = <span class="org-keyword">name</span>;
<span class="org-keyword">end</span>;

<span class="org-comment">-- &#35843;&#29992;&#36807;&#31243;</span>
<span class="org-keyword">declare</span>
  s <span class="org-keyword">number</span>;
  c <span class="org-keyword">number</span>;
<span class="org-keyword">begin</span> 
  pxxx<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'KING'</span>, s, c<span class="org-rainbow-delimiters-depth-1">)</span>;
  dbms_output.put_line<span class="org-rainbow-delimiters-depth-1">(</span>s || <span class="org-string">'----'</span> || c<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">end</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-9-8" class="outline-3">
<h3 id="sec-9-8"><span class="section-number-3">9.8</span> Function</h3>
<div class="outline-text-3" id="text-9-8">
<p>
函数跟过程的区别在于，它有一个明显的返回值，可以在 sql 语句中直接调用。
</p>

<div class="org-src-container">

<pre class="src src-sql"><span class="org-comment">-----------------------------------------</span>
<span class="org-comment">-- &#23450;&#20041;&#19968;&#20010;&#20989;&#25968;&#65292;&#20174; emp &#20013;&#26597;&#35810;&#26576;&#20154;&#30340;&#24037;&#36164; --</span>
<span class="org-comment">-----------------------------------------</span>
<span class="org-keyword">create</span> <span class="org-keyword">or</span> replace <span class="org-keyword">function</span> <span class="org-function-name">pyyy</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">name</span> <span class="org-keyword">in</span> varchar2<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">return</span> <span class="org-keyword">number</span> <span class="org-keyword">is</span>
  r <span class="org-keyword">number</span>;
<span class="org-keyword">begin</span>
  <span class="org-keyword">select</span> sal + nvl<span class="org-rainbow-delimiters-depth-1">(</span>comm, 0<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">into</span> r <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> ename = <span class="org-keyword">name</span>;
  <span class="org-keyword">return</span> r;
<span class="org-keyword">end</span>;

<span class="org-comment">-- &#20989;&#25968;&#30340;&#35843;&#29992;</span>
<span class="org-keyword">select</span> pyyy<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'CLARK'</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-keyword">select</span> * <span class="org-keyword">from</span> emp <span class="org-keyword">where</span> sal + nvl<span class="org-rainbow-delimiters-depth-1">(</span>comm, 0<span class="org-rainbow-delimiters-depth-1">)</span> &gt;= pyyy<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'KING'</span><span class="org-rainbow-delimiters-depth-1">)</span>;



<span class="org-comment">-------------------------</span>
<span class="org-comment">-- &#23450;&#20041;&#19968;&#20010;&#20989;&#25968;&#65292;&#27714;&#24179;&#26041; --</span>
<span class="org-comment">-------------------------</span>
<span class="org-keyword">create</span> <span class="org-keyword">or</span> replace <span class="org-keyword">function</span> <span class="org-function-name">mypower</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">input</span> <span class="org-keyword">number</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">return</span> <span class="org-keyword">number</span> <span class="org-keyword">is</span>
<span class="org-keyword">begin</span>
  <span class="org-keyword">return</span> <span class="org-keyword">input</span> * <span class="org-keyword">input</span>;
<span class="org-keyword">end</span>;

<span class="org-comment">-- &#20989;&#25968;&#30340;&#35843;&#29992;</span>
<span class="org-keyword">select</span> mypower<span class="org-rainbow-delimiters-depth-1">(</span>444<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;
<span class="org-keyword">select</span> power<span class="org-rainbow-delimiters-depth-1">(</span>444, 2<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">from</span> dual;



<span class="org-comment">-------------------------</span>
<span class="org-comment">-- &#23450;&#20041;&#19968;&#20010;&#20989;&#25968;&#65292;&#27714;&#26126;&#22825; --</span>
<span class="org-comment">-------------------------</span>
<span class="org-keyword">create</span> <span class="org-keyword">or</span> replace <span class="org-keyword">function</span> <span class="org-function-name">my_next_day</span> <span class="org-keyword">return</span> <span class="org-type">date</span> <span class="org-keyword">is</span>
<span class="org-keyword">begin</span>
  <span class="org-keyword">return</span> sysdate + 1;
<span class="org-keyword">end</span>;

<span class="org-comment">-- &#20989;&#25968;&#30340;&#20351;&#29992;</span>
<span class="org-keyword">select</span> my_next_day <span class="org-keyword">from</span> dual;
</pre>
</div>
</div>
</div>
</section>


<section id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> 导入/导出</h2>
<div class="outline-text-2" id="text-10">
<p>
imp/exp 命令
</p>


<p>
查看帮助
</p>
<pre class="example">
exp help=y
</pre>

<p>
将 scott 用户下所有的表都导出来，放到 aaa.sql 文件中:
</p>
<pre class="example">
exp system/pwd file=D:\aaa.dmp owner=(scott);
</pre>

<p>
将数据导入到 vip 用户中：
</p>
<pre class="example">
imp system/pwd file=D:\aaa.dmp fromuser=(scott) touser=(vip);
</pre>
</div>
</section>

<section id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> 锁/事务</h2>
</section>

<section id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> hint/explain</h2>
</section>
<section id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> Data Guard/RAC</h2>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: imfine</p>
<p class="date">Created: 2017-10-13 Fri 10:40</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.2.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
